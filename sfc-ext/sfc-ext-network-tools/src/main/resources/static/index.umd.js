(function(e,k){typeof exports=="object"&&typeof module<"u"?k(require("vue"),require("sfc-common"),require("sfc-common/components")):typeof define=="function"&&define.amd?define(["vue","sfc-common","sfc-common/components"],k):(e=typeof globalThis<"u"?globalThis:e||self,k(e.Vue,e.SfcCommon,e.Components))})(this,function(e,k,V){"use strict";var x;(t=>{(l=>{function f(o,m){return{url:"/nwt/findWolByUid",params:{uid:o,checkOnline:!!m}}}l.findByUid=f;function a(o){return{url:"/nwt/saveWolDevice",method:"post",headers:{"Content-Type":"application/json"},data:o}}l.saveWolDevice=a;function d(o){return{url:"/nwt/wakeWolDevice",params:{id:o}}}l.wakeWolDevice=d;function p(o){return{url:"/nwt/batchDeleteWol",data:o,method:"post",headers:{"Content-Type":"application/json"}}}l.batchDelete=p})(t.Wol||(t.Wol={}));function c(){return{url:"/nwt/getAllInterface"}}t.getAllInterface=c,(l=>{function f(){return{url:"/nwt/listUPnP"}}l.listUPnP=f;function a(d,p){return{url:`/nwt/getUPnPIcon?usn=${d}&index=${p}`}}l.getUPnPIcon=a})(t.UPnP||(t.UPnP={}))})(x||(x={}));const L={class:"tip"},E={style:{"padding-left":"24px"}},U={style:{"padding-left":"24px"}},P=e.defineComponent({name:"NetworkInterfaceInfoCard"}),S=e.defineComponent({...P,props:{networkInterface:{type:Object,default:()=>({})}},setup(t){return(c,l)=>{const f=e.resolveComponent("VCardText"),a=e.resolveComponent("VCard");return e.openBlock(),e.createBlock(a,{class:"network-interface-info-card",title:t.networkInterface.name},{default:e.withCtx(()=>[e.createVNode(f,null,{default:e.withCtx(()=>[e.createElementVNode("div",L,[e.createElementVNode("div",null,"接口: "+e.toDisplayString(t.networkInterface.name),1),e.createElementVNode("div",null,"名称: "+e.toDisplayString(t.networkInterface.displayName),1),e.createElementVNode("div",null,"MAC: "+e.toDisplayString(t.networkInterface.mac),1),e.createElementVNode("div",null,[l[0]||(l[0]=e.createTextVNode(" IP地址: ")),e.createElementVNode("ul",E,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.networkInterface.ipList,d=>(e.openBlock(),e.createElementBlock("li",{key:d},e.toDisplayString(d),1))),128))])]),e.createElementVNode("div",null,[l[1]||(l[1]=e.createTextVNode(" 广播地址: ")),e.createElementVNode("ul",U,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.networkInterface.broadcastAddressList,d=>(e.openBlock(),e.createElementBlock("li",{key:d},e.toDisplayString(d),1))),128))])]),e.createElementVNode("div",null,"MTU: "+e.toDisplayString(t.networkInterface.mtu),1)])]),_:1})]),_:1},8,["title"])}}}),B=(t,c)=>{const l=t.__vccOpts||t;for(const[f,a]of c)l[f]=a;return l},b=B(S,[["__scopeId","data-v-5b95a363"]]),T={style:{display:"flex","flex-wrap":"wrap"}},$=e.defineComponent({name:"NetworkInterfaceList",components:{NetworkInterfaceInfoCard:b}}),M=e.defineComponent({...$,setup(t){const c=window.SfcUtils,l=new k.LoadingManager,f=l.getLoadingRef(),a=e.ref([]);return k.MethodInterceptor.createAsyncActionProxy({async loadData(){a.value=(await c.request(x.getAllInterface())).data.data}},!1,l).loadData(),(p,o)=>{const m=e.resolveComponent("LoadingMask");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(m,{loading:e.unref(f)},null,8,["loading"]),e.createElementVNode("div",T,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,s=>(e.openBlock(),e.createBlock(b,{key:s.name,style:{animation:"up-in .2s"},"network-interface":s},null,8,["network-interface"]))),128))])])}}}),R=["src"],W=e.defineComponent({name:"UpnpIcon"}),O=e.defineComponent({...W,props:{device:{type:Object,default:void 0},color:{type:String,default:void 0}},setup(t){const c=window.SfcUtils,l=t,f=e.ref(void 0),a=e.ref(!1);function d(){console.log("UPnP图标加载完成"),a.value=!0}e.onMounted(()=>{var m;const o=(m=l.device)==null?void 0:m.describe.device.iconList;if(o&&o.length>0){const s=o.findIndex(y=>{var w;return(w=y.mimetype)==null?void 0:w.includes("png")})!=-1;let i=0,N=0;o.forEach((y,w)=>{var r;if(s&&!((r=y.mimetype)!=null&&r.includes("png")))return;const n=y.height*y.width;n>i&&(i=n,N=w)}),f.value=c.getApiUrl(x.UPnP.getUPnPIcon(l.device.describe.device.udn,N))}});function p(o){const m=o.describe.device.deviceType;return m.startsWith("urn:schemas-upnp-org:device:InternetGatewayDevice")?"mdi-router-network":m.startsWith("urn:schemas-upnp-org:device:MediaRenderer")?"mdi-movie-play":m.startsWith("urn:schemas-upnp-org:device:MediaServer")?"mdi-play-network":m.startsWith("urn:schemas-upnp-org:device:Printer")?"mdi-printer-outline":m.startsWith("urn:schemas-upnp-org:device:DigitalSecurityCamera")||m.startsWith("urn:schemas-upnp-org:device:IPCamera")?"mdi-cctv":m.startsWith("urn:schemas-upnp-org:device:Scanner:1")?"mdi-scanner":"mdi-network"}return(o,m)=>{const s=e.resolveComponent("CommonIcon");return t.device?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[a.value?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(s,{key:0,icon:p(t.device),color:t.color},null,8,["icon","color"])),f.value?e.withDirectives((e.openBlock(),e.createElementBlock("img",{key:1,src:f.value,width:"30",onLoad:d},null,40,R)),[[e.vShow,a.value]]):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0)}}}),F={class:"mt-3"},A={class:"ml-2"},j={key:0},q=["href"],z=["href"],G=["title"],H={key:0},J=["href"],K={class:"mt-2"},Q=e.defineComponent({name:"UpnpInfoCard"}),X=e.defineComponent({...Q,props:{},setup(t){const c=window.SfcUtils;let l=e.ref([]);const f={async loadUPnpList(){const s=(await c.request(x.UPnP.listUPnP())).data.data;return l.value=s,s}},a=new k.LoadingManager,d=a.getLoadingRef(),p=k.MethodInterceptor.createAsyncActionProxy(f,!0,a);function o(s){return new URL(s).host}function m(s){var y,w;const i=[s.describe.device],N=[];for(;i.length>0;){const n=i.pop();(y=n==null?void 0:n.serviceList)==null||y.forEach(r=>N.push(r)),(w=n==null?void 0:n.deviceList)==null||w.forEach(r=>i.push(r))}return N}return e.onMounted(()=>{p.loadUPnpList()}),(s,i)=>{const N=e.resolveComponent("CommonIcon"),y=e.resolveComponent("VBtn"),w=e.resolveComponent("LoadingMask"),n=e.resolveComponent("VCardTitle"),r=e.resolveComponent("VCol"),_=e.resolveComponent("VRow"),C=e.resolveComponent("VDivider"),u=e.resolveComponent("VChip"),h=e.resolveComponent("VCardText"),ce=e.resolveComponent("VCard");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(y,{color:"primary",onClick:e.unref(p).loadUPnpList},{default:e.withCtx(()=>[e.createVNode(N,{icon:"mdi-refresh"}),i[0]||(i[0]=e.createTextVNode(" 刷新 "))]),_:1},8,["onClick"]),e.createElementVNode("div",F,[e.createVNode(w,{loading:e.unref(d)},null,8,["loading"]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),g=>(e.openBlock(),e.createBlock(ce,{key:g.describe.device.udn,class:"mb-2"},{default:e.withCtx(()=>[e.createVNode(n,{color:"primary",title:g.describe.device.friendlyName,class:"d-flex"},{default:e.withCtx(()=>[e.createVNode(O,{device:g,color:"primary"},null,8,["device"]),e.createElementVNode("span",A,e.toDisplayString(g.describe.device.friendlyName),1)]),_:2},1032,["title"]),e.createVNode(h,null,{default:e.withCtx(()=>[e.createVNode(_,null,{default:e.withCtx(()=>[e.createVNode(r,null,{default:e.withCtx(()=>[e.createElementVNode("p",null,"设备型号名称: "+e.toDisplayString(g.describe.device.modelName),1),g.describe.device.modelURL?(e.openBlock(),e.createElementBlock("p",j,[i[1]||(i[1]=e.createTextVNode(" 设备型号页面: ")),e.createElementVNode("a",{target:"_blank",class:"link",href:g.describe.device.modelURL},e.toDisplayString(g.describe.device.modelURL),9,q)])):e.createCommentVNode("",!0),e.createElementVNode("p",null,"厂商: "+e.toDisplayString(g.describe.device.manufacturer),1),e.createElementVNode("p",null,[i[2]||(i[2]=e.createTextVNode("厂商主页: ")),e.createElementVNode("a",{target:"_blank",class:"link",href:g.describe.device.manufacturerURL},e.toDisplayString(g.describe.device.manufacturerURL),9,z)])]),_:2},1024),e.createVNode(r,null,{default:e.withCtx(()=>[e.createElementVNode("p",null,"设备地址: "+e.toDisplayString(o(g.location)),1),e.createElementVNode("p",{title:g.describe.device.deviceType}," 设备类型: "+e.toDisplayString(g.describe.device.deviceType.split(":")[3]),9,G),g.describe.device.presentationURL?(e.openBlock(),e.createElementBlock("p",H,[i[3]||(i[3]=e.createTextVNode(" 管理页面: ")),e.createElementVNode("a",{target:"_blank",class:"link",href:g.describe.device.presentationURL},e.toDisplayString(g.describe.device.presentationURL),9,J)])):e.createCommentVNode("",!0)]),_:2},1024)]),_:2},1024),e.createVNode(C),e.createElementVNode("div",K,[i[4]||(i[4]=e.createTextVNode(" 包含服务: ")),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m(g),D=>(e.openBlock(),e.createBlock(u,{key:D.serviceId,color:"primary",title:D.serviceType,class:"mr-2"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(D.serviceType.split(":")[3]),1)]),_:2},1032,["title"]))),128))])]),_:2},1024)]),_:2},1024))),128))])])}}}),Y={class:"d-flex justify-space-between"},Z={class:"tip",style:{width:"calc(100% - 12px)","margin-left":"12px"}},v={class:"d-flex align-center"},ee=e.defineComponent({name:"WolDeviceCard"}),te=e.defineComponent({...ee,props:{wolDevice:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1},editable:{type:Boolean,default:!0}},emits:["wake","edit","delete"],setup(t,{emit:c}){const l=c;return(f,a)=>{const d=e.resolveComponent("LoadingMask"),p=e.resolveComponent("CommonIcon"),o=e.resolveComponent("VBtn"),m=e.resolveComponent("VCardText"),s=e.resolveComponent("VCard");return e.openBlock(),e.createBlock(s,{class:"wol-device-card"},{default:e.withCtx(()=>[e.createVNode(d,{loading:t.loading,type:"circular"},null,8,["loading"]),e.createVNode(m,null,{default:e.withCtx(()=>[e.createElementVNode("div",Y,[e.createElementVNode("div",null,[e.createVNode(p,{icon:"mdi-laptop",color:t.wolDevice.isOnline?"primary":"",style:{"font-size":"32px"}},null,8,["color"])]),e.createElementVNode("div",Z,[e.createElementVNode("div",v,[e.createTextVNode(" 设备名: "+e.toDisplayString(t.wolDevice.name)+" ",1),t.editable?(e.openBlock(),e.createBlock(p,{key:0,class:"link d-flex align-center",style:{"font-size":"10px","margin-left":"6px"},icon:"mdi-pencil",onClick:a[0]||(a[0]=i=>l("edit",t.wolDevice))})):e.createCommentVNode("",!0),t.editable?(e.openBlock(),e.createBlock(p,{key:1,class:"link d-flex align-center text-error",style:{"font-size":"10px","margin-left":"6px","--main-color":"var(--v-theme-error)"},icon:"mdi-close",onClick:a[1]||(a[1]=i=>l("delete",t.wolDevice))})):e.createCommentVNode("",!0)]),e.createElementVNode("div",null,"MAC: "+e.toDisplayString(t.wolDevice.mac),1),e.createElementVNode("div",null,"IP: "+e.toDisplayString(t.wolDevice.ip),1)]),e.createElementVNode("div",null,[t.wolDevice.isOnline?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(o,{key:0,style:{"margin-top":"6px"},icon:"mdi-power",color:"primary",onClick:a[2]||(a[2]=i=>l("wake",t.wolDevice))}))])])]),_:1})]),_:1})}}}),I=B(te,[["__scopeId","data-v-46224d94"]]),ne=e.defineComponent({name:"WolDeviceForm",components:{FormRow:V.FormRow,FormCol:V.FormCol,TextInput:V.TextInput}}),oe=e.defineComponent({...ne,props:{initObject:{type:Object,default:void 0},readOnly:{type:Boolean,default:!1}},emits:["submit"],setup(t,{expose:c,emit:l}){const f=window.SfcUtils,a=e.ref(),d=t,p=k.defineForm({actions:{async submit(){return await f.request(x.Wol.saveWolDevice(o))}},formData:{name:"",port:9,ip:"",mac:"",sendIp:"255.255.255.255"},formRef:a,validators:{name:[k.Validators.notNull(),k.Validators.maxLen("不能大于255个字符",255)],mac:[k.Validators.isMatchRegex("^([abcdefABCDEF\\d]{2}[:\\-]?){6}$","不是有效的mac地址")],ip:[k.Validators.notNull(),k.Validators.isMatchRegex("^((2((5[0-5])|([0-4]\\d)))|([0-1]?\\d{1,2}))(\\.((2((5[0-5])|([0-4]\\d)))|([0-1]?\\d{1,2}))){3}$","不是有效的ipv4地址")],port:[k.Validators.minNum(1),k.Validators.maxNum(65535)]},throwError:!0}),{formData:o,actions:m,validators:s,loadingRef:i,loadingManager:N}=p,y=N.getLoadingRef();return d.initObject&&Object.assign(o,d.initObject),c(p),(w,n)=>{const r=e.resolveComponent("LoadingMask"),_=e.resolveComponent("base-form");return e.openBlock(),e.createBlock(_,{ref_key:"formRef",ref:a,"model-value":e.unref(o),"submit-action":e.unref(m).submit},{default:e.withCtx(()=>[e.createVNode(r,{loading:e.unref(y)},null,8,["loading"]),e.createVNode(e.unref(V.FormRow),null,{default:e.withCtx(()=>[e.createVNode(e.unref(V.FormCol),null,{default:e.withCtx(()=>[e.createVNode(e.unref(V.TextInput),{modelValue:e.unref(o).name,"onUpdate:modelValue":n[0]||(n[0]=C=>e.unref(o).name=C),label:"设备名称",rules:e.unref(s).name,placeholder:"起个名字吧~",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1}),e.createVNode(e.unref(V.FormCol),null,{default:e.withCtx(()=>[e.createVNode(e.unref(V.TextInput),{modelValue:e.unref(o).mac,"onUpdate:modelValue":n[1]||(n[1]=C=>e.unref(o).mac=C),label:"MAC地址",rules:e.unref(s).mac,placeholder:"关键参数",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1}),e.createVNode(e.unref(V.FormCol),null,{default:e.withCtx(()=>[e.createVNode(e.unref(V.TextInput),{modelValue:e.unref(o).port,"onUpdate:modelValue":n[2]||(n[2]=C=>e.unref(o).port=C),label:"端口(udp)",rules:e.unref(s).port,placeholder:"默认UDP端口-9",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1}),e.createVNode(e.unref(V.FormCol),null,{default:e.withCtx(()=>[e.createVNode(e.unref(V.TextInput),{modelValue:e.unref(o).ip,"onUpdate:modelValue":n[3]||(n[3]=C=>e.unref(o).ip=C),label:"IP地址(ipv4)",rules:e.unref(s).ip,placeholder:"用来检测是否在线",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1}),e.createVNode(e.unref(V.FormCol),{class:"mw-50"},{default:e.withCtx(()=>[e.createVNode(e.unref(V.TextInput),{modelValue:e.unref(o).sendIp,"onUpdate:modelValue":n[4]||(n[4]=C=>e.unref(o).sendIp=C),label:"发送/广播地址",rules:e.unref(s).ip,placeholder:"255.255.255.255",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1})]),_:1})]),_:1},8,["model-value","submit-action"])}}}),le={class:"WolDeviceList"},re={style:{"margin-top":"12px"}},ae=e.defineComponent({name:"WolDeviceList",components:{WolDeviceCard:I,LoadingMask:V.LoadingMask}}),ie=e.defineComponent({...ae,props:{uid:{type:[String,Number],default:0},showAdd:{type:Boolean,default:!0},autoRefresh:{type:Boolean,default:!0},desktopComponentConfig:{type:Object,default:void 0},editable:{type:Boolean,default:!0}},setup(t){const c=window.SfcUtils,l=t,f=new k.LoadingManager,a=f.getLoadingRef(),d=e.ref([]),p=e.reactive({}),o=async()=>{var n;d.value=(await c.request(x.Wol.findByUid(((n=l.desktopComponentConfig)==null?void 0:n.uid)||l.uid,!0))).data.data||[],d.value.forEach(r=>{r.isOnline&&(p[r.id]=!1)})},m=async n=>{await c.confirm(`确定要唤醒设备${n.name}吗？`,"唤醒确认").then(()=>i.wake(n))},s=async n=>{const r=`确定要删除 ${n.length==1?n[0].name:n.length+"个设备"} 吗？`;await c.confirm(r,"删除确认"),await i.batchDelete(n),c.snackbar("删除成功"),await i.loadData()},i=k.MethodInterceptor.createAsyncActionProxy({async loadData(){await o()},async wake(n){await c.request(x.Wol.wakeWolDevice(n.id)),p[n.id]=!0},async batchDelete(n){await c.request(x.Wol.batchDelete(n.map(r=>r.id)))}},!1,f),N=n=>{var _;const r=c.openComponentDialog(oe,{title:n?"编辑设备":"添加设备",props:{initObject:n||{uid:((_=l.desktopComponentConfig)==null?void 0:_.uid)||l.uid}},extraDialogOptions:{persistent:!0},async onConfirm(){return(await r.getInstAsForm().submit()).success?(c.snackbar(n?"保存成功":"添加成功"),i.loadData(),!0):!1}})};i.loadData();let y=!1,w=setInterval(async()=>{if(!(!l.autoRefresh||y||!d.value.find(n=>p[n.id])))try{y=!0,await o()}finally{y=!1}},5e3);return e.onUnmounted(()=>{w&&clearInterval(w)}),(n,r)=>{const _=e.resolveComponent("VBtn"),C=e.resolveComponent("CommonIcon");return e.openBlock(),e.createElementBlock("div",le,[t.showAdd?(e.openBlock(),e.createBlock(_,{key:0,color:"primary",style:{"margin-right":"12px"},onClick:r[0]||(r[0]=u=>N())},{default:e.withCtx(()=>r[3]||(r[3]=[e.createTextVNode(" 添加设备 ")])),_:1})):e.createCommentVNode("",!0),e.createVNode(_,{onClick:e.unref(i).loadData},{default:e.withCtx(()=>[e.createVNode(C,{icon:"mdi-refresh"}),r[4]||(r[4]=e.createTextVNode(" 刷新 "))]),_:1},8,["onClick"]),e.createVNode(e.unref(V.LoadingMask),{loading:e.unref(a)},null,8,["loading"]),e.createElementVNode("div",re,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,u=>(e.openBlock(),e.createBlock(I,{key:u.id,style:{animation:"up-in .2s"},"wol-device":u,editable:t.editable,loading:p[u.id],onWake:m,onEdit:r[1]||(r[1]=h=>N(h)),onDelete:r[2]||(r[2]=h=>s([h]))},null,8,["wol-device","editable","loading"]))),128))])])}}});window.bootContext.addProcessor({taskName:"注册网络工具",execute(t,c){t.component("WolDeviceList",ie),t.component("NetworkInterfaceList",M),t.component("UpnpInfoCard",X)}})});
