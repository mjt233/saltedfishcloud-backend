(function(e,r){typeof exports=="object"&&typeof module<"u"?r(require("vue"),require("sfc-common")):typeof define=="function"&&define.amd?define(["vue","sfc-common"],r):(e=typeof globalThis<"u"?globalThis:e||self,r(e.Vue,e.SfcCommon))})(this,function(e,r){"use strict";var V;(t=>{(a=>{function m(o,y){return{url:"/nwt/findWolByUid",params:{uid:o,checkOnline:!!y}}}a.findByUid=m;function d(o){return{url:"/nwt/saveWolDevice",method:"post",headers:{"Content-Type":"application/json"},data:o}}a.saveWolDevice=d;function c(o){return{url:"/nwt/wakeWolDevice",params:{id:o}}}a.wakeWolDevice=c;function s(o){return{url:"/nwt/batchDeleteWol",data:o,method:"post",headers:{"Content-Type":"application/json"}}}a.batchDelete=s})(t.Wol||(t.Wol={}));function i(){return{url:"/nwt/getAllInterface"}}t.getAllInterface=i})(V||(V={}));const _={class:"tip"},h={style:{"padding-left":"24px"}},E={style:{"padding-left":"24px"}},L=e.defineComponent({name:"NetworkInterfaceInfoCard"}),O=e.defineComponent({...L,props:{networkInterface:{type:Object,default:()=>({})}},setup(t){return(i,a)=>{const m=e.resolveComponent("VCardText"),d=e.resolveComponent("VCard");return e.openBlock(),e.createBlock(d,{class:"network-interface-info-card",title:t.networkInterface.name},{default:e.withCtx(()=>[e.createVNode(m,null,{default:e.withCtx(()=>[e.createElementVNode("div",_,[e.createElementVNode("div",null,"接口: "+e.toDisplayString(t.networkInterface.name),1),e.createElementVNode("div",null,"名称: "+e.toDisplayString(t.networkInterface.displayName),1),e.createElementVNode("div",null,"MAC: "+e.toDisplayString(t.networkInterface.mac),1),e.createElementVNode("div",null,[a[0]||(a[0]=e.createTextVNode(" IP地址: ")),e.createElementVNode("ul",h,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.networkInterface.ipList,c=>(e.openBlock(),e.createElementBlock("li",{key:c},e.toDisplayString(c),1))),128))])]),e.createElementVNode("div",null,[a[1]||(a[1]=e.createTextVNode(" 广播地址: ")),e.createElementVNode("ul",E,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.networkInterface.broadcastAddressList,c=>(e.openBlock(),e.createElementBlock("li",{key:c},e.toDisplayString(c),1))),128))])]),e.createElementVNode("div",null,"MTU: "+e.toDisplayString(t.networkInterface.mtu),1)])]),_:1})]),_:1},8,["title"])}}}),B=(t,i)=>{const a=t.__vccOpts||t;for(const[m,d]of i)a[m]=d;return a},b=B(O,[["__scopeId","data-v-5b95a363"]]),$={style:{display:"flex","flex-wrap":"wrap"}},M=e.defineComponent({name:"NetworkInterfaceList",components:{NetworkInterfaceInfoCard:b}}),W=e.defineComponent({...M,setup(t){const i=window.SfcUtils,a=new r.LoadingManager,m=a.getLoadingRef(),d=e.ref([]);return r.MethodInterceptor.createAsyncActionProxy({async loadData(){d.value=(await i.request(V.getAllInterface())).data.data}},!1,a).loadData(),(s,o)=>{const y=e.resolveComponent("LoadingMask");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(y,{loading:e.unref(m)},null,8,["loading"]),e.createElementVNode("div",$,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,p=>(e.openBlock(),e.createBlock(b,{key:p.name,style:{animation:"up-in .2s"},"network-interface":p},null,8,["network-interface"]))),128))])])}}}),T={class:"d-flex justify-space-between"},U={class:"tip",style:{width:"calc(100% - 12px)","margin-left":"12px"}},S={class:"d-flex align-center"},F=e.defineComponent({name:"WolDeviceCard"}),A=e.defineComponent({...F,props:{wolDevice:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1},editable:{type:Boolean,default:!0}},emits:["wake","edit","delete"],setup(t,{emit:i}){const a=i;return(m,d)=>{const c=e.resolveComponent("LoadingMask"),s=e.resolveComponent("CommonIcon"),o=e.resolveComponent("VBtn"),y=e.resolveComponent("VCardText"),p=e.resolveComponent("VCard");return e.openBlock(),e.createBlock(p,{class:"wol-device-card"},{default:e.withCtx(()=>[e.createVNode(c,{loading:t.loading,type:"circular"},null,8,["loading"]),e.createVNode(y,null,{default:e.withCtx(()=>[e.createElementVNode("div",T,[e.createElementVNode("div",null,[e.createVNode(s,{icon:"mdi-laptop",color:t.wolDevice.isOnline?"primary":"",style:{"font-size":"32px"}},null,8,["color"])]),e.createElementVNode("div",U,[e.createElementVNode("div",S,[e.createTextVNode(" 设备名: "+e.toDisplayString(t.wolDevice.name)+" ",1),t.editable?(e.openBlock(),e.createBlock(s,{key:0,class:"link d-flex align-center",style:{"font-size":"10px","margin-left":"6px"},icon:"mdi-pencil",onClick:d[0]||(d[0]=w=>a("edit",t.wolDevice))})):e.createCommentVNode("",!0),t.editable?(e.openBlock(),e.createBlock(s,{key:1,class:"link d-flex align-center text-error",style:{"font-size":"10px","margin-left":"6px","--main-color":"var(--v-theme-error)"},icon:"mdi-close",onClick:d[1]||(d[1]=w=>a("delete",t.wolDevice))})):e.createCommentVNode("",!0)]),e.createElementVNode("div",null,"MAC: "+e.toDisplayString(t.wolDevice.mac),1),e.createElementVNode("div",null,"IP: "+e.toDisplayString(t.wolDevice.ip),1)]),e.createElementVNode("div",null,[t.wolDevice.isOnline?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(o,{key:0,style:{"margin-top":"6px"},icon:"mdi-power",color:"primary",onClick:d[2]||(d[2]=w=>a("wake",t.wolDevice))}))])])]),_:1})]),_:1})}}}),I=B(A,[["__scopeId","data-v-46224d94"]]),R=e.defineComponent({name:"WolDeviceForm",components:{FormRow:r.Components.FormRow,FormCol:r.Components.FormCol,TextInput:r.Components.TextInput}}),j=e.defineComponent({...R,props:{initObject:{type:Object,default:void 0},readOnly:{type:Boolean,default:!1}},emits:["submit"],setup(t,{expose:i,emit:a}){const m=window.SfcUtils,d=e.ref(),c=t,s=r.defineForm({actions:{async submit(){return await m.request(V.Wol.saveWolDevice(o))}},formData:{name:"",port:9,ip:"",mac:"",sendIp:"255.255.255.255"},formRef:d,validators:{name:[r.Validators.notNull(),r.Validators.maxLen("不能大于255个字符",255)],mac:[r.Validators.isMatchRegex("^([abcdefABCDEF\\d]{2}[:\\-]?){6}$","不是有效的mac地址")],ip:[r.Validators.notNull(),r.Validators.isMatchRegex("^((2((5[0-5])|([0-4]\\d)))|([0-1]?\\d{1,2}))(\\.((2((5[0-5])|([0-4]\\d)))|([0-1]?\\d{1,2}))){3}$","不是有效的ipv4地址")],port:[r.Validators.minNum(1),r.Validators.maxNum(65535)]},throwError:!0}),{formData:o,actions:y,validators:p,loadingRef:w,loadingManager:x}=s,u=x.getLoadingRef();return c.initObject&&Object.assign(o,c.initObject),i(s),(N,n)=>{const l=e.resolveComponent("LoadingMask"),k=e.resolveComponent("TextInput"),g=e.resolveComponent("FormCol"),D=e.resolveComponent("FormRow"),C=e.resolveComponent("base-form");return e.openBlock(),e.createBlock(C,{ref_key:"formRef",ref:d,"model-value":e.unref(o),"submit-action":e.unref(y).submit},{default:e.withCtx(()=>[e.createVNode(l,{loading:e.unref(u)},null,8,["loading"]),e.createVNode(D,null,{default:e.withCtx(()=>[e.createVNode(g,null,{default:e.withCtx(()=>[e.createVNode(k,{modelValue:e.unref(o).name,"onUpdate:modelValue":n[0]||(n[0]=f=>e.unref(o).name=f),label:"设备名称",rules:e.unref(p).name,placeholder:"起个名字吧~",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1}),e.createVNode(g,null,{default:e.withCtx(()=>[e.createVNode(k,{modelValue:e.unref(o).mac,"onUpdate:modelValue":n[1]||(n[1]=f=>e.unref(o).mac=f),label:"MAC地址",rules:e.unref(p).mac,placeholder:"关键参数",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1}),e.createVNode(g,null,{default:e.withCtx(()=>[e.createVNode(k,{modelValue:e.unref(o).port,"onUpdate:modelValue":n[2]||(n[2]=f=>e.unref(o).port=f),label:"端口(udp)",rules:e.unref(p).port,placeholder:"默认UDP端口-9",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1}),e.createVNode(g,null,{default:e.withCtx(()=>[e.createVNode(k,{modelValue:e.unref(o).ip,"onUpdate:modelValue":n[3]||(n[3]=f=>e.unref(o).ip=f),label:"IP地址(ipv4)",rules:e.unref(p).ip,placeholder:"用来检测是否在线",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1}),e.createVNode(g,{class:"mw-50"},{default:e.withCtx(()=>[e.createVNode(k,{modelValue:e.unref(o).sendIp,"onUpdate:modelValue":n[4]||(n[4]=f=>e.unref(o).sendIp=f),label:"发送/广播地址",rules:e.unref(p).ip,placeholder:"255.255.255.255",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1})]),_:1})]),_:1},8,["model-value","submit-action"])}}}),q={class:"WolDeviceList"},P={style:{"margin-top":"12px"}},z=e.defineComponent({name:"WolDeviceList",components:{WolDeviceCard:I,LoadingMask:r.Components.LoadingMask}}),G=e.defineComponent({...z,props:{uid:{type:[String,Number],default:0},showAdd:{type:Boolean,default:!0},autoRefresh:{type:Boolean,default:!0},desktopComponentConfig:{type:Object,default:void 0},editable:{type:Boolean,default:!0}},setup(t){const i=window.SfcUtils,a=t,m=new r.LoadingManager,d=m.getLoadingRef(),c=e.ref([]),s=e.reactive({}),o=async()=>{var n;c.value=(await i.request(V.Wol.findByUid(((n=a.desktopComponentConfig)==null?void 0:n.uid)||a.uid,!0))).data.data||[],c.value.forEach(l=>{l.isOnline&&(s[l.id]=!1)})},y=async n=>{await i.confirm(`确定要唤醒设备${n.name}吗？`,"唤醒确认").then(()=>w.wake(n))},p=async n=>{const l=`确定要删除 ${n.length==1?n[0].name:n.length+"个设备"} 吗？`;await i.confirm(l,"删除确认"),await w.batchDelete(n),i.snackbar("删除成功"),await w.loadData()},w=r.MethodInterceptor.createAsyncActionProxy({async loadData(){await o()},async wake(n){await i.request(V.Wol.wakeWolDevice(n.id)),s[n.id]=!0},async batchDelete(n){await i.request(V.Wol.batchDelete(n.map(l=>l.id)))}},!1,m),x=n=>{var k;const l=i.openComponentDialog(j,{title:n?"编辑设备":"添加设备",props:{initObject:n||{uid:((k=a.desktopComponentConfig)==null?void 0:k.uid)||a.uid}},extraDialogOptions:{persistent:!0},async onConfirm(){return(await l.getInstAsForm().submit()).success?(i.snackbar(n?"保存成功":"添加成功"),w.loadData(),!0):!1}})};w.loadData();let u=!1,N=setInterval(async()=>{if(!(!a.autoRefresh||u||!c.value.find(n=>s[n.id])))try{u=!0,await o()}finally{u=!1}},5e3);return e.onUnmounted(()=>{N&&clearInterval(N)}),(n,l)=>{const k=e.resolveComponent("VBtn"),g=e.resolveComponent("CommonIcon"),D=e.resolveComponent("LoadingMask");return e.openBlock(),e.createElementBlock("div",q,[t.showAdd?(e.openBlock(),e.createBlock(k,{key:0,color:"primary",style:{"margin-right":"12px"},onClick:l[0]||(l[0]=C=>x())},{default:e.withCtx(()=>l[3]||(l[3]=[e.createTextVNode(" 添加设备 ")])),_:1})):e.createCommentVNode("",!0),e.createVNode(k,{onClick:e.unref(w).loadData},{default:e.withCtx(()=>[e.createVNode(g,{icon:"mdi-refresh"}),l[4]||(l[4]=e.createTextVNode(" 刷新 "))]),_:1},8,["onClick"]),e.createVNode(D,{loading:e.unref(d)},null,8,["loading"]),e.createElementVNode("div",P,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,C=>(e.openBlock(),e.createBlock(I,{key:C.id,style:{animation:"up-in .2s"},"wol-device":C,editable:t.editable,loading:s[C.id],onWake:y,onEdit:l[1]||(l[1]=f=>x(f)),onDelete:l[2]||(l[2]=f=>p([f]))},null,8,["wol-device","editable","loading"]))),128))])])}}});window.bootContext.addProcessor({taskName:"注册网络工具",execute(t,i){t.component("WolDeviceList",G),t.component("NetworkInterfaceList",W)}})});
