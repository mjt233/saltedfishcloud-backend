(function(e,C){typeof exports=="object"&&typeof module<"u"?C(require("vue"),require("sfc-common"),require("sfc-common/components")):typeof define=="function"&&define.amd?define(["vue","sfc-common","sfc-common/components"],C):(e=typeof globalThis<"u"?globalThis:e||self,C(e.Vue,e.SfcCommon,e.Components))})(this,function(e,C,x){"use strict";var B;(t=>{(n=>{function y(o,a){return{url:"/nwt/findWolByUid",params:{uid:o,checkOnline:!!a}}}n.findByUid=y;function r(o){return{url:"/nwt/saveWolDevice",method:"post",headers:{"Content-Type":"application/json"},data:o}}n.saveWolDevice=r;function k(o){return{url:"/nwt/wakeWolDevice",params:{id:o}}}n.wakeWolDevice=k;function g(o){return{url:"/nwt/batchDeleteWol",data:o,method:"post",headers:{"Content-Type":"application/json"}}}n.batchDelete=g})(t.Wol||(t.Wol={}));function d(){return{url:"/nwt/getAllInterface"}}t.getAllInterface=d,(n=>{function y(a){return{url:"/nwt/listUPnP",params:{forceCheckAlive:a||!1}}}n.listUPnP=y;function r(a,u){return{url:`/nwt/getUPnPIcon?usn=${a}&index=${u}`}}n.getUPnPIcon=r;function k(a,u){return{url:"/nwt/getUpnpServiceScpd",params:{usn:a,serviceType:u}}}n.getUpnpServiceScpd=k;function g(a){return C.useJsonBody({url:"/nwt/invokeUpnpService",method:"post",data:a})}n.invokeUpnpService=g;function o(a,u){return{url:"/nwt/castMedia",params:{usn:a,uri:u},method:"post"}}n.castMedia=o})(t.UPnP||(t.UPnP={}))})(B||(B={}));const F={class:"tip"},A={style:{"padding-left":"24px"}},W={style:{"padding-left":"24px"}},j=e.defineComponent({name:"NetworkInterfaceInfoCard"}),q=e.defineComponent({...j,props:{networkInterface:{type:Object,default:()=>({})}},setup(t){return(d,n)=>{const y=e.resolveComponent("VCardText"),r=e.resolveComponent("VCard");return e.openBlock(),e.createBlock(r,{class:"network-interface-info-card",title:t.networkInterface.name},{default:e.withCtx(()=>[e.createVNode(y,null,{default:e.withCtx(()=>[e.createElementVNode("div",F,[e.createElementVNode("div",null,"接口: "+e.toDisplayString(t.networkInterface.name),1),e.createElementVNode("div",null,"名称: "+e.toDisplayString(t.networkInterface.displayName),1),e.createElementVNode("div",null,"MAC: "+e.toDisplayString(t.networkInterface.mac),1),e.createElementVNode("div",null,[n[0]||(n[0]=e.createTextVNode(" IP地址: ")),e.createElementVNode("ul",A,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.networkInterface.ipList,k=>(e.openBlock(),e.createElementBlock("li",{key:k},e.toDisplayString(k),1))),128))])]),e.createElementVNode("div",null,[n[1]||(n[1]=e.createTextVNode(" 广播地址: ")),e.createElementVNode("ul",W,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.networkInterface.broadcastAddressList,k=>(e.openBlock(),e.createElementBlock("li",{key:k},e.toDisplayString(k),1))),128))])]),e.createElementVNode("div",null,"MTU: "+e.toDisplayString(t.networkInterface.mtu),1)])]),_:1})]),_:1},8,["title"])}}}),I=(t,d)=>{const n=t.__vccOpts||t;for(const[y,r]of d)n[y]=r;return n},R=I(q,[["__scopeId","data-v-5b95a363"]]),z={style:{display:"flex","flex-wrap":"wrap"}},G=e.defineComponent({name:"NetworkInterfaceList",components:{NetworkInterfaceInfoCard:R}}),J=e.defineComponent({...G,setup(t){const d=window.SfcUtils,n=new C.LoadingManager,y=n.getLoadingRef(),r=e.ref([]);return C.MethodInterceptor.createAsyncActionProxy({async loadData(){r.value=(await d.request(B.getAllInterface())).data.data}},!1,n).loadData(),(g,o)=>{const a=e.resolveComponent("LoadingMask");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(a,{loading:e.unref(y)},null,8,["loading"]),e.createElementVNode("div",z,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,u=>(e.openBlock(),e.createBlock(R,{key:u.name,style:{animation:"up-in .2s"},"network-interface":u},null,8,["network-interface"]))),128))])])}}}),K=["src"],H=e.defineComponent({name:"UpnpIcon"}),T=e.defineComponent({...H,props:{device:{type:Object,default:void 0},color:{type:String,default:void 0}},setup(t){const d=window.SfcUtils,n=t,y=e.ref(void 0),r=e.ref(!1);function k(){r.value=!0}e.onMounted(()=>{var a;const o=(a=n.device)==null?void 0:a.describe.device.iconList;if(o&&o.length>0){const u=o.findIndex(w=>{var _;return(_=w.mimetype)==null?void 0:_.includes("png")})!=-1;let c=0,s=0;o.forEach((w,_)=>{var f;if(u&&!((f=w.mimetype)!=null&&f.includes("png")))return;const l=w.height*w.width;l>c&&(c=l,s=_)}),y.value=d.getApiUrl(B.UPnP.getUPnPIcon(n.device.describe.device.udn,s))}});function g(o){const a=o.describe.device.deviceType;return a.startsWith("urn:schemas-upnp-org:device:InternetGatewayDevice")?"mdi-router-network":a.startsWith("urn:schemas-upnp-org:device:MediaRenderer")?"mdi-movie-play":a.startsWith("urn:schemas-upnp-org:device:MediaServer")?"mdi-play-network":a.startsWith("urn:schemas-upnp-org:device:Printer")?"mdi-printer-outline":a.startsWith("urn:schemas-upnp-org:device:DigitalSecurityCamera")||a.startsWith("urn:schemas-upnp-org:device:IPCamera")?"mdi-cctv":a.startsWith("urn:schemas-upnp-org:device:Scanner:1")?"mdi-scanner":"mdi-network"}return(o,a)=>{const u=e.resolveComponent("CommonIcon");return t.device?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[r.value?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(u,{key:0,size:"30",icon:g(t.device),color:t.color},null,8,["icon","color"])),y.value?e.withDirectives((e.openBlock(),e.createElementBlock("img",{key:1,src:y.value,width:"30",onLoad:k},null,40,K)),[[e.vShow,r.value]]):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0)}}}),Q={class:"upnp-device-selector"},X={class:"mt-4"},Y=["onClick"],Z={class:"ml-2 tip"},v={key:1,class:"tip ml-2 text-center"},ee=e.defineComponent({name:"UpnpDeviceSelector"}),te=e.defineComponent({...ee,props:{deviceType:{type:Array,default:void 0},autoRefresh:{type:Boolean,default:!0}},emits:["select"],setup(t,{emit:d}){const n=t,y=d,r=e.ref([]),k={async loadList(){const a=(await window.SfcUtils.request(B.UPnP.listUPnP())).data.data.filter(u=>n.deviceType?n.deviceType.includes(u.describe.device.deviceType):!0);return r.value=a,r.value}};let g,o=!1;return e.onMounted(()=>{k.loadList(),g=setInterval(async()=>{if(!o){o=!0;try{await k.loadList()}finally{o=!1}}},2e3)}),e.onUnmounted(()=>{g&&clearInterval(g)}),(a,u)=>{const c=e.resolveComponent("VProgressLinear"),s=e.resolveDirective("ripple");return e.openBlock(),e.createElementBlock("div",Q,[t.autoRefresh?(e.openBlock(),e.createBlock(c,{key:0,indeterminate:"",color:"primary"})):e.createCommentVNode("",!0),e.createElementVNode("div",X,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,w=>e.withDirectives((e.openBlock(),e.createElementBlock("div",{key:w.describe.device.udn,class:"d-flex align-center upnp-device-selector-item",onClick:_=>y("select",w)},[e.createVNode(T,{device:w,color:"primary"},null,8,["device"]),e.createElementVNode("span",Z,e.toDisplayString(w.describe.device.friendlyName),1)],8,Y)),[[s]])),128))]),t.autoRefresh?(e.openBlock(),e.createElementBlock("div",v," 正在搜索服务器网络中的多媒体播放设备... ")):e.createCommentVNode("",!0)])}}}),ne=I(te,[["__scopeId","data-v-8aa41ae7"]]),oe={class:"tip"},ae={class:"mt-2"},le={key:0},re=e.defineComponent({name:"UpnpServiceActionInvoke"}),ie=e.defineComponent({...re,props:{device:{type:Object,default:void 0},service:{type:Object,default:void 0}},setup(t,{expose:d}){const n=t,y=window.SfcUtils,r=new C.LoadingManager,k=r.getLoadingRef(),g=e.ref();let o=e.ref(),a=e.ref(""),u=e.ref([]),c=e.reactive({}),s;function w(m){var U,D,V;if(!m.variableRef)return[];if(m.variableRef.dataType!="i4"&&m.variableRef.dataType!="ui4")return[];const i=(U=m.variableRef.allowedValueRange)==null?void 0:U.maximum,p=(D=m.variableRef.allowedValueRange)==null?void 0:D.minimum,b=((V=m.variableRef.allowedValueRange)==null?void 0:V.step)===void 0?1:m.variableRef.allowedValueRange.step;return[N=>{if(N==null||N==="")return!0;if(i!==void 0&&N>i)return m.name+"不能大于"+i;if(p!==void 0&&N<p)return m.name+"不能小于"+p;if(new String(N).indexOf(".")!=-1)return m.name+"不能是小数";const S=parseInt(N);return S!=N?m.name+"只能输入数字":b&&S%b!=0?m.name+"只能是"+b+"的整数倍":!0}]}const _=C.MethodInterceptor.createAsyncActionProxy({async loadScpd(){var i;if(!n.device||!((i=n.service)!=null&&i.serviceType))return Promise.reject("缺少设备udn/usn 或 服务serviceType");s=(await y.request(B.UPnP.getUpnpServiceScpd(n.device.describe.device.udn,n.service.serviceType))).data.data;const m={};s.serviceStateTable.forEach(p=>{m[p.name]=p}),s.actionList.flatMap(p=>p.argumentList).filter(p=>p).forEach(p=>p.variableRef=m[p.relatedStateVariable]),o.value=s.actionList.map(p=>({title:p.name,value:p.name,actionObj:p})),a.value=o.value[0].value},async invokeUpnpService(){var b,U;const m=await g.value.validate();if(!m.valid){const D=m.errors.map(V=>V.errorMessages).join(". ");return Promise.reject(D)}const i=(await y.request(B.UPnP.invokeUpnpService({rootDeviceUSN:(b=n.device)==null?void 0:b.describe.device.udn,action:a.value,serviceType:(U=n.service)==null?void 0:U.serviceType,actionParams:u.value.filter(D=>D.direction=="in").map(D=>{const V=c[D.name];return{key:D.name,value:V??""}})}))).data.data,p=i.statusCode==200;return y.dialog({title:a.value,onCancel:()=>!0,onConfirm:()=>!0,children:()=>[e.h("p",{style:{color:p?"green":"red"}},p?"✔调用成功":"❌调用失败"),e.h("p",{class:"tip mt-2 mb-2"},"接口响应"),e.h("code",i.responseBody)],extraProps:{showConfirm:!1,cancelText:"关闭"}}),i}},!0,r);function l(m){u.value=m.actionObj.argumentList||[],Object.keys(c).forEach(i=>delete c[i]),u.value.filter(i=>{var p;return((p=i.variableRef)==null?void 0:p.defaultValue)!==void 0&&i.variableRef.defaultValue!==null}).forEach(i=>{var b,U;let p=c[i.name]=(b=i.variableRef)==null?void 0:b.defaultValue;((U=i.variableRef)==null?void 0:U.dataType)=="boolean"&&(p=p=="true"),c[i.name]=p})}function f(){return Object.assign({},c)}return e.onMounted(()=>_.loadScpd()),d({getParams:f,invokeUpnpService:_.invokeUpnpService}),(m,i)=>{var S,$;const p=e.resolveComponent("LoadingMask"),b=e.resolveComponent("VDivider"),U=e.resolveComponent("FormSelect"),D=e.resolveComponent("VCheckbox"),V=e.resolveComponent("TextInput"),N=e.resolveComponent("VForm");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(p,{loading:e.unref(k)},null,8,["loading"]),e.createElementVNode("div",oe,[e.createElementVNode("div",null,"设备: "+e.toDisplayString((S=t.device)==null?void 0:S.describe.device.friendlyName),1),e.createElementVNode("div",null,"服务: "+e.toDisplayString(($=t.service)==null?void 0:$.serviceType),1)]),e.createVNode(b,{class:"mt-2 mb-2"}),e.createVNode(N,{ref_key:"formRef",ref:g},{default:e.withCtx(()=>[e.createVNode(U,{modelValue:e.unref(a),"onUpdate:modelValue":i[0]||(i[0]=h=>e.isRef(a)?a.value=h:a=h),items:e.unref(o),label:"UPnP服务方法",onChange:l},null,8,["modelValue","items"]),e.createElementVNode("div",ae,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(u),h=>{var M,O;return e.openBlock(),e.createElementBlock(e.Fragment,{key:h.name},[h.direction=="in"?(e.openBlock(),e.createElementBlock("div",le,[((M=h.variableRef)==null?void 0:M.dataType)=="boolean"?(e.openBlock(),e.createBlock(D,{key:0,modelValue:e.unref(c)[h.name],"onUpdate:modelValue":L=>e.unref(c)[h.name]=L,label:h.name,color:"primary"},null,8,["modelValue","onUpdate:modelValue","label"])):(O=h.variableRef)!=null&&O.allowedValueList?(e.openBlock(),e.createBlock(U,{key:1,modelValue:e.unref(c)[h.name],"onUpdate:modelValue":L=>e.unref(c)[h.name]=L,items:h.variableRef.allowedValueList.map(L=>({title:L,value:L})),label:h.name,clearable:""},null,8,["modelValue","onUpdate:modelValue","items","label"])):(e.openBlock(),e.createBlock(V,{key:2,modelValue:e.unref(c)[h.name],"onUpdate:modelValue":L=>e.unref(c)[h.name]=L,label:h.name,rules:w(h)},null,8,["modelValue","onUpdate:modelValue","label","rules"]))])):e.createCommentVNode("",!0)],64)}),128))])]),_:1},512)])}}}),ce={class:"mt-3"},se={class:"ml-2"},de={key:0},me=["href"],pe=["href"],fe=["title"],ke={key:0},ue=["href"],ye={class:"mt-2"},Ve=e.defineComponent({name:"UpnpInfoCard"}),ge=e.defineComponent({...Ve,props:{},setup(t){const d=window.SfcUtils;let n=e.ref([]);const y={async loadUPnpList(c){const s=(await d.request(B.UPnP.listUPnP(c))).data.data;return n.value=s,s}},r=new C.LoadingManager,k=r.getLoadingRef(),g=C.MethodInterceptor.createAsyncActionProxy(y,!0,r);function o(c){return new URL(c).host}function a(c){var _,l;const s=[c.describe.device],w=[];for(;s.length>0;){const f=s.pop();(_=f==null?void 0:f.serviceList)==null||_.forEach(m=>w.push(m)),(l=f==null?void 0:f.deviceList)==null||l.forEach(m=>s.push(m))}return w}function u(c,s){const w=d.openComponentDialog(ie,{props:{device:c,service:s},title:"UPnP服务调用",extraDialogOptions:{persistent:!0,confirmText:"执行",cancelText:"关闭"},onConfirm(){return w.getComponentInstRef().invokeUpnpService(),!1}})}return e.onMounted(()=>{g.loadUPnpList()}),(c,s)=>{const w=e.resolveComponent("CommonIcon"),_=e.resolveComponent("VBtn"),l=e.resolveComponent("LoadingMask"),f=e.resolveComponent("VCardTitle"),m=e.resolveComponent("VCol"),i=e.resolveComponent("VRow"),p=e.resolveComponent("VDivider"),b=e.resolveComponent("VChip"),U=e.resolveComponent("VCardText"),D=e.resolveComponent("VCard");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(_,{color:"primary",onClick:s[0]||(s[0]=V=>e.unref(g).loadUPnpList(!0))},{default:e.withCtx(()=>[e.createVNode(w,{icon:"mdi-refresh"}),s[1]||(s[1]=e.createTextVNode(" 刷新 "))]),_:1}),e.createElementVNode("div",ce,[e.createVNode(l,{loading:e.unref(k)},null,8,["loading"]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n),V=>(e.openBlock(),e.createBlock(D,{key:V.describe.device.udn,style:{animation:"up-in .2s"},class:"mb-2"},{default:e.withCtx(()=>[e.createVNode(f,{color:"primary",title:V.describe.device.friendlyName,class:"d-flex"},{default:e.withCtx(()=>[e.createVNode(T,{device:V,color:"primary"},null,8,["device"]),e.createElementVNode("span",se,e.toDisplayString(V.describe.device.friendlyName),1)]),_:2},1032,["title"]),e.createVNode(U,null,{default:e.withCtx(()=>[e.createVNode(i,null,{default:e.withCtx(()=>[e.createVNode(m,null,{default:e.withCtx(()=>[e.createElementVNode("p",null,"设备型号名称: "+e.toDisplayString(V.describe.device.modelName),1),V.describe.device.modelURL?(e.openBlock(),e.createElementBlock("p",de,[s[2]||(s[2]=e.createTextVNode(" 设备型号页面: ")),e.createElementVNode("a",{target:"_blank",class:"link",href:V.describe.device.modelURL},e.toDisplayString(V.describe.device.modelURL),9,me)])):e.createCommentVNode("",!0),e.createElementVNode("p",null,"厂商: "+e.toDisplayString(V.describe.device.manufacturer),1),e.createElementVNode("p",null,[s[3]||(s[3]=e.createTextVNode("厂商主页: ")),e.createElementVNode("a",{target:"_blank",class:"link",href:V.describe.device.manufacturerURL},e.toDisplayString(V.describe.device.manufacturerURL),9,pe)])]),_:2},1024),e.createVNode(m,null,{default:e.withCtx(()=>[e.createElementVNode("p",null,"设备地址: "+e.toDisplayString(o(V.location)),1),e.createElementVNode("p",{title:V.describe.device.deviceType}," 设备类型: "+e.toDisplayString(V.describe.device.deviceType.split(":")[3]),9,fe),V.describe.device.presentationURL?(e.openBlock(),e.createElementBlock("p",ke,[s[4]||(s[4]=e.createTextVNode(" 管理页面: ")),e.createElementVNode("a",{target:"_blank",class:"link",href:V.describe.device.presentationURL},e.toDisplayString(V.describe.device.presentationURL),9,ue)])):e.createCommentVNode("",!0)]),_:2},1024)]),_:2},1024),e.createVNode(p),e.createElementVNode("div",ye,[s[5]||(s[5]=e.createTextVNode(" 包含服务: ")),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a(V),N=>(e.openBlock(),e.createBlock(b,{key:N.serviceId,color:"primary",title:N.serviceType,class:"mr-2",onClick:S=>u(V,N)},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(N.serviceType.split(":")[3]),1)]),_:2},1032,["title","onClick"]))),128))])]),_:2},1024)]),_:2},1024))),128))])])}}}),we={class:"d-flex justify-space-between"},Ce={class:"tip",style:{width:"calc(100% - 12px)","margin-left":"12px"}},he={class:"d-flex align-center"},_e=e.defineComponent({name:"WolDeviceCard"}),be=e.defineComponent({..._e,props:{wolDevice:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1},editable:{type:Boolean,default:!0}},emits:["wake","edit","delete"],setup(t,{emit:d}){const n=d;return(y,r)=>{const k=e.resolveComponent("LoadingMask"),g=e.resolveComponent("CommonIcon"),o=e.resolveComponent("VBtn"),a=e.resolveComponent("VCardText"),u=e.resolveComponent("VCard");return e.openBlock(),e.createBlock(u,{class:"wol-device-card"},{default:e.withCtx(()=>[e.createVNode(k,{loading:t.loading,type:"circular"},null,8,["loading"]),e.createVNode(a,null,{default:e.withCtx(()=>[e.createElementVNode("div",we,[e.createElementVNode("div",null,[e.createVNode(g,{icon:"mdi-laptop",color:t.wolDevice.isOnline?"primary":"",style:{"font-size":"32px"}},null,8,["color"])]),e.createElementVNode("div",Ce,[e.createElementVNode("div",he,[e.createTextVNode(" 设备名: "+e.toDisplayString(t.wolDevice.name)+" ",1),t.editable?(e.openBlock(),e.createBlock(g,{key:0,class:"link d-flex align-center",style:{"font-size":"10px","margin-left":"6px"},icon:"mdi-pencil",onClick:r[0]||(r[0]=c=>n("edit",t.wolDevice))})):e.createCommentVNode("",!0),t.editable?(e.openBlock(),e.createBlock(g,{key:1,class:"link d-flex align-center text-error",style:{"font-size":"10px","margin-left":"6px","--main-color":"var(--v-theme-error)"},icon:"mdi-close",onClick:r[1]||(r[1]=c=>n("delete",t.wolDevice))})):e.createCommentVNode("",!0)]),e.createElementVNode("div",null,"MAC: "+e.toDisplayString(t.wolDevice.mac),1),e.createElementVNode("div",null,"IP: "+e.toDisplayString(t.wolDevice.ip),1)]),e.createElementVNode("div",null,[t.wolDevice.isOnline?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(o,{key:0,style:{"margin-top":"6px"},icon:"mdi-power",color:"primary",onClick:r[2]||(r[2]=c=>n("wake",t.wolDevice))}))])])]),_:1})]),_:1})}}}),P=I(be,[["__scopeId","data-v-46224d94"]]),xe=e.defineComponent({name:"WolDeviceForm",components:{FormRow:x.FormRow,FormCol:x.FormCol,TextInput:x.TextInput}}),Ne=e.defineComponent({...xe,props:{initObject:{type:Object,default:void 0},readOnly:{type:Boolean,default:!1}},emits:["submit"],setup(t,{expose:d,emit:n}){const y=window.SfcUtils,r=e.ref(),k=t,g=C.defineForm({actions:{async submit(){return await y.request(B.Wol.saveWolDevice(o))}},formData:{name:"",port:9,ip:"",mac:"",sendIp:"255.255.255.255"},formRef:r,validators:{name:[C.Validators.notNull(),C.Validators.maxLen("不能大于255个字符",255)],mac:[C.Validators.isMatchRegex("^([abcdefABCDEF\\d]{2}[:\\-]?){6}$","不是有效的mac地址")],ip:[C.Validators.notNull(),C.Validators.isMatchRegex("^((2((5[0-5])|([0-4]\\d)))|([0-1]?\\d{1,2}))(\\.((2((5[0-5])|([0-4]\\d)))|([0-1]?\\d{1,2}))){3}$","不是有效的ipv4地址")],port:[C.Validators.minNum(1),C.Validators.maxNum(65535)]},throwError:!0}),{formData:o,actions:a,validators:u,loadingRef:c,loadingManager:s}=g,w=s.getLoadingRef();return k.initObject&&Object.assign(o,k.initObject),d(g),(_,l)=>{const f=e.resolveComponent("LoadingMask"),m=e.resolveComponent("base-form");return e.openBlock(),e.createBlock(m,{ref_key:"formRef",ref:r,"model-value":e.unref(o),"submit-action":e.unref(a).submit},{default:e.withCtx(()=>[e.createVNode(f,{loading:e.unref(w)},null,8,["loading"]),e.createVNode(e.unref(x.FormRow),null,{default:e.withCtx(()=>[e.createVNode(e.unref(x.FormCol),null,{default:e.withCtx(()=>[e.createVNode(e.unref(x.TextInput),{modelValue:e.unref(o).name,"onUpdate:modelValue":l[0]||(l[0]=i=>e.unref(o).name=i),label:"设备名称",rules:e.unref(u).name,placeholder:"起个名字吧~",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1}),e.createVNode(e.unref(x.FormCol),null,{default:e.withCtx(()=>[e.createVNode(e.unref(x.TextInput),{modelValue:e.unref(o).mac,"onUpdate:modelValue":l[1]||(l[1]=i=>e.unref(o).mac=i),label:"MAC地址",rules:e.unref(u).mac,placeholder:"关键参数",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1}),e.createVNode(e.unref(x.FormCol),null,{default:e.withCtx(()=>[e.createVNode(e.unref(x.TextInput),{modelValue:e.unref(o).port,"onUpdate:modelValue":l[2]||(l[2]=i=>e.unref(o).port=i),label:"端口(udp)",rules:e.unref(u).port,placeholder:"默认UDP端口-9",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1}),e.createVNode(e.unref(x.FormCol),null,{default:e.withCtx(()=>[e.createVNode(e.unref(x.TextInput),{modelValue:e.unref(o).ip,"onUpdate:modelValue":l[3]||(l[3]=i=>e.unref(o).ip=i),label:"IP地址(ipv4)",rules:e.unref(u).ip,placeholder:"用来检测是否在线",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1}),e.createVNode(e.unref(x.FormCol),{class:"mw-50"},{default:e.withCtx(()=>[e.createVNode(e.unref(x.TextInput),{modelValue:e.unref(o).sendIp,"onUpdate:modelValue":l[4]||(l[4]=i=>e.unref(o).sendIp=i),label:"发送/广播地址",rules:e.unref(u).ip,placeholder:"255.255.255.255",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1})]),_:1})]),_:1},8,["model-value","submit-action"])}}}),Be={class:"WolDeviceList"},Ue={style:{"margin-top":"12px"}},De=e.defineComponent({name:"WolDeviceList",components:{WolDeviceCard:P,LoadingMask:x.LoadingMask}}),Le=e.defineComponent({...De,props:{uid:{type:[String,Number],default:0},showAdd:{type:Boolean,default:!0},autoRefresh:{type:Boolean,default:!0},desktopComponentConfig:{type:Object,default:void 0},editable:{type:Boolean,default:!0}},setup(t){const d=window.SfcUtils,n=t,y=new C.LoadingManager,r=y.getLoadingRef(),k=e.ref([]),g=e.reactive({}),o=async()=>{var l;k.value=(await d.request(B.Wol.findByUid(((l=n.desktopComponentConfig)==null?void 0:l.uid)||n.uid,!0))).data.data||[],k.value.forEach(f=>{f.isOnline&&(g[f.id]=!1)})},a=async l=>{await d.confirm(`确定要唤醒设备${l.name}吗？`,"唤醒确认").then(()=>c.wake(l))},u=async l=>{const f=`确定要删除 ${l.length==1?l[0].name:l.length+"个设备"} 吗？`;await d.confirm(f,"删除确认"),await c.batchDelete(l),d.snackbar("删除成功"),await c.loadData()},c=C.MethodInterceptor.createAsyncActionProxy({async loadData(){await o()},async wake(l){await d.request(B.Wol.wakeWolDevice(l.id)),g[l.id]=!0},async batchDelete(l){await d.request(B.Wol.batchDelete(l.map(f=>f.id)))}},!1,y),s=l=>{var m;const f=d.openComponentDialog(Ne,{title:l?"编辑设备":"添加设备",props:{initObject:l||{uid:((m=n.desktopComponentConfig)==null?void 0:m.uid)||n.uid}},extraDialogOptions:{persistent:!0},async onConfirm(){return(await f.getInstAsForm().submit()).success?(d.snackbar(l?"保存成功":"添加成功"),c.loadData(),!0):!1}})};c.loadData();let w=!1,_=setInterval(async()=>{if(!(!n.autoRefresh||w||!k.value.find(l=>g[l.id])))try{w=!0,await o()}finally{w=!1}},5e3);return e.onUnmounted(()=>{_&&clearInterval(_)}),(l,f)=>{const m=e.resolveComponent("VBtn"),i=e.resolveComponent("CommonIcon");return e.openBlock(),e.createElementBlock("div",Be,[t.showAdd?(e.openBlock(),e.createBlock(m,{key:0,color:"primary",style:{"margin-right":"12px"},onClick:f[0]||(f[0]=p=>s())},{default:e.withCtx(()=>f[3]||(f[3]=[e.createTextVNode(" 添加设备 ")])),_:1})):e.createCommentVNode("",!0),e.createVNode(m,{onClick:e.unref(c).loadData},{default:e.withCtx(()=>[e.createVNode(i,{icon:"mdi-refresh"}),f[4]||(f[4]=e.createTextVNode(" 刷新 "))]),_:1},8,["onClick"]),e.createVNode(e.unref(x.LoadingMask),{loading:e.unref(r)},null,8,["loading"]),e.createElementVNode("div",Ue,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.value,p=>(e.openBlock(),e.createBlock(P,{key:p.id,style:{animation:"up-in .2s"},"wol-device":p,editable:t.editable,loading:g[p.id],onWake:a,onEdit:f[1]||(f[1]=b=>s(b)),onDelete:f[2]||(f[2]=b=>u([b]))},null,8,["wol-device","editable","loading"]))),128))])])}}});window.bootContext.addProcessor({taskName:"注册网络工具",execute(t,d){t.component("WolDeviceList",Le),t.component("NetworkInterfaceList",J),t.component("UpnpInfoCard",ge)}});const Se=new Set(["mp4","mkv","avi","mov","wmv","flv","webm","mpg","mpeg","m4v","3gp","vob","ts","rm","rmvb","asf","ogv","divx","xvid","h264","h265","hevc","swf","f4v","mts","m2ts","qt","mpv","mpe","m1v","m2v","3gpp","3g2","tp","mxf","dv","cam","m4p","m4b","vc1","anim","wm","ram","mpeg4","mpg4","mk3d","webm","ogv","jpg","jpeg","png","gif","bmp","wav","mp3","ogg","flac","ape","acc","m4a"]);function Ie(t){const d=t.split(".");if(d.length==1)return!1;const n=d.pop();return Se.has(n)}const E=window.context;E.menu.value.fileListMenu.push({name:"投屏",id:"nwt",items:[{title:"投屏",id:"nwt-cast-media",icon:"mdi-cast-variant",renderOn(t){return t.selectFileList.length==1&&E.session.value.user.role=="admin"&&Ie(t.selectFileList[0].name)},action(t){const d=window.SfcUtils.openComponentDialog(ne,{props:{deviceType:["urn:schemas-upnp-org:device:MediaRenderer:1"],async onSelect(n){const y=window.SfcUtils;d.beginLoading();try{const r=t.getFileUrl(t.selectFileList[0]);if(!r)throw new Error("无法创建该文件URL");const k=new URL(r);k.searchParams.get("token")||k.searchParams.set("token",E.session.value.token),await y.request(B.UPnP.castMedia(n.describe.device.udn,k.toString())),y.alert("投屏成功"),d.close()}catch(r){y.alert("投屏失败: "+r)}finally{d.closeLoading()}}},title:"多媒体投屏",showConfirm:!1})}}]})});
