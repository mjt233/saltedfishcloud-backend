(function(e,c){typeof exports=="object"&&typeof module<"u"?c(require("vue"),require("sfc-common"),require("sfc-common/components")):typeof define=="function"&&define.amd?define(["vue","sfc-common","sfc-common/components"],c):(e=typeof globalThis<"u"?globalThis:e||self,c(e.Vue,e.SfcCommon,e.Components))})(this,function(e,c,s){"use strict";var g;(t=>{(a=>{function f(o,w){return{url:"/nwt/findWolByUid",params:{uid:o,checkOnline:!!w}}}a.findByUid=f;function i(o){return{url:"/nwt/saveWolDevice",method:"post",headers:{"Content-Type":"application/json"},data:o}}a.saveWolDevice=i;function d(o){return{url:"/nwt/wakeWolDevice",params:{id:o}}}a.wakeWolDevice=d;function m(o){return{url:"/nwt/batchDeleteWol",data:o,method:"post",headers:{"Content-Type":"application/json"}}}a.batchDelete=m})(t.Wol||(t.Wol={}));function r(){return{url:"/nwt/getAllInterface"}}t.getAllInterface=r})(g||(g={}));const h={class:"tip"},_={style:{"padding-left":"24px"}},E={style:{"padding-left":"24px"}},L=e.defineComponent({name:"NetworkInterfaceInfoCard"}),O=e.defineComponent({...L,props:{networkInterface:{type:Object,default:()=>({})}},setup(t){return(r,a)=>{const f=e.resolveComponent("VCardText"),i=e.resolveComponent("VCard");return e.openBlock(),e.createBlock(i,{class:"network-interface-info-card",title:t.networkInterface.name},{default:e.withCtx(()=>[e.createVNode(f,null,{default:e.withCtx(()=>[e.createElementVNode("div",h,[e.createElementVNode("div",null,"接口: "+e.toDisplayString(t.networkInterface.name),1),e.createElementVNode("div",null,"名称: "+e.toDisplayString(t.networkInterface.displayName),1),e.createElementVNode("div",null,"MAC: "+e.toDisplayString(t.networkInterface.mac),1),e.createElementVNode("div",null,[a[0]||(a[0]=e.createTextVNode(" IP地址: ")),e.createElementVNode("ul",_,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.networkInterface.ipList,d=>(e.openBlock(),e.createElementBlock("li",{key:d},e.toDisplayString(d),1))),128))])]),e.createElementVNode("div",null,[a[1]||(a[1]=e.createTextVNode(" 广播地址: ")),e.createElementVNode("ul",E,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.networkInterface.broadcastAddressList,d=>(e.openBlock(),e.createElementBlock("li",{key:d},e.toDisplayString(d),1))),128))])]),e.createElementVNode("div",null,"MTU: "+e.toDisplayString(t.networkInterface.mtu),1)])]),_:1})]),_:1},8,["title"])}}}),B=(t,r)=>{const a=t.__vccOpts||t;for(const[f,i]of r)a[f]=i;return a},I=B(O,[["__scopeId","data-v-5b95a363"]]),$={style:{display:"flex","flex-wrap":"wrap"}},T=e.defineComponent({name:"NetworkInterfaceList",components:{NetworkInterfaceInfoCard:I}}),M=e.defineComponent({...T,setup(t){const r=window.SfcUtils,a=new c.LoadingManager,f=a.getLoadingRef(),i=e.ref([]);return c.MethodInterceptor.createAsyncActionProxy({async loadData(){i.value=(await r.request(g.getAllInterface())).data.data}},!1,a).loadData(),(m,o)=>{const w=e.resolveComponent("LoadingMask");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(w,{loading:e.unref(f)},null,8,["loading"]),e.createElementVNode("div",$,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,p=>(e.openBlock(),e.createBlock(I,{key:p.name,style:{animation:"up-in .2s"},"network-interface":p},null,8,["network-interface"]))),128))])])}}}),W={class:"d-flex justify-space-between"},F={class:"tip",style:{width:"calc(100% - 12px)","margin-left":"12px"}},U={class:"d-flex align-center"},S=e.defineComponent({name:"WolDeviceCard"}),A=e.defineComponent({...S,props:{wolDevice:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1},editable:{type:Boolean,default:!0}},emits:["wake","edit","delete"],setup(t,{emit:r}){const a=r;return(f,i)=>{const d=e.resolveComponent("LoadingMask"),m=e.resolveComponent("CommonIcon"),o=e.resolveComponent("VBtn"),w=e.resolveComponent("VCardText"),p=e.resolveComponent("VCard");return e.openBlock(),e.createBlock(p,{class:"wol-device-card"},{default:e.withCtx(()=>[e.createVNode(d,{loading:t.loading,type:"circular"},null,8,["loading"]),e.createVNode(w,null,{default:e.withCtx(()=>[e.createElementVNode("div",W,[e.createElementVNode("div",null,[e.createVNode(m,{icon:"mdi-laptop",color:t.wolDevice.isOnline?"primary":"",style:{"font-size":"32px"}},null,8,["color"])]),e.createElementVNode("div",F,[e.createElementVNode("div",U,[e.createTextVNode(" 设备名: "+e.toDisplayString(t.wolDevice.name)+" ",1),t.editable?(e.openBlock(),e.createBlock(m,{key:0,class:"link d-flex align-center",style:{"font-size":"10px","margin-left":"6px"},icon:"mdi-pencil",onClick:i[0]||(i[0]=y=>a("edit",t.wolDevice))})):e.createCommentVNode("",!0),t.editable?(e.openBlock(),e.createBlock(m,{key:1,class:"link d-flex align-center text-error",style:{"font-size":"10px","margin-left":"6px","--main-color":"var(--v-theme-error)"},icon:"mdi-close",onClick:i[1]||(i[1]=y=>a("delete",t.wolDevice))})):e.createCommentVNode("",!0)]),e.createElementVNode("div",null,"MAC: "+e.toDisplayString(t.wolDevice.mac),1),e.createElementVNode("div",null,"IP: "+e.toDisplayString(t.wolDevice.ip),1)]),e.createElementVNode("div",null,[t.wolDevice.isOnline?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(o,{key:0,style:{"margin-top":"6px"},icon:"mdi-power",color:"primary",onClick:i[2]||(i[2]=y=>a("wake",t.wolDevice))}))])])]),_:1})]),_:1})}}}),b=B(A,[["__scopeId","data-v-46224d94"]]),R=e.defineComponent({name:"WolDeviceForm",components:{FormRow:s.FormRow,FormCol:s.FormCol,TextInput:s.TextInput}}),j=e.defineComponent({...R,props:{initObject:{type:Object,default:void 0},readOnly:{type:Boolean,default:!1}},emits:["submit"],setup(t,{expose:r,emit:a}){const f=window.SfcUtils,i=e.ref(),d=t,m=c.defineForm({actions:{async submit(){return await f.request(g.Wol.saveWolDevice(o))}},formData:{name:"",port:9,ip:"",mac:"",sendIp:"255.255.255.255"},formRef:i,validators:{name:[c.Validators.notNull(),c.Validators.maxLen("不能大于255个字符",255)],mac:[c.Validators.isMatchRegex("^([abcdefABCDEF\\d]{2}[:\\-]?){6}$","不是有效的mac地址")],ip:[c.Validators.notNull(),c.Validators.isMatchRegex("^((2((5[0-5])|([0-4]\\d)))|([0-1]?\\d{1,2}))(\\.((2((5[0-5])|([0-4]\\d)))|([0-1]?\\d{1,2}))){3}$","不是有效的ipv4地址")],port:[c.Validators.minNum(1),c.Validators.maxNum(65535)]},throwError:!0}),{formData:o,actions:w,validators:p,loadingRef:y,loadingManager:C}=m,u=C.getLoadingRef();return d.initObject&&Object.assign(o,d.initObject),r(m),(N,n)=>{const l=e.resolveComponent("LoadingMask"),V=e.resolveComponent("base-form");return e.openBlock(),e.createBlock(V,{ref_key:"formRef",ref:i,"model-value":e.unref(o),"submit-action":e.unref(w).submit},{default:e.withCtx(()=>[e.createVNode(l,{loading:e.unref(u)},null,8,["loading"]),e.createVNode(e.unref(s.FormRow),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.FormCol),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.TextInput),{modelValue:e.unref(o).name,"onUpdate:modelValue":n[0]||(n[0]=k=>e.unref(o).name=k),label:"设备名称",rules:e.unref(p).name,placeholder:"起个名字吧~",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1}),e.createVNode(e.unref(s.FormCol),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.TextInput),{modelValue:e.unref(o).mac,"onUpdate:modelValue":n[1]||(n[1]=k=>e.unref(o).mac=k),label:"MAC地址",rules:e.unref(p).mac,placeholder:"关键参数",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1}),e.createVNode(e.unref(s.FormCol),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.TextInput),{modelValue:e.unref(o).port,"onUpdate:modelValue":n[2]||(n[2]=k=>e.unref(o).port=k),label:"端口(udp)",rules:e.unref(p).port,placeholder:"默认UDP端口-9",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1}),e.createVNode(e.unref(s.FormCol),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.TextInput),{modelValue:e.unref(o).ip,"onUpdate:modelValue":n[3]||(n[3]=k=>e.unref(o).ip=k),label:"IP地址(ipv4)",rules:e.unref(p).ip,placeholder:"用来检测是否在线",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1}),e.createVNode(e.unref(s.FormCol),{class:"mw-50"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.TextInput),{modelValue:e.unref(o).sendIp,"onUpdate:modelValue":n[4]||(n[4]=k=>e.unref(o).sendIp=k),label:"发送/广播地址",rules:e.unref(p).ip,placeholder:"255.255.255.255",readonly:t.readOnly},null,8,["modelValue","rules","readonly"])]),_:1})]),_:1})]),_:1},8,["model-value","submit-action"])}}}),q={class:"WolDeviceList"},P={style:{"margin-top":"12px"}},z=e.defineComponent({name:"WolDeviceList",components:{WolDeviceCard:b,LoadingMask:s.LoadingMask}}),G=e.defineComponent({...z,props:{uid:{type:[String,Number],default:0},showAdd:{type:Boolean,default:!0},autoRefresh:{type:Boolean,default:!0},desktopComponentConfig:{type:Object,default:void 0},editable:{type:Boolean,default:!0}},setup(t){const r=window.SfcUtils,a=t,f=new c.LoadingManager,i=f.getLoadingRef(),d=e.ref([]),m=e.reactive({}),o=async()=>{var n;d.value=(await r.request(g.Wol.findByUid(((n=a.desktopComponentConfig)==null?void 0:n.uid)||a.uid,!0))).data.data||[],d.value.forEach(l=>{l.isOnline&&(m[l.id]=!1)})},w=async n=>{await r.confirm(`确定要唤醒设备${n.name}吗？`,"唤醒确认").then(()=>y.wake(n))},p=async n=>{const l=`确定要删除 ${n.length==1?n[0].name:n.length+"个设备"} 吗？`;await r.confirm(l,"删除确认"),await y.batchDelete(n),r.snackbar("删除成功"),await y.loadData()},y=c.MethodInterceptor.createAsyncActionProxy({async loadData(){await o()},async wake(n){await r.request(g.Wol.wakeWolDevice(n.id)),m[n.id]=!0},async batchDelete(n){await r.request(g.Wol.batchDelete(n.map(l=>l.id)))}},!1,f),C=n=>{var V;const l=r.openComponentDialog(j,{title:n?"编辑设备":"添加设备",props:{initObject:n||{uid:((V=a.desktopComponentConfig)==null?void 0:V.uid)||a.uid}},extraDialogOptions:{persistent:!0},async onConfirm(){return(await l.getInstAsForm().submit()).success?(r.snackbar(n?"保存成功":"添加成功"),y.loadData(),!0):!1}})};y.loadData();let u=!1,N=setInterval(async()=>{if(!(!a.autoRefresh||u||!d.value.find(n=>m[n.id])))try{u=!0,await o()}finally{u=!1}},5e3);return e.onUnmounted(()=>{N&&clearInterval(N)}),(n,l)=>{const V=e.resolveComponent("VBtn"),k=e.resolveComponent("CommonIcon");return e.openBlock(),e.createElementBlock("div",q,[t.showAdd?(e.openBlock(),e.createBlock(V,{key:0,color:"primary",style:{"margin-right":"12px"},onClick:l[0]||(l[0]=x=>C())},{default:e.withCtx(()=>l[3]||(l[3]=[e.createTextVNode(" 添加设备 ")])),_:1})):e.createCommentVNode("",!0),e.createVNode(V,{onClick:e.unref(y).loadData},{default:e.withCtx(()=>[e.createVNode(k,{icon:"mdi-refresh"}),l[4]||(l[4]=e.createTextVNode(" 刷新 "))]),_:1},8,["onClick"]),e.createVNode(e.unref(s.LoadingMask),{loading:e.unref(i)},null,8,["loading"]),e.createElementVNode("div",P,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,x=>(e.openBlock(),e.createBlock(b,{key:x.id,style:{animation:"up-in .2s"},"wol-device":x,editable:t.editable,loading:m[x.id],onWake:w,onEdit:l[1]||(l[1]=D=>C(D)),onDelete:l[2]||(l[2]=D=>p([D]))},null,8,["wol-device","editable","loading"]))),128))])])}}});window.bootContext.addProcessor({taskName:"注册网络工具",execute(t,r){t.component("WolDeviceList",G),t.component("NetworkInterfaceList",M)}})});
