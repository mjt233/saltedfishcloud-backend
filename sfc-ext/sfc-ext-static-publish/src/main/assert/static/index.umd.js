(function(n,e){typeof exports=="object"&&typeof module!="undefined"?e(require("sfc-common"),require("vue")):typeof define=="function"&&define.amd?define(["sfc-common","vue"],e):(n=typeof globalThis!="undefined"?globalThis:n||self,e(n.SfcCommon,n.Vue))})(this,function(n,e){"use strict";var X=Object.defineProperty,Y=Object.defineProperties;var v=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var L=(n,e,s)=>e in n?X(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s,y=(n,e)=>{for(var s in e||(e={}))ee.call(e,s)&&L(n,s,e[s]);if($)for(var s of $(e))te.call(e,s)&&L(n,s,e[s]);return n},A=(n,e)=>Y(n,v(e));const s={prefix:"/staticPublish",save(u){return n.useJsonBody({url:`${this.prefix}/save`,data:u,method:"post"})},listSite(u){return{url:`${this.prefix}/listSite`,params:{uid:u},method:"get"}},deleteSite(u){return{url:`${this.prefix}/deleteSite`,params:{id:u},method:"post"}},getProperty(){return n.context.feature.value.staticPublish}},P={class:"tip"},U=e.createTextVNode(" \u6D4F\u89C8 "),T={key:0,class:"tip"},I=e.defineComponent({name:"StaticPublishRecordForm"}),R=e.defineComponent(A(y({},I),{props:{initObject:{type:Object,default:void 0},uid:{type:[String,Number],default:0}},emits:["submit"],setup(u,{expose:E,emit:i}){const c=u,B=e.ref(),N=window.SfcUtils,p=n.defineForm({actions:{submit(){}},formData:{siteName:"",accessWay:2,isEnableIndex:!1,isEnableFileList:!1,isNeedLogin:!1,loginUsername:"",loginPassword:"",path:"/"},formRef:B,validators:{siteName:[n.Validators.minLen("\u7AD9\u70B9\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",1),n.Validators.maxLen("\u7AD9\u70B9\u540D\u79F0\u4E0D\u80FD\u8D85\u8FC7255\u4E2A\u5B57\u7B26",255),a=>t.accessWay==1?n.Validators.isMatchRegex("^([0-9a-zA-Z]|\\-)*$","\u4E3B\u673A\u7AD9\u70B9\u540D\u79F0\u53EA\u80FD\u4F7F\u7528:\u6570\u5B57 \u5B57\u7B26 -")(a):!0],loginUsername:[n.Validators.maxLen("\u9A8C\u8BC1\u7528\u6237\u540D\u4E0D\u80FD\u8D85\u8FC732\u4E2A\u5B57\u7B26",32)],loginPassword:[n.Validators.maxLen("\u9A8C\u8BC1\u5BC6\u7801\u4E0D\u80FD\u8D85\u8FC7255\u4E2A\u5B57\u7B26",255)]},throwError:!0}),{formData:t,actions:h,validators:V,loadingRef:k,loadingManager:S}=p,F=s.getProperty(),x=async()=>{try{t.path=await N.selectPath({path:t.path,title:"\u9009\u62E9\u7AD9\u70B9\u90E8\u7F72\u8DEF\u5F84",uid:t.uid,readOnly:!0})}catch(a){a!="cancel"&&(console.error(a),N.snackbar(a))}},o=a=>a.accessWay==1?`${F.protocol}://${a.siteName}.${F.byHostSuffix}`:`${F.protocol}://${a.username||"[\u7528\u6237\u540D]"}.${F.byPathSuffix}/${a.siteName}`;return e.onMounted(()=>{c.initObject&&(Object.assign(t,c.initObject),c.initObject.uid==0&&!c.initObject.id&&(t.accessWay=1),t.loginUsername===null&&(t.loginUsername=""),t.loginPassword===null&&(t.loginPassword=""))}),E(p),(a,l)=>{const C=e.resolveComponent("TextInput"),m=e.resolveComponent("FormCol"),_=e.resolveComponent("VRadio"),D=e.resolveComponent("VRadioGroup"),f=e.resolveComponent("FormRow"),g=e.resolveComponent("VBtn"),r=e.resolveComponent("VSwitch"),b=e.resolveComponent("base-form");return e.openBlock(),e.createBlock(b,{ref_key:"formRef",ref:B,"model-value":e.unref(t),"submit-action":e.unref(h).submit},{default:e.withCtx(()=>[e.createVNode(f,null,{default:e.withCtx(()=>[e.createVNode(m,null,{default:e.withCtx(()=>[e.createVNode(C,{modelValue:e.unref(t).siteName,"onUpdate:modelValue":l[0]||(l[0]=d=>e.unref(t).siteName=d),label:"\u7AD9\u70B9\u540D\u79F0",rules:e.unref(V).siteName},null,8,["modelValue","rules"])]),_:1}),e.createVNode(m,{label:"\u8BBF\u95EE\u65B9\u5F0F"},{default:e.withCtx(()=>[e.createVNode(D,{modelValue:e.unref(t).accessWay,"onUpdate:modelValue":l[1]||(l[1]=d=>e.unref(t).accessWay=d),inline:"",color:"primary"},{default:e.withCtx(()=>{var d;return[e.createVNode(_,{value:1,label:"\u6309\u4E3B\u673A\u540D"}),e.createVNode(_,{disabled:((d=u.initObject)==null?void 0:d.uid)==0,value:2,label:"\u6309\u7528\u6237\u8DEF\u5F84"},null,8,["disabled"])]}),_:1},8,["modelValue"])]),_:1})]),_:1}),e.createVNode(f,null,{default:e.withCtx(()=>[e.createVNode(m,{label:"\u90E8\u7F72\u8DEF\u5F84"},{default:e.withCtx(()=>[e.createElementVNode("span",P,e.toDisplayString(e.unref(t).path),1),e.createVNode(g,{flat:"",onClick:x},{default:e.withCtx(()=>[U]),_:1})]),_:1})]),_:1}),e.createVNode(f,null,{default:e.withCtx(()=>[e.createVNode(m,{label:"\u542F\u7528index.html\u4E3B\u9875"},{default:e.withCtx(()=>[e.createVNode(r,{modelValue:e.unref(t).isEnableIndex,"onUpdate:modelValue":l[2]||(l[2]=d=>e.unref(t).isEnableIndex=d),color:"primary",label:e.unref(t).isEnableIndex?"\u5DF2\u542F\u7528":"\u5DF2\u505C\u7528"},null,8,["modelValue","label"])]),_:1}),e.createVNode(m,{label:"\u542F\u7528\u76EE\u5F55\u6D4F\u89C8"},{default:e.withCtx(()=>[e.createVNode(r,{modelValue:e.unref(t).isEnableFileList,"onUpdate:modelValue":l[3]||(l[3]=d=>e.unref(t).isEnableFileList=d),color:"primary",label:e.unref(t).isEnableFileList?"\u5DF2\u542F\u7528":"\u5DF2\u505C\u7528"},null,8,["modelValue","label"])]),_:1}),e.createVNode(m,{label:"\u542F\u7528\u8EAB\u4EFD\u9A8C\u8BC1"},{default:e.withCtx(()=>[e.unref(t).isNeedLogin?(e.openBlock(),e.createElementBlock("span",T,"\u5B89\u5168\u987B\u77E5: \u8BE5\u529F\u80FD\u57FA\u4E8E\u539F\u59CBHTTP\u8EAB\u4EFD\u9A8C\u8BC1\u673A\u5236\uFF0C\u7528\u6237\u8BBF\u95EE\u767B\u5F55\u65F6\uFF0C\u82E5\u4E0D\u91C7\u7528\u53EF\u4FE1\u7684HTTPS\u4F20\u8F93\u5219\u5B58\u5728\u4E2D\u95F4\u4EBA\u622A\u53D6\u7684\u53EF\u80FD\u3002\u4E14\u7528\u6237\u540D\u548C\u5BC6\u7801\u5728\u54B8\u9C7C\u4E91\u4E0A\u7684\u4FDD\u5B58\u672A\u7ECF\u6DF7\u6DC6\u6216\u52A0\u5BC6")):e.createCommentVNode("",!0),e.createVNode(r,{modelValue:e.unref(t).isNeedLogin,"onUpdate:modelValue":l[4]||(l[4]=d=>e.unref(t).isNeedLogin=d),color:"primary",label:e.unref(t).isNeedLogin?"\u5DF2\u542F\u7528":"\u5DF2\u505C\u7528"},null,8,["modelValue","label"])]),_:1})]),_:1}),e.unref(t).isNeedLogin?(e.openBlock(),e.createBlock(f,{key:0},{default:e.withCtx(()=>[e.createVNode(m,null,{default:e.withCtx(()=>[e.createVNode(C,{modelValue:e.unref(t).loginUsername,"onUpdate:modelValue":l[5]||(l[5]=d=>e.unref(t).loginUsername=d),label:"\u9A8C\u8BC1\u7528\u6237\u540D",rules:e.unref(V).loginUsername},null,8,["modelValue","rules"])]),_:1}),e.createVNode(m,null,{default:e.withCtx(()=>[e.createVNode(C,{modelValue:e.unref(t).loginPassword,"onUpdate:modelValue":l[6]||(l[6]=d=>e.unref(t).loginPassword=d),type:"password",label:"\u9A8C\u8BC1\u5BC6\u7801",rules:e.unref(V).loginPassword},null,8,["modelValue","rules"])]),_:1})]),_:1})):e.createCommentVNode("",!0),e.createVNode(f,null,{default:e.withCtx(()=>[e.createVNode(m,{label:"URL\u9884\u89C8"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o(e.unref(t))),1)]),_:1})]),_:1})]),_:1},8,["model-value","submit-action"])}}}));var ne="",O=(u,E)=>{const i=u.__vccOpts||u;for(const[c,B]of E)i[c]=B;return i};const j=u=>(e.pushScopeId("data-v-3bd31013"),u=u(),e.popScopeId(),u),M={class:"static-publish-site-list-view"},W={class:"list-top-btns",style:{margin:"12px 0"}},q=e.createTextVNode(" \u65B0\u589E\u7AD9\u70B9 "),H=e.createTextVNode(" \u5237\u65B0 "),G=j(()=>e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"\u7AD9\u70B9\u540D\u79F0"),e.createElementVNode("th",null,"\u90E8\u7F72\u8DEF\u5F84"),e.createElementVNode("th",null,"\u8BBF\u95EE\u65B9\u5F0F"),e.createElementVNode("th",null,"\u8BBF\u95EE\u5730\u5740"),e.createElementVNode("th",null,"\u64CD\u4F5C")])],-1)),z=["href"],J={class:"handle-btns"},Z=["href"],K=e.defineComponent({name:"StaticPublishSiteListView"}),Q=e.defineComponent(A(y({},K),{props:{uid:{type:[String,Number],default:0}},setup(u){const E=u,i=window.SfcUtils,c=new n.LoadingManager,B=c.getLoadingRef(),N={async loadList(){const o=await i.request(s.listSite(E.uid));return t.value=o.data.data,o},async save(o){return await i.request(s.save(o))},async delete(o){return await i.request(s.deleteSite(o))}},p=n.MethodInterceptor.createAsyncActionProxy(N,!0,c),t=e.ref([]),h=s.getProperty(),V=o=>o.accessWay==1?`${h.protocol}://${o.siteName}.${h.byHostSuffix}`:`${h.protocol}://${o.username}.${h.byPathSuffix}/${o.siteName}`,k=o=>{i.openComponentDialog(e.h("iframe",{src:V(o),style:{width:"80vw",height:"70vh",border:"none"}}),{extraDialogOptions:{maxWidth:"90vw",showConfirm:!1,cancelText:"\u5173\u95ED"},title:`\u7AD9\u70B9\u9884\u89C8: ${o.siteName}`})},S=o=>new Promise((a,l)=>{const C=i.openComponentDialog(R,{props:{initObject:o||{uid:E.uid}},title:o!=null&&o.siteName?`\u7F16\u8F91\u7AD9\u70B9: ${o.siteName}`:"\u65B0\u589E\u7AD9\u70B9",async onConfirm(){const m=C.getInstAsForm(),_=await m.validate();if(!_.valid)return i.snackbar(_.errors.map(f=>f.errorMessages).join(";")),!1;const D=m.getFormData();return a(D),console.info(D),!0}})}),F=async o=>{const a=await S(o);try{await p.save(a),i.snackbar("\u4FDD\u5B58\u6210\u529F")}catch(l){if(l!="cancel"){await F(a);return}}await p.loadList()},x=async o=>{await i.confirm(`\u786E\u5B9A\u8981\u5220\u9664\u7AD9\u70B9${o.siteName}\u5417\uFF1F`,"\u5220\u9664\u786E\u8BA4"),await p.delete(o.id),i.snackbar("\u5220\u9664\u6210\u529F"),await p.loadList()};return e.onMounted(()=>{p.loadList()}),(o,a)=>{const l=e.resolveComponent("CommonIcon"),C=e.resolveComponent("VBtn"),m=e.resolveComponent("LoadingMask"),_=e.resolveComponent("EmptyTip"),D=e.resolveComponent("VTable"),f=e.resolveComponent("VCardText"),g=e.resolveComponent("VCard");return e.openBlock(),e.createElementBlock("div",M,[e.createElementVNode("div",W,[e.createVNode(C,{color:"primary",style:{"margin-right":"12px"},onClick:a[0]||(a[0]=r=>F())},{default:e.withCtx(()=>[e.createVNode(l,{icon:"mdi-plus"}),q]),_:1}),e.createVNode(C,{onClick:a[1]||(a[1]=r=>e.unref(p).loadList())},{default:e.withCtx(()=>[e.createVNode(l,{icon:"mdi-refresh"}),H]),_:1})]),e.createVNode(m,{loading:e.unref(B)},null,8,["loading"]),e.createVNode(g,null,{default:e.withCtx(()=>[e.createVNode(f,null,{default:e.withCtx(()=>[t.value.length==0?(e.openBlock(),e.createBlock(_,{key:0})):(e.openBlock(),e.createBlock(D,{key:1},{default:e.withCtx(()=>[G,e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.value,r=>(e.openBlock(),e.createElementBlock("tr",{key:r.id},[e.createElementVNode("td",null,e.toDisplayString(r.siteName),1),e.createElementVNode("td",null,e.toDisplayString(r.path),1),e.createElementVNode("td",null,e.toDisplayString(r.accessWay==1?"\u6309\u4E3B\u673A\u540D":"\u6309\u7528\u6237\u8DEF\u5F84"),1),e.createElementVNode("td",null,[e.createElementVNode("a",{class:"link",href:V(r),target:"_blank"},e.toDisplayString(V(r)),9,z)]),e.createElementVNode("td",J,[e.createVNode(l,{class:"link",icon:"mdi-eye",title:"\u9884\u89C8",onClick:b=>k(r)},null,8,["onClick"]),e.createElementVNode("a",{href:V(r),target:"_blank",title:"\u8F6C\u8DF3"},[e.createVNode(l,{class:"link",icon:"mdi-link"})],8,Z),e.createVNode(l,{class:"link",icon:"mdi-pencil",title:"\u7F16\u8F91",onClick:b=>F(r)},null,8,["onClick"]),e.createVNode(l,{class:"link",icon:"mdi-close",title:"\u5220\u9664",color:"error",onClick:b=>x(r)},null,8,["onClick"])])]))),128))])]),_:1}))]),_:1})]),_:1})])}}}));var w=O(Q,[["__scopeId","data-v-3bd31013"]]);window.bootContext.addProcessor({taskName:"\u6CE8\u518Cstatic-publish\u7EC4\u4EF6",execute(u,E){u.component(w.name,w);const i=n.context.menu.value.boxMenu.find(c=>c.id=="shareAndCollection");i==null||i.items.push({id:"static-publish",title:"\u9759\u6001\u8D44\u6E90\u7AD9\u70B9",renderOn(c){return n.ConditionFunction.hasLogin(n.context)},action(c){c.title="\u9759\u6001\u8D44\u6E90\u7AD9\u70B9",c.currentComponent=e.h(w,{uid:n.context.session.value.user.id})}})}})});
