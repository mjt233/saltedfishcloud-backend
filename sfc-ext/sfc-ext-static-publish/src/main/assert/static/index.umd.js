(function(o,e){typeof exports=="object"&&typeof module!="undefined"?e(require("sfc-common"),require("vue")):typeof define=="function"&&define.amd?define(["sfc-common","vue"],e):(o=typeof globalThis!="undefined"?globalThis:o||self,e(o.SfcCommon,o.Vue))})(this,function(o,e){"use strict";var X=Object.defineProperty,Y=Object.defineProperties;var v=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var $=(o,e,u)=>e in o?X(o,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[e]=u,w=(o,e)=>{for(var u in e||(e={}))ee.call(e,u)&&$(o,u,e[u]);if(S)for(var u of S(e))te.call(e,u)&&$(o,u,e[u]);return o},k=(o,e)=>Y(o,v(e));const u={prefix:"/staticPublish",save(a){return o.useJsonBody({url:`${this.prefix}/save`,data:a,method:"post"})},listSite(a){return{url:`${this.prefix}/listSite`,params:{uid:a},method:"get"}},deleteSite(a){return{url:`${this.prefix}/deleteSite`,params:{id:a},method:"post"}},getProperty(){return o.context.feature.value.staticPublish}},L={class:"tip"},P=e.createTextVNode(" \u6D4F\u89C8 "),U={key:0,class:"tip"},T=e.defineComponent({name:"StaticPublishRecordForm"}),I=e.defineComponent(k(w({},T),{props:{initObject:{type:Object,default:void 0},uid:{type:[String,Number],default:0}},emits:["submit"],setup(a,{expose:F,emit:d}){const r=a,B=e.ref(),x=window.SfcUtils,E=o.defineForm({actions:{submit(){}},formData:{siteName:"",accessWay:2,isEnableIndex:!1,isEnableFileList:!1,isNeedLogin:!1,loginUsername:"",loginPassword:"",path:"/"},formRef:B,validators:{siteName:[o.Validators.minLen("\u7AD9\u70B9\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",1),o.Validators.maxLen("\u7AD9\u70B9\u540D\u79F0\u4E0D\u80FD\u8D85\u8FC7255\u4E2A\u5B57\u7B26",255),l=>t.accessWay==1?o.Validators.isMatchRegex("^([0-9a-zA-Z]|\\-)*$","\u4E3B\u673A\u7AD9\u70B9\u540D\u79F0\u53EA\u80FD\u4F7F\u7528:\u6570\u5B57 \u5B57\u7B26 -")(l):!0],loginUsername:[o.Validators.maxLen("\u9A8C\u8BC1\u7528\u6237\u540D\u4E0D\u80FD\u8D85\u8FC732\u4E2A\u5B57\u7B26",32)],loginPassword:[o.Validators.maxLen("\u9A8C\u8BC1\u5BC6\u7801\u4E0D\u80FD\u8D85\u8FC7255\u4E2A\u5B57\u7B26",255)]},throwError:!0}),{formData:t,actions:N,validators:f,loadingRef:y,loadingManager:A}=E,V=u.getProperty(),n=async()=>{try{t.path=await x.selectPath({path:t.path,title:"\u9009\u62E9\u7AD9\u70B9\u90E8\u7F72\u8DEF\u5F84",uid:t.uid,readOnly:!0})}catch(l){l!="cancel"&&(console.error(l),x.snackbar(l))}},p=l=>l.accessWay==1?`${V.protocol}://${l.siteName}.${V.byHostSuffix}`:`${V.protocol}://${l.username||"[\u7528\u6237\u540D]"}.${V.byPathSuffix}/${l.siteName}`;return e.onMounted(()=>{r.initObject&&(Object.assign(t,r.initObject),r.initObject.uid==0&&!r.initObject.id&&(t.accessWay=1),t.loginUsername===null&&(t.loginUsername=""),t.loginPassword===null&&(t.loginPassword=""))}),F(E),(l,i)=>{const C=e.resolveComponent("TextInput"),c=e.resolveComponent("FormCol"),_=e.resolveComponent("VRadio"),b=e.resolveComponent("VRadioGroup"),h=e.resolveComponent("FormRow"),m=e.resolveComponent("VBtn"),D=e.resolveComponent("VSwitch"),Q=e.resolveComponent("base-form");return e.openBlock(),e.createBlock(Q,{ref_key:"formRef",ref:B,"model-value":e.unref(t),"submit-action":e.unref(N).submit},{default:e.withCtx(()=>[e.createVNode(h,null,{default:e.withCtx(()=>[e.createVNode(c,null,{default:e.withCtx(()=>[e.createVNode(C,{modelValue:e.unref(t).siteName,"onUpdate:modelValue":i[0]||(i[0]=s=>e.unref(t).siteName=s),label:"\u7AD9\u70B9\u540D\u79F0",rules:e.unref(f).siteName},null,8,["modelValue","rules"])]),_:1}),e.createVNode(c,{label:"\u8BBF\u95EE\u65B9\u5F0F"},{default:e.withCtx(()=>[e.createVNode(b,{modelValue:e.unref(t).accessWay,"onUpdate:modelValue":i[1]||(i[1]=s=>e.unref(t).accessWay=s),inline:"",color:"primary"},{default:e.withCtx(()=>{var s;return[e.createVNode(_,{value:1,label:"\u6309\u4E3B\u673A\u540D"}),e.createVNode(_,{disabled:((s=a.initObject)==null?void 0:s.uid)==0,value:2,label:"\u6309\u7528\u6237\u8DEF\u5F84"},null,8,["disabled"])]}),_:1},8,["modelValue"])]),_:1})]),_:1}),e.createVNode(h,null,{default:e.withCtx(()=>[e.createVNode(c,{label:"\u90E8\u7F72\u8DEF\u5F84"},{default:e.withCtx(()=>[e.createElementVNode("span",L,e.toDisplayString(e.unref(t).path),1),e.createVNode(m,{flat:"",onClick:n},{default:e.withCtx(()=>[P]),_:1})]),_:1})]),_:1}),e.createVNode(h,null,{default:e.withCtx(()=>[e.createVNode(c,{label:"\u542F\u7528index.html\u4E3B\u9875"},{default:e.withCtx(()=>[e.createVNode(D,{modelValue:e.unref(t).isEnableIndex,"onUpdate:modelValue":i[2]||(i[2]=s=>e.unref(t).isEnableIndex=s),color:"primary",label:e.unref(t).isEnableIndex?"\u5DF2\u542F\u7528":"\u5DF2\u505C\u7528"},null,8,["modelValue","label"])]),_:1}),e.createVNode(c,{label:"\u542F\u7528\u76EE\u5F55\u6D4F\u89C8"},{default:e.withCtx(()=>[e.createVNode(D,{modelValue:e.unref(t).isEnableFileList,"onUpdate:modelValue":i[3]||(i[3]=s=>e.unref(t).isEnableFileList=s),color:"primary",label:e.unref(t).isEnableFileList?"\u5DF2\u542F\u7528":"\u5DF2\u505C\u7528"},null,8,["modelValue","label"])]),_:1}),e.createVNode(c,{label:"\u542F\u7528\u8EAB\u4EFD\u9A8C\u8BC1"},{default:e.withCtx(()=>[e.unref(t).isNeedLogin?(e.openBlock(),e.createElementBlock("span",U,"\u5B89\u5168\u987B\u77E5: \u8BE5\u529F\u80FD\u57FA\u4E8E\u539F\u59CBHTTP\u8EAB\u4EFD\u9A8C\u8BC1\u673A\u5236\uFF0C\u7528\u6237\u8BBF\u95EE\u767B\u5F55\u65F6\uFF0C\u82E5\u4E0D\u91C7\u7528\u53EF\u4FE1\u7684HTTPS\u4F20\u8F93\u5219\u5B58\u5728\u4E2D\u95F4\u4EBA\u622A\u53D6\u7684\u53EF\u80FD\u3002\u4E14\u7528\u6237\u540D\u548C\u5BC6\u7801\u5728\u54B8\u9C7C\u4E91\u4E0A\u7684\u4FDD\u5B58\u672A\u7ECF\u6DF7\u6DC6\u6216\u52A0\u5BC6")):e.createCommentVNode("",!0),e.createVNode(D,{modelValue:e.unref(t).isNeedLogin,"onUpdate:modelValue":i[4]||(i[4]=s=>e.unref(t).isNeedLogin=s),color:"primary",label:e.unref(t).isNeedLogin?"\u5DF2\u542F\u7528":"\u5DF2\u505C\u7528"},null,8,["modelValue","label"])]),_:1})]),_:1}),e.unref(t).isNeedLogin?(e.openBlock(),e.createBlock(h,{key:0},{default:e.withCtx(()=>[e.createVNode(c,null,{default:e.withCtx(()=>[e.createVNode(C,{modelValue:e.unref(t).loginUsername,"onUpdate:modelValue":i[5]||(i[5]=s=>e.unref(t).loginUsername=s),label:"\u9A8C\u8BC1\u7528\u6237\u540D",rules:e.unref(f).loginUsername},null,8,["modelValue","rules"])]),_:1}),e.createVNode(c,null,{default:e.withCtx(()=>[e.createVNode(C,{modelValue:e.unref(t).loginPassword,"onUpdate:modelValue":i[6]||(i[6]=s=>e.unref(t).loginPassword=s),type:"password",label:"\u9A8C\u8BC1\u5BC6\u7801",rules:e.unref(f).loginPassword},null,8,["modelValue","rules"])]),_:1})]),_:1})):e.createCommentVNode("",!0),e.createVNode(h,null,{default:e.withCtx(()=>[e.createVNode(c,{label:"URL\u9884\u89C8"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(p(e.unref(t))),1)]),_:1})]),_:1})]),_:1},8,["model-value","submit-action"])}}}));var oe="",R=(a,F)=>{const d=a.__vccOpts||a;for(const[r,B]of F)d[r]=B;return d};const O=a=>(e.pushScopeId("data-v-31088a5c"),a=a(),e.popScopeId(),a),j={class:"static-publish-site-list-view"},M={class:"list-top-btns",style:{margin:"12px 0"}},W=e.createTextVNode(" \u65B0\u589E\u7AD9\u70B9 "),q=e.createTextVNode(" \u5237\u65B0 "),H=O(()=>e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"\u7AD9\u70B9\u540D\u79F0"),e.createElementVNode("th",null,"\u90E8\u7F72\u8DEF\u5F84"),e.createElementVNode("th",null,"\u8BBF\u95EE\u65B9\u5F0F"),e.createElementVNode("th",null,"\u8BBF\u95EE\u5730\u5740"),e.createElementVNode("th",null,"\u64CD\u4F5C")])],-1)),G=["href"],z={class:"handle-btns"},J=["href"],Z=e.defineComponent({name:"StaticPublishSiteListView"}),K=e.defineComponent(k(w({},Z),{props:{uid:{type:[String,Number],default:0}},setup(a){const F=a,d=window.SfcUtils,r=new o.LoadingManager,B=r.getLoadingRef(),x={async loadList(){const n=await d.request(u.listSite(F.uid));return t.value=n.data.data,n},async save(n){return await d.request(u.save(n))},async delete(n){return await d.request(u.deleteSite(n))}},E=o.MethodInterceptor.createAsyncActionProxy(x,!0,r),t=e.ref([]),N=u.getProperty(),f=n=>n.accessWay==1?`${N.protocol}://${n.siteName}.${N.byHostSuffix}`:`${N.protocol}://${n.username}.${N.byPathSuffix}/${n.siteName}`,y=n=>{d.openComponentDialog(e.h("iframe",{src:f(n),style:{width:"80vw",height:"70vh",border:"none"}}),{extraDialogOptions:{maxWidth:"90vw",showConfirm:!1,cancelText:"\u5173\u95ED"},title:`\u7AD9\u70B9\u9884\u89C8: ${n.siteName}`})},A=n=>new Promise((p,l)=>{const i=d.openComponentDialog(I,{props:{initObject:n||{uid:F.uid}},title:n!=null&&n.siteName?`\u7F16\u8F91\u7AD9\u70B9: ${n.siteName}`:"\u65B0\u589E\u7AD9\u70B9",async onConfirm(){const C=i.getInstAsForm(),c=await C.validate();if(!c.valid)return d.snackbar(c.errors.map(b=>b.errorMessages).join(";")),!1;const _=C.getFormData();return p(_),console.info(_),!0}})}),V=async n=>{const p=await A(n);try{await E.save(p)}catch(l){if(l!="cancel"){await V(p);return}}await E.loadList()};return e.onMounted(()=>{E.loadList()}),(n,p)=>{const l=e.resolveComponent("CommonIcon"),i=e.resolveComponent("VBtn"),C=e.resolveComponent("LoadingMask"),c=e.resolveComponent("EmptyTip"),_=e.resolveComponent("VTable"),b=e.resolveComponent("VCardText"),h=e.resolveComponent("VCard");return e.openBlock(),e.createElementBlock("div",j,[e.createElementVNode("div",M,[e.createVNode(i,{color:"primary",style:{"margin-right":"12px"},onClick:p[0]||(p[0]=m=>V())},{default:e.withCtx(()=>[e.createVNode(l,{icon:"mdi-plus"}),W]),_:1}),e.createVNode(i,{onClick:p[1]||(p[1]=m=>e.unref(E).loadList())},{default:e.withCtx(()=>[e.createVNode(l,{icon:"mdi-refresh"}),q]),_:1})]),e.createVNode(C,{loading:e.unref(B)},null,8,["loading"]),e.createVNode(h,null,{default:e.withCtx(()=>[e.createVNode(b,null,{default:e.withCtx(()=>[t.value.length==0?(e.openBlock(),e.createBlock(c,{key:0})):(e.openBlock(),e.createBlock(_,{key:1},{default:e.withCtx(()=>[H,e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.value,m=>(e.openBlock(),e.createElementBlock("tr",{key:m.id},[e.createElementVNode("td",null,e.toDisplayString(m.siteName),1),e.createElementVNode("td",null,e.toDisplayString(m.path),1),e.createElementVNode("td",null,e.toDisplayString(m.accessWay==1?"\u6309\u4E3B\u673A\u540D":"\u6309\u7528\u6237\u8DEF\u5F84"),1),e.createElementVNode("td",null,[e.createElementVNode("a",{class:"link",href:f(m),target:"_blank"},e.toDisplayString(f(m)),9,G)]),e.createElementVNode("td",z,[e.createVNode(l,{class:"link",icon:"mdi-eye",title:"\u9884\u89C8",onClick:D=>y(m)},null,8,["onClick"]),e.createElementVNode("a",{href:f(m),target:"_blank",title:"\u8F6C\u8DF3"},[e.createVNode(l,{class:"link",icon:"mdi-link"})],8,J),e.createVNode(l,{class:"link",icon:"mdi-pencil",title:"\u7F16\u8F91",onClick:D=>V(m)},null,8,["onClick"]),e.createVNode(l,{class:"link",icon:"mdi-close",title:"\u5220\u9664",color:"error",onClick:D=>y(m)},null,8,["onClick"])])]))),128))])]),_:1}))]),_:1})]),_:1})])}}}));var g=R(K,[["__scopeId","data-v-31088a5c"]]);window.bootContext.addProcessor({taskName:"\u6CE8\u518Cstatic-publish\u7EC4\u4EF6",execute(a,F){a.component(g.name,g);const d=o.context.menu.value.boxMenu.find(r=>r.id=="shareAndCollection");d==null||d.items.push({id:"static-publish",title:"\u9759\u6001\u8D44\u6E90\u7AD9\u70B9",renderOn(r){return o.ConditionFunction.hasLogin(o.context)},action(r){r.title="\u9759\u6001\u8D44\u6E90\u7AD9\u70B9",r.currentComponent=e.h(g,{uid:o.context.session.value.user.id})}})}})});
