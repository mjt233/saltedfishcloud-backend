(function(n,e){typeof exports=="object"&&typeof module!="undefined"?e(require("sfc-common"),require("vue")):typeof define=="function"&&define.amd?define(["sfc-common","vue"],e):(n=typeof globalThis!="undefined"?globalThis:n||self,e(n.SfcCommon,n.Vue))})(this,function(n,e){"use strict";var Y=Object.defineProperty,v=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var L=(n,e,i)=>e in n?Y(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,A=(n,e)=>{for(var i in e||(e={}))te.call(e,i)&&L(n,i,e[i]);if($)for(var i of $(e))oe.call(e,i)&&L(n,i,e[i]);return n},k=(n,e)=>v(n,ee(e));const i={prefix:"/staticPublish",save(l){return n.useJsonBody({url:`${this.prefix}/save`,data:l,method:"post"})},listSite(l){return{url:`${this.prefix}/listSite`,params:{uid:l},method:"get"}},deleteSite(l){return{url:`${this.prefix}/deleteSite`,params:{id:l},method:"post"}},getProperty(){return n.context.feature.value.staticPublish}},P={class:"tip"},U=e.createTextVNode(" \u6D4F\u89C8 "),T={key:0,class:"tip"},R=e.defineComponent({name:"StaticPublishRecordForm"}),I=e.defineComponent(k(A({},R),{props:{initObject:{type:Object,default:void 0},uid:{type:[String,Number],default:0}},emits:["submit"],setup(l,{expose:C,emit:s}){const d=l,D=e.ref(),g=window.SfcUtils,f=e.computed(()=>i.getProperty().isEnableDirectRootPath),h=n.defineForm({actions:{submit(){}},formData:{siteName:"",accessWay:2,isEnableIndex:!1,isEnableFileList:!1,isNeedLogin:!1,loginUsername:"",loginPassword:"",path:"/"},formRef:D,validators:{siteName:[n.Validators.minLen("\u7AD9\u70B9\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",1),n.Validators.maxLen("\u7AD9\u70B9\u540D\u79F0\u4E0D\u80FD\u8D85\u8FC7255\u4E2A\u5B57\u7B26",255),a=>t.accessWay==1?n.Validators.isMatchRegex("^([0-9a-zA-Z]|\\-)*$","\u4E3B\u673A\u7AD9\u70B9\u540D\u79F0\u53EA\u80FD\u4F7F\u7528:\u6570\u5B57 \u5B57\u7B26 -")(a):!0],loginUsername:[n.Validators.maxLen("\u9A8C\u8BC1\u7528\u6237\u540D\u4E0D\u80FD\u8D85\u8FC732\u4E2A\u5B57\u7B26",32)],loginPassword:[n.Validators.maxLen("\u9A8C\u8BC1\u5BC6\u7801\u4E0D\u80FD\u8D85\u8FC7255\u4E2A\u5B57\u7B26",255)]},throwError:!0}),{formData:t,actions:B,validators:b,loadingRef:S,loadingManager:w}=h,F=i.getProperty(),o=async()=>{try{t.path=await g.selectPath({path:t.path,title:"\u9009\u62E9\u7AD9\u70B9\u90E8\u7F72\u8DEF\u5F84",uid:t.uid,readOnly:!0})}catch(a){a!="cancel"&&(console.error(a),g.snackbar(a))}},p=a=>a.accessWay==1?`${F.protocol}://${a.siteName}.${F.byHostSuffix}`:a.accessWay==2?`${F.protocol}://${a.username||"[\u7528\u6237\u540D]"}.${F.byPathSuffix}/${a.siteName}`:`${F.protocol}://${F.serverAddress}/${a.siteName}`;return e.onMounted(()=>{d.initObject&&(Object.assign(t,d.initObject),d.initObject.uid==0&&!d.initObject.id&&(t.accessWay=1),t.loginUsername===null&&(t.loginUsername=""),t.loginPassword===null&&(t.loginPassword=""))}),C(h),(a,u)=>{const V=e.resolveComponent("TextInput"),m=e.resolveComponent("FormCol"),E=e.resolveComponent("VRadio"),y=e.resolveComponent("VRadioGroup"),_=e.resolveComponent("FormRow"),c=e.resolveComponent("VBtn"),N=e.resolveComponent("VSwitch"),X=e.resolveComponent("base-form");return e.openBlock(),e.createBlock(X,{ref_key:"formRef",ref:D,"model-value":e.unref(t),"submit-action":e.unref(B).submit},{default:e.withCtx(()=>[e.createVNode(_,null,{default:e.withCtx(()=>[e.createVNode(m,null,{default:e.withCtx(()=>[e.createVNode(V,{modelValue:e.unref(t).siteName,"onUpdate:modelValue":u[0]||(u[0]=r=>e.unref(t).siteName=r),label:"\u7AD9\u70B9\u540D\u79F0",rules:e.unref(b).siteName},null,8,["modelValue","rules"])]),_:1}),e.createVNode(m,{label:"\u8BBF\u95EE\u65B9\u5F0F"},{default:e.withCtx(()=>[e.createVNode(y,{modelValue:e.unref(t).accessWay,"onUpdate:modelValue":u[1]||(u[1]=r=>e.unref(t).accessWay=r),inline:"",color:"primary"},{default:e.withCtx(()=>{var r;return[e.createVNode(E,{value:1,label:"\u6309\u4E3B\u673A\u540D"}),e.createVNode(E,{disabled:((r=l.initObject)==null?void 0:r.uid)==0,value:2,label:"\u6309\u7528\u6237\u8DEF\u5F84"},null,8,["disabled"]),e.createVNode(E,{disabled:!e.unref(f),value:3,label:"\u6309\u6839\u8DEF\u5F84"},null,8,["disabled"])]}),_:1},8,["modelValue"])]),_:1})]),_:1}),e.createVNode(_,null,{default:e.withCtx(()=>[e.createVNode(m,{label:"\u90E8\u7F72\u8DEF\u5F84"},{default:e.withCtx(()=>[e.createElementVNode("span",P,e.toDisplayString(e.unref(t).path),1),e.createVNode(c,{flat:"",onClick:o},{default:e.withCtx(()=>[U]),_:1})]),_:1})]),_:1}),e.createVNode(_,null,{default:e.withCtx(()=>[e.createVNode(m,{label:"\u542F\u7528index.html\u4E3B\u9875"},{default:e.withCtx(()=>[e.createVNode(N,{modelValue:e.unref(t).isEnableIndex,"onUpdate:modelValue":u[2]||(u[2]=r=>e.unref(t).isEnableIndex=r),color:"primary",label:e.unref(t).isEnableIndex?"\u5DF2\u542F\u7528":"\u5DF2\u505C\u7528"},null,8,["modelValue","label"])]),_:1}),e.createVNode(m,{label:"\u542F\u7528\u76EE\u5F55\u6D4F\u89C8"},{default:e.withCtx(()=>[e.createVNode(N,{modelValue:e.unref(t).isEnableFileList,"onUpdate:modelValue":u[3]||(u[3]=r=>e.unref(t).isEnableFileList=r),color:"primary",label:e.unref(t).isEnableFileList?"\u5DF2\u542F\u7528":"\u5DF2\u505C\u7528"},null,8,["modelValue","label"])]),_:1}),e.createVNode(m,{label:"\u542F\u7528\u8EAB\u4EFD\u9A8C\u8BC1"},{default:e.withCtx(()=>[e.unref(t).isNeedLogin?(e.openBlock(),e.createElementBlock("span",T,"\u5B89\u5168\u987B\u77E5: \u8BE5\u529F\u80FD\u57FA\u4E8E\u539F\u59CBHTTP\u8EAB\u4EFD\u9A8C\u8BC1\u673A\u5236\uFF0C\u7528\u6237\u8BBF\u95EE\u767B\u5F55\u65F6\uFF0C\u82E5\u4E0D\u91C7\u7528\u53EF\u4FE1\u7684HTTPS\u4F20\u8F93\u5219\u5B58\u5728\u4E2D\u95F4\u4EBA\u622A\u53D6\u7684\u53EF\u80FD\u3002\u4E14\u7528\u6237\u540D\u548C\u5BC6\u7801\u5728\u54B8\u9C7C\u4E91\u4E0A\u7684\u4FDD\u5B58\u672A\u7ECF\u6DF7\u6DC6\u6216\u52A0\u5BC6")):e.createCommentVNode("",!0),e.createVNode(N,{modelValue:e.unref(t).isNeedLogin,"onUpdate:modelValue":u[4]||(u[4]=r=>e.unref(t).isNeedLogin=r),color:"primary",label:e.unref(t).isNeedLogin?"\u5DF2\u542F\u7528":"\u5DF2\u505C\u7528"},null,8,["modelValue","label"])]),_:1})]),_:1}),e.unref(t).isNeedLogin?(e.openBlock(),e.createBlock(_,{key:0},{default:e.withCtx(()=>[e.createVNode(m,null,{default:e.withCtx(()=>[e.createVNode(V,{modelValue:e.unref(t).loginUsername,"onUpdate:modelValue":u[5]||(u[5]=r=>e.unref(t).loginUsername=r),label:"\u9A8C\u8BC1\u7528\u6237\u540D",rules:e.unref(b).loginUsername},null,8,["modelValue","rules"])]),_:1}),e.createVNode(m,null,{default:e.withCtx(()=>[e.createVNode(V,{modelValue:e.unref(t).loginPassword,"onUpdate:modelValue":u[6]||(u[6]=r=>e.unref(t).loginPassword=r),type:"password",label:"\u9A8C\u8BC1\u5BC6\u7801",rules:e.unref(b).loginPassword},null,8,["modelValue","rules"])]),_:1})]),_:1})):e.createCommentVNode("",!0),e.createVNode(_,null,{default:e.withCtx(()=>[e.createVNode(m,{label:"URL\u9884\u89C8"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(p(e.unref(t))),1)]),_:1})]),_:1})]),_:1},8,["model-value","submit-action"])}}}));var ne="",O=(l,C)=>{const s=l.__vccOpts||l;for(const[d,D]of C)s[d]=D;return s};const j=l=>(e.pushScopeId("data-v-3e80309e"),l=l(),e.popScopeId(),l),W={class:"static-publish-site-list-view"},M={class:"list-top-btns",style:{margin:"12px 0"}},q=e.createTextVNode(" \u65B0\u589E\u7AD9\u70B9 "),H=e.createTextVNode(" \u5237\u65B0 "),G=j(()=>e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"\u7AD9\u70B9\u540D\u79F0"),e.createElementVNode("th",null,"\u90E8\u7F72\u8DEF\u5F84"),e.createElementVNode("th",null,"\u8BBF\u95EE\u65B9\u5F0F"),e.createElementVNode("th",null,"\u8BBF\u95EE\u5730\u5740"),e.createElementVNode("th",null,"\u64CD\u4F5C")])],-1)),z=["href"],J={class:"handle-btns"},Z=["href"],K=e.defineComponent({name:"StaticPublishSiteListView"}),Q=e.defineComponent(k(A({},K),{props:{uid:{type:[String,Number],default:0}},setup(l){const C=l,s=window.SfcUtils,d=new n.LoadingManager,D=d.getLoadingRef(),g={async loadList(){const o=await s.request(i.listSite(C.uid));return h.value=o.data.data,o},async save(o){return await s.request(i.save(o))},async delete(o){return await s.request(i.deleteSite(o))}},f=n.MethodInterceptor.createAsyncActionProxy(g,!0,d),h=e.ref([]),t=i.getProperty(),B=o=>o.accessWay==1?`${t.protocol}://${o.siteName}.${t.byHostSuffix}`:o.accessWay==2?`${t.protocol}://${o.username}.${t.byPathSuffix}/${o.siteName}`:`${t.protocol}://${t.serverAddress}/${o.siteName}`,b=o=>{s.openComponentDialog(e.h("iframe",{src:B(o),style:{width:"80vw",height:"70vh",border:"none"}}),{extraDialogOptions:{maxWidth:"90vw",showConfirm:!1,cancelText:"\u5173\u95ED"},title:`\u7AD9\u70B9\u9884\u89C8: ${o.siteName}`})},S=o=>new Promise((p,a)=>{const u=s.openComponentDialog(I,{props:{initObject:o||{uid:C.uid}},title:o!=null&&o.siteName?`\u7F16\u8F91\u7AD9\u70B9: ${o.siteName}`:"\u65B0\u589E\u7AD9\u70B9",async onConfirm(){const V=u.getInstAsForm(),m=await V.validate();if(!m.valid)return s.snackbar(m.errors.map(y=>y.errorMessages).join(";")),!1;const E=V.getFormData();return p(E),console.info(E),!0}})}),w=async o=>{const p=await S(o);try{await f.save(p),s.snackbar("\u4FDD\u5B58\u6210\u529F")}catch(a){if(a!="cancel"){await w(p);return}}await f.loadList()},F=async o=>{await s.confirm(`\u786E\u5B9A\u8981\u5220\u9664\u7AD9\u70B9${o.siteName}\u5417\uFF1F`,"\u5220\u9664\u786E\u8BA4"),await f.delete(o.id),s.snackbar("\u5220\u9664\u6210\u529F"),await f.loadList()};return e.onMounted(()=>{f.loadList()}),(o,p)=>{const a=e.resolveComponent("CommonIcon"),u=e.resolveComponent("VBtn"),V=e.resolveComponent("LoadingMask"),m=e.resolveComponent("EmptyTip"),E=e.resolveComponent("VTable"),y=e.resolveComponent("VCardText"),_=e.resolveComponent("VCard");return e.openBlock(),e.createElementBlock("div",W,[e.createElementVNode("div",M,[e.createVNode(u,{color:"primary",style:{"margin-right":"12px"},onClick:p[0]||(p[0]=c=>w())},{default:e.withCtx(()=>[e.createVNode(a,{icon:"mdi-plus"}),q]),_:1}),e.createVNode(u,{onClick:p[1]||(p[1]=c=>e.unref(f).loadList())},{default:e.withCtx(()=>[e.createVNode(a,{icon:"mdi-refresh"}),H]),_:1})]),e.createVNode(V,{loading:e.unref(D)},null,8,["loading"]),e.createVNode(_,null,{default:e.withCtx(()=>[e.createVNode(y,null,{default:e.withCtx(()=>[h.value.length==0?(e.openBlock(),e.createBlock(m,{key:0})):(e.openBlock(),e.createBlock(E,{key:1},{default:e.withCtx(()=>[G,e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value,c=>(e.openBlock(),e.createElementBlock("tr",{key:c.id},[e.createElementVNode("td",null,e.toDisplayString(c.siteName),1),e.createElementVNode("td",null,e.toDisplayString(c.path),1),e.createElementVNode("td",null,e.toDisplayString(c.accessWay==1?"\u6309\u4E3B\u673A\u540D":c.accessWay==2?"\u6309\u7528\u6237\u8DEF\u5F84":"\u6309\u6839\u8DEF\u5F84"),1),e.createElementVNode("td",null,[e.createElementVNode("a",{class:"link",href:B(c),target:"_blank"},e.toDisplayString(B(c)),9,z)]),e.createElementVNode("td",J,[e.createVNode(a,{class:"link",icon:"mdi-eye",title:"\u9884\u89C8",onClick:N=>b(c)},null,8,["onClick"]),e.createElementVNode("a",{href:B(c),target:"_blank",title:"\u8F6C\u8DF3"},[e.createVNode(a,{class:"link",icon:"mdi-link"})],8,Z),e.createVNode(a,{class:"link",icon:"mdi-pencil",title:"\u7F16\u8F91",onClick:N=>w(c)},null,8,["onClick"]),e.createVNode(a,{class:"link",icon:"mdi-close",title:"\u5220\u9664",color:"error",onClick:N=>F(c)},null,8,["onClick"])])]))),128))])]),_:1}))]),_:1})]),_:1})])}}}));var x=O(Q,[["__scopeId","data-v-3e80309e"]]);window.bootContext.addProcessor({taskName:"\u6CE8\u518Cstatic-publish\u7EC4\u4EF6",execute(l,C){l.component(x.name,x);const s=n.context.menu.value.boxMenu.find(d=>d.id=="shareAndCollection");s==null||s.items.push({id:"static-publish",title:"\u9759\u6001\u8D44\u6E90\u7AD9\u70B9",renderOn(d){return n.ConditionFunction.hasLogin(n.context)},action(d){d.title="\u9759\u6001\u8D44\u6E90\u7AD9\u70B9",d.currentComponent=e.h(x,{uid:n.context.session.value.user.id})}})}})});
