(function(l,e){typeof exports=="object"&&typeof module<"u"?e(require("sfc-common"),require("vue")):typeof define=="function"&&define.amd?define(["sfc-common","vue"],e):(l=typeof globalThis<"u"?globalThis:l||self,e(l.SfcCommon,l.Vue))})(this,function(l,e){"use strict";const u={prefix:"/staticPublish",save(i){return l.useJsonBody({url:`${this.prefix}/save`,data:i,method:"post"})},listSite(i){return{url:`${this.prefix}/listSite`,params:{uid:i},method:"get"}},deleteSite(i){return{url:`${this.prefix}/deleteSite`,params:{id:i},method:"post"}},getProperty(){return l.getContext().feature.value.staticPublish},listStatus(){return{url:`${this.prefix}/listStatus`}}},T={class:"tip"},U={key:0,class:"tip"},D=e.defineComponent({name:"StaticPublishRecordForm"}),R=e.defineComponent({...D,props:{initObject:{type:Object,default:void 0},uid:{type:[String,Number],default:0}},emits:["submit"],setup(i,{expose:g,emit:r}){const c=e.ref(),V=i,y=window.SfcUtils,N=e.computed(()=>u.getProperty().isEnableDirectRootPath),m=l.defineForm({actions:{submit(){}},formData:{siteName:"",accessWay:2,isEnableIndex:!1,isEnableFileList:!1,isNeedLogin:!1,loginUsername:"",loginPassword:"",path:"/"},formRef:c,validators:{siteName:[l.Validators.minLen("站点名称不能为空",1),l.Validators.maxLen("站点名称不能超过255个字符",255),o=>t.accessWay==1?l.Validators.isMatchRegex("^([0-9a-zA-Z]|\\-)*$","主机站点名称只能使用:数字 字符 -")(o):!0],loginUsername:[l.Validators.maxLen("验证用户名不能超过32个字符",32)],loginPassword:[l.Validators.maxLen("验证密码不能超过255个字符",255)]},throwError:!0}),{formData:t,actions:b,validators:w,loadingRef:$,loadingManager:k}=m,_=u.getProperty(),n=async()=>{try{t.path=await y.selectPath({path:t.path,title:"选择站点部署路径",uid:t.uid,readOnly:!0})}catch(o){o!="cancel"&&(console.error(o),y.snackbar(o))}},s=o=>o.accessWay==1?`${_.protocol}://${o.siteName}.${_.byHostSuffix}`:o.accessWay==2?`${_.protocol}://${o.username||"[用户名]"}.${_.byPathSuffix}/${o.siteName}`:`${_.protocol}://${_.serverAddress}/${o.siteName}`;return e.onMounted(()=>{V.initObject&&(Object.assign(t,V.initObject),V.initObject.uid==0&&!V.initObject.id&&(t.accessWay=1),t.loginUsername===null&&(t.loginUsername=""),t.loginPassword===null&&(t.loginPassword=""))}),g(m),(o,a)=>{const C=e.resolveComponent("TextInput"),f=e.resolveComponent("FormCol"),x=e.resolveComponent("VRadio"),E=e.resolveComponent("VRadioGroup"),h=e.resolveComponent("FormRow"),p=e.resolveComponent("VBtn"),S=e.resolveComponent("VSwitch"),G=e.resolveComponent("base-form");return e.openBlock(),e.createBlock(G,{ref_key:"formRef",ref:c,"model-value":e.unref(t),"submit-action":e.unref(b).submit},{default:e.withCtx(()=>[e.createVNode(h,null,{default:e.withCtx(()=>[e.createVNode(f,null,{default:e.withCtx(()=>[e.createVNode(C,{modelValue:e.unref(t).siteName,"onUpdate:modelValue":a[0]||(a[0]=d=>e.unref(t).siteName=d),label:"站点名称",rules:e.unref(w).siteName},null,8,["modelValue","rules"])]),_:1}),e.createVNode(f,{label:"访问方式"},{default:e.withCtx(()=>[e.createVNode(E,{modelValue:e.unref(t).accessWay,"onUpdate:modelValue":a[1]||(a[1]=d=>e.unref(t).accessWay=d),inline:"",color:"primary"},{default:e.withCtx(()=>{var d;return[e.createVNode(x,{value:1,label:"按主机名"}),e.createVNode(x,{disabled:((d=i.initObject)==null?void 0:d.uid)==0,value:2,label:"按用户路径"},null,8,["disabled"]),e.createVNode(x,{disabled:!N.value,value:3,label:"按根路径"},null,8,["disabled"])]}),_:1},8,["modelValue"])]),_:1})]),_:1}),e.createVNode(h,null,{default:e.withCtx(()=>[e.createVNode(f,{label:"部署路径"},{default:e.withCtx(()=>[e.createElementVNode("span",T,e.toDisplayString(e.unref(t).path),1),e.createVNode(p,{flat:"",onClick:n},{default:e.withCtx(()=>a[7]||(a[7]=[e.createTextVNode(" 浏览 ")])),_:1})]),_:1})]),_:1}),e.createVNode(h,null,{default:e.withCtx(()=>[e.createVNode(f,{label:"启用index.html主页"},{default:e.withCtx(()=>[e.createVNode(S,{modelValue:e.unref(t).isEnableIndex,"onUpdate:modelValue":a[2]||(a[2]=d=>e.unref(t).isEnableIndex=d),color:"primary",label:e.unref(t).isEnableIndex?"已启用":"已停用"},null,8,["modelValue","label"])]),_:1}),e.createVNode(f,{label:"启用目录浏览"},{default:e.withCtx(()=>[e.createVNode(S,{modelValue:e.unref(t).isEnableFileList,"onUpdate:modelValue":a[3]||(a[3]=d=>e.unref(t).isEnableFileList=d),color:"primary",label:e.unref(t).isEnableFileList?"已启用":"已停用"},null,8,["modelValue","label"])]),_:1}),e.createVNode(f,{label:"启用身份验证"},{default:e.withCtx(()=>[e.unref(t).isNeedLogin?(e.openBlock(),e.createElementBlock("span",U,"安全须知: 该功能基于原始HTTP身份验证机制，用户访问登录时，若不采用可信的HTTPS传输则存在中间人截取的可能。且用户名和密码在咸鱼云上的保存未经混淆或加密")):e.createCommentVNode("",!0),e.createVNode(S,{modelValue:e.unref(t).isNeedLogin,"onUpdate:modelValue":a[4]||(a[4]=d=>e.unref(t).isNeedLogin=d),color:"primary",label:e.unref(t).isNeedLogin?"已启用":"已停用"},null,8,["modelValue","label"])]),_:1})]),_:1}),e.unref(t).isNeedLogin?(e.openBlock(),e.createBlock(h,{key:0},{default:e.withCtx(()=>[e.createVNode(f,null,{default:e.withCtx(()=>[e.createVNode(C,{modelValue:e.unref(t).loginUsername,"onUpdate:modelValue":a[5]||(a[5]=d=>e.unref(t).loginUsername=d),label:"验证用户名",rules:e.unref(w).loginUsername},null,8,["modelValue","rules"])]),_:1}),e.createVNode(f,null,{default:e.withCtx(()=>[e.createVNode(C,{modelValue:e.unref(t).loginPassword,"onUpdate:modelValue":a[6]||(a[6]=d=>e.unref(t).loginPassword=d),type:"password",label:"验证密码",rules:e.unref(w).loginPassword},null,8,["modelValue","rules"])]),_:1})]),_:1})):e.createCommentVNode("",!0),e.createVNode(h,null,{default:e.withCtx(()=>[e.createVNode(f,{label:"URL预览"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(s(e.unref(t))),1)]),_:1})]),_:1})]),_:1},8,["model-value","submit-action"])}}}),I={class:"static-publish-site-list-view"},M={class:"list-top-btns",style:{margin:"12px 0"}},F=["href"],O={class:"handle-btns"},j=["href"],A=e.defineComponent({name:"StaticPublishSiteListView"}),W=e.defineComponent({...A,props:{uid:{type:[String,Number],default:0}},setup(i){const g=i,r=window.SfcUtils,c=new l.LoadingManager,V=c.getLoadingRef(),y={async loadList(){const n=await r.request(u.listSite(g.uid));return m.value=n.data.data,n},async save(n){return await r.request(u.save(n))},async delete(n){return await r.request(u.deleteSite(n))}},N=l.MethodInterceptor.createAsyncActionProxy(y,!0,c),m=e.ref([]),t=u.getProperty(),b=n=>n.accessWay==1?`${t.protocol}://${n.siteName}.${t.byHostSuffix}`:n.accessWay==2?`${t.protocol}://${n.username}.${t.byPathSuffix}/${n.siteName}`:`${t.protocol}://${t.serverAddress}/${n.siteName}`,w=n=>{r.openComponentDialog(e.h("iframe",{src:b(n),style:{width:"80vw",height:"70vh",border:"none"}}),{extraDialogOptions:{maxWidth:"90vw",showConfirm:!1,cancelText:"关闭"},title:`站点预览: ${n.siteName}`})},$=n=>new Promise((s,o)=>{const a=r.openComponentDialog(R,{props:{initObject:n||{uid:g.uid}},title:n!=null&&n.siteName?`编辑站点: ${n.siteName}`:"新增站点",async onConfirm(){const C=a.getInstAsForm(),f=await C.validate();if(!f.valid)return r.snackbar(f.errors.map(E=>E.errorMessages).join(";")),!1;const x=C.getFormData();return s(x),!0}})}),k=async n=>{const s=await $(n);try{await N.save(s),r.snackbar("保存成功")}catch(o){if(o!="cancel"){await k(s);return}}await N.loadList()},_=async n=>{await r.confirm(`确定要删除站点${n.siteName}吗？`,"删除确认"),await N.delete(n.id),r.snackbar("删除成功"),await N.loadList()};return e.onMounted(()=>{N.loadList()}),(n,s)=>{const o=e.resolveComponent("CommonIcon"),a=e.resolveComponent("VBtn"),C=e.resolveComponent("LoadingMask"),f=e.resolveComponent("EmptyTip"),x=e.resolveComponent("VTable"),E=e.resolveComponent("VCardText"),h=e.resolveComponent("VCard");return e.openBlock(),e.createElementBlock("div",I,[e.createElementVNode("div",M,[e.createVNode(a,{color:"primary",style:{"margin-right":"12px"},onClick:s[0]||(s[0]=p=>k())},{default:e.withCtx(()=>[e.createVNode(o,{icon:"mdi-plus"}),s[2]||(s[2]=e.createTextVNode(" 新增站点 "))]),_:1}),e.createVNode(a,{onClick:s[1]||(s[1]=p=>e.unref(N).loadList())},{default:e.withCtx(()=>[e.createVNode(o,{icon:"mdi-refresh"}),s[3]||(s[3]=e.createTextVNode(" 刷新 "))]),_:1})]),e.createVNode(C,{loading:e.unref(V)},null,8,["loading"]),e.createVNode(h,null,{default:e.withCtx(()=>[e.createVNode(E,null,{default:e.withCtx(()=>[m.value.length==0?(e.openBlock(),e.createBlock(f,{key:0})):(e.openBlock(),e.createBlock(x,{key:1},{default:e.withCtx(()=>[s[4]||(s[4]=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"站点名称"),e.createElementVNode("th",null,"部署路径"),e.createElementVNode("th",null,"访问方式"),e.createElementVNode("th",null,"访问地址"),e.createElementVNode("th",null,"操作")])],-1)),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.value,p=>(e.openBlock(),e.createElementBlock("tr",{key:p.id},[e.createElementVNode("td",null,e.toDisplayString(p.siteName),1),e.createElementVNode("td",null,e.toDisplayString(p.path),1),e.createElementVNode("td",null,e.toDisplayString(p.accessWay==1?"按主机名":p.accessWay==2?"按用户路径":"按根路径"),1),e.createElementVNode("td",null,[e.createElementVNode("a",{class:"link",href:b(p),target:"_blank"},e.toDisplayString(b(p)),9,F)]),e.createElementVNode("td",O,[e.createVNode(o,{class:"link",icon:"mdi-eye",title:"预览",onClick:S=>w(p)},null,8,["onClick"]),e.createElementVNode("a",{href:b(p),target:"_blank",title:"转跳"},[e.createVNode(o,{class:"link",icon:"mdi-link"})],8,j),e.createVNode(o,{class:"link",icon:"mdi-pencil",title:"编辑",onClick:S=>k(p)},null,8,["onClick"]),e.createVNode(o,{class:"link",icon:"mdi-close",title:"删除",color:"error",onClick:S=>_(p)},null,8,["onClick"])])]))),128))])]),_:1}))]),_:1})]),_:1})])}}}),P=(i,g)=>{const r=i.__vccOpts||i;for(const[c,V]of g)r[c]=V;return r},L=P(W,[["__scopeId","data-v-72ee09ae"]]),q={class:"view-button-groups"},H=e.defineComponent({name:"StaticPublishSiteStatusListView"}),z=e.defineComponent({...H,props:{},setup(i){const g=window.SfcUtils,r=new l.LoadingManager,c=r.getLoadingRef(),V=l.MethodInterceptor.createAsyncActionProxy({async loadData(){const N=(await g.request(u.listStatus())).data.data;y.value=N}},!1,r),y=e.ref([]);return e.onMounted(()=>V.loadData()),(N,m)=>{const t=e.resolveComponent("LoadingMask"),b=e.resolveComponent("CommonIcon"),w=e.resolveComponent("VBtn"),$=e.resolveComponent("VTable"),k=e.resolveComponent("VCardText"),_=e.resolveComponent("VCard");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(t,{loading:e.unref(c)},null,8,["loading"]),e.createElementVNode("div",q,[e.createVNode(w,{onClick:e.unref(V).loadData},{default:e.withCtx(()=>[e.createVNode(b,{icon:"mdi-refresh"}),m[0]||(m[0]=e.createTextVNode(" 刷新 "))]),_:1},8,["onClick"])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.value,n=>(e.openBlock(),e.createBlock(_,{key:n.nodeInfo.id,class:"site-status-card"},{default:e.withCtx(()=>[e.createVNode(k,null,{default:e.withCtx(()=>[e.createVNode($,null,{default:e.withCtx(()=>[e.createElementVNode("tr",null,[m[1]||(m[1]=e.createElementVNode("td",null,"主机名",-1)),e.createElementVNode("td",null,e.toDisplayString(n.nodeInfo.host),1)]),e.createElementVNode("tr",null,[m[2]||(m[2]=e.createElementVNode("td",null,"服务端口",-1)),e.createElementVNode("td",null,e.toDisplayString(n.serverPort),1)]),e.createElementVNode("tr",null,[m[3]||(m[3]=e.createElementVNode("td",null,"状态",-1)),e.createElementVNode("td",null,[e.createElementVNode("span",{style:e.normalizeStyle({color:`rgb(var(--v-theme-${n.isRunning?"success":"danger"}))`})},e.toDisplayString(n.isRunning?"运行中":"已停止"),5),n.errorMsg?(e.openBlock(),e.createBlock(b,{key:0,class:"link",color:"warning",icon:"mdi-alert",onClick:s=>e.unref(g).alert(n.errorMsg,"错误信息")},null,8,["onClick"])):e.createCommentVNode("",!0)])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])}}}),B=P(z,[["__scopeId","data-v-c0e9c677"]]);window.bootContext.addProcessor({taskName:"注册static-publish组件",execute(i,g){i.component(L.name,L),i.component(B.name,B);const r=l.getContext().menu.value.boxMenu.find(c=>c.id=="shareAndCollection");r==null||r.items.push({id:"static-publish",title:"静态资源站点",renderOn(c){return l.ConditionFunction.hasLogin(l.getContext())},action(c){c.title="静态资源站点",c.currentComponent=e.h(L,{uid:l.getContext().session.value.user.id})}})}})});
