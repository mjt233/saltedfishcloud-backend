(function(n,e){typeof exports=="object"&&typeof module!="undefined"?e(require("sfc-common"),require("vue")):typeof define=="function"&&define.amd?define(["sfc-common","vue"],e):(n=typeof globalThis!="undefined"?globalThis:n||self,e(n.SfcCommon,n.Vue))})(this,function(n,e){"use strict";var ie=Object.defineProperty,re=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var T=(n,e,r)=>e in n?ie(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,k=(n,e)=>{for(var r in e||(e={}))ce.call(e,r)&&T(n,r,e[r]);if(I)for(var r of I(e))de.call(e,r)&&T(n,r,e[r]);return n},S=(n,e)=>re(n,ue(e));const r={prefix:"/staticPublish",save(l){return n.useJsonBody({url:`${this.prefix}/save`,data:l,method:"post"})},listSite(l){return{url:`${this.prefix}/listSite`,params:{uid:l},method:"get"}},deleteSite(l){return{url:`${this.prefix}/deleteSite`,params:{id:l},method:"post"}},getProperty(){return n.context.feature.value.staticPublish},listStatus(){return{url:`${this.prefix}/listStatus`}}},U={class:"tip"},R=e.createTextVNode(" \u6D4F\u89C8 "),M={key:0,class:"tip"},O=e.defineComponent({name:"StaticPublishRecordForm"}),j=e.defineComponent(S(k({},O),{props:{initObject:{type:Object,default:void 0},uid:{type:[String,Number],default:0}},emits:["submit"],setup(l,{expose:_,emit:s}){const u=l,C=e.ref(),N=window.SfcUtils,f=e.computed(()=>r.getProperty().isEnableDirectRootPath),B=n.defineForm({actions:{submit(){}},formData:{siteName:"",accessWay:2,isEnableIndex:!1,isEnableFileList:!1,isNeedLogin:!1,loginUsername:"",loginPassword:"",path:"/"},formRef:C,validators:{siteName:[n.Validators.minLen("\u7AD9\u70B9\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",1),n.Validators.maxLen("\u7AD9\u70B9\u540D\u79F0\u4E0D\u80FD\u8D85\u8FC7255\u4E2A\u5B57\u7B26",255),a=>t.accessWay==1?n.Validators.isMatchRegex("^([0-9a-zA-Z]|\\-)*$","\u4E3B\u673A\u7AD9\u70B9\u540D\u79F0\u53EA\u80FD\u4F7F\u7528:\u6570\u5B57 \u5B57\u7B26 -")(a):!0],loginUsername:[n.Validators.maxLen("\u9A8C\u8BC1\u7528\u6237\u540D\u4E0D\u80FD\u8D85\u8FC732\u4E2A\u5B57\u7B26",32)],loginPassword:[n.Validators.maxLen("\u9A8C\u8BC1\u5BC6\u7801\u4E0D\u80FD\u8D85\u8FC7255\u4E2A\u5B57\u7B26",255)]},throwError:!0}),{formData:t,actions:E,validators:D,loadingRef:x,loadingManager:b}=B,V=r.getProperty(),o=async()=>{try{t.path=await N.selectPath({path:t.path,title:"\u9009\u62E9\u7AD9\u70B9\u90E8\u7F72\u8DEF\u5F84",uid:t.uid,readOnly:!0})}catch(a){a!="cancel"&&(console.error(a),N.snackbar(a))}},m=a=>a.accessWay==1?`${V.protocol}://${a.siteName}.${V.byHostSuffix}`:a.accessWay==2?`${V.protocol}://${a.username||"[\u7528\u6237\u540D]"}.${V.byPathSuffix}/${a.siteName}`:`${V.protocol}://${V.serverAddress}/${a.siteName}`;return e.onMounted(()=>{u.initObject&&(Object.assign(t,u.initObject),u.initObject.uid==0&&!u.initObject.id&&(t.accessWay=1),t.loginUsername===null&&(t.loginUsername=""),t.loginPassword===null&&(t.loginPassword=""))}),_(B),(a,i)=>{const F=e.resolveComponent("TextInput"),p=e.resolveComponent("FormCol"),h=e.resolveComponent("VRadio"),w=e.resolveComponent("VRadioGroup"),g=e.resolveComponent("FormRow"),d=e.resolveComponent("VBtn"),y=e.resolveComponent("VSwitch"),se=e.resolveComponent("base-form");return e.openBlock(),e.createBlock(se,{ref_key:"formRef",ref:C,"model-value":e.unref(t),"submit-action":e.unref(E).submit},{default:e.withCtx(()=>[e.createVNode(g,null,{default:e.withCtx(()=>[e.createVNode(p,null,{default:e.withCtx(()=>[e.createVNode(F,{modelValue:e.unref(t).siteName,"onUpdate:modelValue":i[0]||(i[0]=c=>e.unref(t).siteName=c),label:"\u7AD9\u70B9\u540D\u79F0",rules:e.unref(D).siteName},null,8,["modelValue","rules"])]),_:1}),e.createVNode(p,{label:"\u8BBF\u95EE\u65B9\u5F0F"},{default:e.withCtx(()=>[e.createVNode(w,{modelValue:e.unref(t).accessWay,"onUpdate:modelValue":i[1]||(i[1]=c=>e.unref(t).accessWay=c),inline:"",color:"primary"},{default:e.withCtx(()=>{var c;return[e.createVNode(h,{value:1,label:"\u6309\u4E3B\u673A\u540D"}),e.createVNode(h,{disabled:((c=l.initObject)==null?void 0:c.uid)==0,value:2,label:"\u6309\u7528\u6237\u8DEF\u5F84"},null,8,["disabled"]),e.createVNode(h,{disabled:!e.unref(f),value:3,label:"\u6309\u6839\u8DEF\u5F84"},null,8,["disabled"])]}),_:1},8,["modelValue"])]),_:1})]),_:1}),e.createVNode(g,null,{default:e.withCtx(()=>[e.createVNode(p,{label:"\u90E8\u7F72\u8DEF\u5F84"},{default:e.withCtx(()=>[e.createElementVNode("span",U,e.toDisplayString(e.unref(t).path),1),e.createVNode(d,{flat:"",onClick:o},{default:e.withCtx(()=>[R]),_:1})]),_:1})]),_:1}),e.createVNode(g,null,{default:e.withCtx(()=>[e.createVNode(p,{label:"\u542F\u7528index.html\u4E3B\u9875"},{default:e.withCtx(()=>[e.createVNode(y,{modelValue:e.unref(t).isEnableIndex,"onUpdate:modelValue":i[2]||(i[2]=c=>e.unref(t).isEnableIndex=c),color:"primary",label:e.unref(t).isEnableIndex?"\u5DF2\u542F\u7528":"\u5DF2\u505C\u7528"},null,8,["modelValue","label"])]),_:1}),e.createVNode(p,{label:"\u542F\u7528\u76EE\u5F55\u6D4F\u89C8"},{default:e.withCtx(()=>[e.createVNode(y,{modelValue:e.unref(t).isEnableFileList,"onUpdate:modelValue":i[3]||(i[3]=c=>e.unref(t).isEnableFileList=c),color:"primary",label:e.unref(t).isEnableFileList?"\u5DF2\u542F\u7528":"\u5DF2\u505C\u7528"},null,8,["modelValue","label"])]),_:1}),e.createVNode(p,{label:"\u542F\u7528\u8EAB\u4EFD\u9A8C\u8BC1"},{default:e.withCtx(()=>[e.unref(t).isNeedLogin?(e.openBlock(),e.createElementBlock("span",M,"\u5B89\u5168\u987B\u77E5: \u8BE5\u529F\u80FD\u57FA\u4E8E\u539F\u59CBHTTP\u8EAB\u4EFD\u9A8C\u8BC1\u673A\u5236\uFF0C\u7528\u6237\u8BBF\u95EE\u767B\u5F55\u65F6\uFF0C\u82E5\u4E0D\u91C7\u7528\u53EF\u4FE1\u7684HTTPS\u4F20\u8F93\u5219\u5B58\u5728\u4E2D\u95F4\u4EBA\u622A\u53D6\u7684\u53EF\u80FD\u3002\u4E14\u7528\u6237\u540D\u548C\u5BC6\u7801\u5728\u54B8\u9C7C\u4E91\u4E0A\u7684\u4FDD\u5B58\u672A\u7ECF\u6DF7\u6DC6\u6216\u52A0\u5BC6")):e.createCommentVNode("",!0),e.createVNode(y,{modelValue:e.unref(t).isNeedLogin,"onUpdate:modelValue":i[4]||(i[4]=c=>e.unref(t).isNeedLogin=c),color:"primary",label:e.unref(t).isNeedLogin?"\u5DF2\u542F\u7528":"\u5DF2\u505C\u7528"},null,8,["modelValue","label"])]),_:1})]),_:1}),e.unref(t).isNeedLogin?(e.openBlock(),e.createBlock(g,{key:0},{default:e.withCtx(()=>[e.createVNode(p,null,{default:e.withCtx(()=>[e.createVNode(F,{modelValue:e.unref(t).loginUsername,"onUpdate:modelValue":i[5]||(i[5]=c=>e.unref(t).loginUsername=c),label:"\u9A8C\u8BC1\u7528\u6237\u540D",rules:e.unref(D).loginUsername},null,8,["modelValue","rules"])]),_:1}),e.createVNode(p,null,{default:e.withCtx(()=>[e.createVNode(F,{modelValue:e.unref(t).loginPassword,"onUpdate:modelValue":i[6]||(i[6]=c=>e.unref(t).loginPassword=c),type:"password",label:"\u9A8C\u8BC1\u5BC6\u7801",rules:e.unref(D).loginPassword},null,8,["modelValue","rules"])]),_:1})]),_:1})):e.createCommentVNode("",!0),e.createVNode(g,null,{default:e.withCtx(()=>[e.createVNode(p,{label:"URL\u9884\u89C8"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m(e.unref(t))),1)]),_:1})]),_:1})]),_:1},8,["model-value","submit-action"])}}}));var pe="",L=(l,_)=>{const s=l.__vccOpts||l;for(const[u,C]of _)s[u]=C;return s};const W=l=>(e.pushScopeId("data-v-3e80309e"),l=l(),e.popScopeId(),l),q={class:"static-publish-site-list-view"},H={class:"list-top-btns",style:{margin:"12px 0"}},z=e.createTextVNode(" \u65B0\u589E\u7AD9\u70B9 "),G=e.createTextVNode(" \u5237\u65B0 "),J=W(()=>e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"\u7AD9\u70B9\u540D\u79F0"),e.createElementVNode("th",null,"\u90E8\u7F72\u8DEF\u5F84"),e.createElementVNode("th",null,"\u8BBF\u95EE\u65B9\u5F0F"),e.createElementVNode("th",null,"\u8BBF\u95EE\u5730\u5740"),e.createElementVNode("th",null,"\u64CD\u4F5C")])],-1)),Z=["href"],K={class:"handle-btns"},Q=["href"],X=e.defineComponent({name:"StaticPublishSiteListView"}),Y=e.defineComponent(S(k({},X),{props:{uid:{type:[String,Number],default:0}},setup(l){const _=l,s=window.SfcUtils,u=new n.LoadingManager,C=u.getLoadingRef(),N={async loadList(){const o=await s.request(r.listSite(_.uid));return B.value=o.data.data,o},async save(o){return await s.request(r.save(o))},async delete(o){return await s.request(r.deleteSite(o))}},f=n.MethodInterceptor.createAsyncActionProxy(N,!0,u),B=e.ref([]),t=r.getProperty(),E=o=>o.accessWay==1?`${t.protocol}://${o.siteName}.${t.byHostSuffix}`:o.accessWay==2?`${t.protocol}://${o.username}.${t.byPathSuffix}/${o.siteName}`:`${t.protocol}://${t.serverAddress}/${o.siteName}`,D=o=>{s.openComponentDialog(e.h("iframe",{src:E(o),style:{width:"80vw",height:"70vh",border:"none"}}),{extraDialogOptions:{maxWidth:"90vw",showConfirm:!1,cancelText:"\u5173\u95ED"},title:`\u7AD9\u70B9\u9884\u89C8: ${o.siteName}`})},x=o=>new Promise((m,a)=>{const i=s.openComponentDialog(j,{props:{initObject:o||{uid:_.uid}},title:o!=null&&o.siteName?`\u7F16\u8F91\u7AD9\u70B9: ${o.siteName}`:"\u65B0\u589E\u7AD9\u70B9",async onConfirm(){const F=i.getInstAsForm(),p=await F.validate();if(!p.valid)return s.snackbar(p.errors.map(w=>w.errorMessages).join(";")),!1;const h=F.getFormData();return m(h),console.info(h),!0}})}),b=async o=>{const m=await x(o);try{await f.save(m),s.snackbar("\u4FDD\u5B58\u6210\u529F")}catch(a){if(a!="cancel"){await b(m);return}}await f.loadList()},V=async o=>{await s.confirm(`\u786E\u5B9A\u8981\u5220\u9664\u7AD9\u70B9${o.siteName}\u5417\uFF1F`,"\u5220\u9664\u786E\u8BA4"),await f.delete(o.id),s.snackbar("\u5220\u9664\u6210\u529F"),await f.loadList()};return e.onMounted(()=>{f.loadList()}),(o,m)=>{const a=e.resolveComponent("CommonIcon"),i=e.resolveComponent("VBtn"),F=e.resolveComponent("LoadingMask"),p=e.resolveComponent("EmptyTip"),h=e.resolveComponent("VTable"),w=e.resolveComponent("VCardText"),g=e.resolveComponent("VCard");return e.openBlock(),e.createElementBlock("div",q,[e.createElementVNode("div",H,[e.createVNode(i,{color:"primary",style:{"margin-right":"12px"},onClick:m[0]||(m[0]=d=>b())},{default:e.withCtx(()=>[e.createVNode(a,{icon:"mdi-plus"}),z]),_:1}),e.createVNode(i,{onClick:m[1]||(m[1]=d=>e.unref(f).loadList())},{default:e.withCtx(()=>[e.createVNode(a,{icon:"mdi-refresh"}),G]),_:1})]),e.createVNode(F,{loading:e.unref(C)},null,8,["loading"]),e.createVNode(g,null,{default:e.withCtx(()=>[e.createVNode(w,null,{default:e.withCtx(()=>[B.value.length==0?(e.openBlock(),e.createBlock(p,{key:0})):(e.openBlock(),e.createBlock(h,{key:1},{default:e.withCtx(()=>[J,e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.value,d=>(e.openBlock(),e.createElementBlock("tr",{key:d.id},[e.createElementVNode("td",null,e.toDisplayString(d.siteName),1),e.createElementVNode("td",null,e.toDisplayString(d.path),1),e.createElementVNode("td",null,e.toDisplayString(d.accessWay==1?"\u6309\u4E3B\u673A\u540D":d.accessWay==2?"\u6309\u7528\u6237\u8DEF\u5F84":"\u6309\u6839\u8DEF\u5F84"),1),e.createElementVNode("td",null,[e.createElementVNode("a",{class:"link",href:E(d),target:"_blank"},e.toDisplayString(E(d)),9,Z)]),e.createElementVNode("td",K,[e.createVNode(a,{class:"link",icon:"mdi-eye",title:"\u9884\u89C8",onClick:y=>D(d)},null,8,["onClick"]),e.createElementVNode("a",{href:E(d),target:"_blank",title:"\u8F6C\u8DF3"},[e.createVNode(a,{class:"link",icon:"mdi-link"})],8,Q),e.createVNode(a,{class:"link",icon:"mdi-pencil",title:"\u7F16\u8F91",onClick:y=>b(d)},null,8,["onClick"]),e.createVNode(a,{class:"link",icon:"mdi-close",title:"\u5220\u9664",color:"error",onClick:y=>V(d)},null,8,["onClick"])])]))),128))])]),_:1}))]),_:1})]),_:1})])}}}));var A=L(Y,[["__scopeId","data-v-3e80309e"]]),me="";const $=l=>(e.pushScopeId("data-v-41dd53c5"),l=l(),e.popScopeId(),l),v={class:"view-button-groups"},ee=e.createTextVNode(" \u5237\u65B0 "),te=$(()=>e.createElementVNode("td",null,"\u4E3B\u673A\u540D",-1)),oe=$(()=>e.createElementVNode("td",null,"\u670D\u52A1\u7AEF\u53E3",-1)),ne=$(()=>e.createElementVNode("td",null,"\u72B6\u6001",-1)),le=e.defineComponent({name:"StaticPublishSiteStatusListView"}),ae=e.defineComponent(S(k({},le),{props:{},setup(l){const _=window.SfcUtils,s=new n.LoadingManager,u=s.getLoadingRef(),C=n.MethodInterceptor.createAsyncActionProxy({async loadData(){const f=(await _.request(r.listStatus())).data.data;N.value=f}},!1,s),N=e.ref([]);return e.onMounted(()=>C.loadData()),(f,B)=>{const t=e.resolveComponent("LoadingMask"),E=e.resolveComponent("CommonIcon"),D=e.resolveComponent("VBtn"),x=e.resolveComponent("VTable"),b=e.resolveComponent("VCardText"),V=e.resolveComponent("VCard");return e.openBlock(),e.createElementBlock("div",null,[e.createVNode(t,{loading:e.unref(u)},null,8,["loading"]),e.createElementVNode("div",v,[e.createVNode(D,{onClick:e.unref(C).loadData},{default:e.withCtx(()=>[e.createVNode(E,{icon:"mdi-refresh"}),ee]),_:1},8,["onClick"])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(N.value,o=>(e.openBlock(),e.createBlock(V,{key:o.nodeInfo.id,class:"site-status-card"},{default:e.withCtx(()=>[e.createVNode(b,null,{default:e.withCtx(()=>[e.createVNode(x,null,{default:e.withCtx(()=>[e.createElementVNode("tr",null,[te,e.createElementVNode("td",null,e.toDisplayString(o.nodeInfo.host),1)]),e.createElementVNode("tr",null,[oe,e.createElementVNode("td",null,e.toDisplayString(o.serverPort),1)]),e.createElementVNode("tr",null,[ne,e.createElementVNode("td",null,[e.createElementVNode("span",{style:e.normalizeStyle({color:`rgb(var(--v-theme-${o.isRunning?"success":"danger"}))`})},e.toDisplayString(o.isRunning?"\u8FD0\u884C\u4E2D":"\u5DF2\u505C\u6B62"),5),o.errorMsg?(e.openBlock(),e.createBlock(E,{key:0,class:"link",color:"warning",icon:"mdi-alert",onClick:m=>e.unref(_).alert(o.errorMsg,"\u9519\u8BEF\u4FE1\u606F")},null,8,["onClick"])):e.createCommentVNode("",!0)])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])}}}));var P=L(ae,[["__scopeId","data-v-41dd53c5"]]);window.bootContext.addProcessor({taskName:"\u6CE8\u518Cstatic-publish\u7EC4\u4EF6",execute(l,_){l.component(A.name,A),l.component(P.name,P);const s=n.context.menu.value.boxMenu.find(u=>u.id=="shareAndCollection");s==null||s.items.push({id:"static-publish",title:"\u9759\u6001\u8D44\u6E90\u7AD9\u70B9",renderOn(u){return n.ConditionFunction.hasLogin(n.context)},action(u){u.title="\u9759\u6001\u8D44\u6E90\u7AD9\u70B9",u.currentComponent=e.h(A,{uid:n.context.session.value.user.id})}})}})});
