(function(n,e){typeof exports=="object"&&typeof module<"u"?e(require("sfc-common"),require("vue"),require("sfc-common/components")):typeof define=="function"&&define.amd?define(["sfc-common","vue","sfc-common/components"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.SfcCommon,n.Vue,n.Components))})(this,function(n,e,x){"use strict";const l={prefix:"/quickShare",feature:{isEnabled:"isEnabled",maxSize:"maxSize",effectiveDuration:"effectiveDuration"},featurePrefix:"quickshare",upload(f,o){const i=new FormData;return i.set("file",f),{url:`${this.prefix}/upload`,params:o,data:i,method:"post"}},getByCode(f){return{url:`${this.prefix}/getByCode`,params:{code:f}}},getShareFile(f){return{url:`${this.prefix}/getShareFile?id=${f}`}}},F={style:{width:"100%","max-width":"810px",margin:"0 auto",padding:"12px"}},U={style:{padding:"12px"}},q={class:"tip"},I={style:{padding:"12px"}},T=e.defineComponent({name:"QuickShareView",components:{CommonIcon:x.CommonIcon}}),h=e.defineComponent({...T,props:{},setup(f){const o=window.SfcUtils,i=e.ref("1"),c=e.ref(""),C=e.ref(""),w=e.ref(),y=e.ref(""),N=e.ref(),S=e.ref(),_=e.ref(),b=(o.getSystemFeature(l.featurePrefix,l.feature.maxSize)||512)*1024*1024,g={sendCode:[n.Validators.maxLen(null,20),n.Validators.minLen(null,1)],extractCode:[n.Validators.notNull()],file:[n.Validators.requireFile(),n.Validators.fileMaxSize(b)],message:[n.Validators.maxLen(null,255)]},k=async()=>{_.value.blur();const d=await S.value.validate();if(!d.valid){o.snackbar("校验失败:"+d.errors.map(s=>s.errorMessages).join(";"));return}const t=o.loadingDialog({msg:"正在获取分享信息"});try{const m=(await o.request(l.getByCode(c.value))).data.data;m.message?o.alert(m.message,"提取成功 - 留言").then(()=>o.openApiUrl(l.getShareFile(m.id))):o.openApiUrl(l.getShareFile(m.id))}catch(s){console.error(s),await o.alert("获取错误: "+s),_.value.focus()}finally{t.close()}},P=async()=>{const d=await N.value.validate();if(!d.valid){o.snackbar("校验失败:"+d.errors.map(a=>a.errorMessages).join(";"));return}const t=e.reactive({msg:"上传中"}),s=o.loadingDialog(t),m=l.upload(w.value,{code:C.value,message:y.value});m.onUploadProgress=a=>{t.msg="上传中..."+(a.loaded/a.total*100).toFixed(2)+"%"};try{const p=(await o.request(m)).data.data;let u="你的提取码为："+p;p!=C.value&&(u+="(提取码冲突，系统随机新生成)");const V=n.StringUtils.appendPath(location.origin,"/#/box/quick-share?code="+encodeURIComponent(p));o.openComponentDialog(e.h("div",null,[e.h("div",null,u),e.h("div",null,[e.h("span",null,"提取链接："),e.h("a",{class:"link",onClick:()=>{o.copyToClipboard(V),o.snackbar("复制成功")}},V)]),e.h("div",null,"或通过【百宝箱 - 文件极速传】功能中直接输入提取码提取")]),{showCancel:!1,title:"发送成功"})}catch(a){o.alert("发送失败: "+a),console.error(a)}finally{s.close()}},D=async()=>{var t;const d=(t=n.getContext().routeInfo.value.curr)==null?void 0:t.query;d&&d.code&&(c.value=decodeURIComponent(d.code))};return e.onMounted(()=>{D()}),(d,t)=>{const s=e.resolveComponent("v-tab"),m=e.resolveComponent("v-tabs"),a=e.resolveComponent("v-text-field"),p=e.resolveComponent("VBtn"),u=e.resolveComponent("VForm"),V=e.resolveComponent("VWindowItem"),z=e.resolveComponent("v-file-input"),E=e.resolveComponent("VTextarea"),B=e.resolveComponent("VWindow"),R=e.resolveComponent("VCardText"),A=e.resolveComponent("VCard");return e.openBlock(),e.createElementBlock("div",F,[e.createVNode(A,{title:"文件极速传"},{default:e.withCtx(()=>[e.createVNode(m,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=r=>i.value=r),color:"primary"},{default:e.withCtx(()=>[e.createVNode(s,{value:"1"},{default:e.withCtx(()=>[e.createVNode(e.unref(x.CommonIcon),{icon:"mdi-folder-download"}),t[8]||(t[8]=e.createTextVNode(" 接收文件 "))]),_:1}),e.createVNode(s,{value:"2"},{default:e.withCtx(()=>[e.createVNode(e.unref(x.CommonIcon),{icon:"mdi-send"}),t[9]||(t[9]=e.createTextVNode(" 发送文件 "))]),_:1})]),_:1},8,["modelValue"]),e.createVNode(R,null,{default:e.withCtx(()=>[e.createVNode(B,{modelValue:i.value,"onUpdate:modelValue":t[7]||(t[7]=r=>i.value=r)},{default:e.withCtx(()=>[e.createVNode(V,{value:"1"},{default:e.withCtx(()=>[e.createVNode(u,{ref_key:"extractFormRef",ref:S,onSubmit:t[2]||(t[2]=e.withModifiers(()=>{},["prevent"]))},{default:e.withCtx(()=>[e.createElementVNode("div",U,[e.createVNode(a,{ref_key:"extractInput",ref:_,modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=r=>c.value=r),clearable:"",label:"请输入文件提取码",color:"primary",rules:g.extractCode,variant:"underlined",onKeyup:e.withKeys(k,["enter"])},null,8,["modelValue","rules"]),e.createVNode(p,{color:"primary",style:{display:"block",width:"100%"},onClick:k},{default:e.withCtx(()=>t[10]||(t[10]=[e.createTextVNode(" 提取 ")])),_:1})])]),_:1},512)]),_:1}),e.createVNode(V,{value:"2"},{default:e.withCtx(()=>[e.createVNode(u,{ref_key:"sendFormRef",ref:N,onSubmit:t[6]||(t[6]=e.withModifiers(()=>{},["prevent"]))},{default:e.withCtx(()=>[e.createElementVNode("div",q,[e.createTextVNode(" 文件保留时长："+e.toDisplayString(e.unref(o).getSystemFeature(e.unref(l).featurePrefix,e.unref(l).feature.effectiveDuration)||30)+"分钟",1),t[11]||(t[11]=e.createElementVNode("br",null,null,-1)),e.createTextVNode(" 文件大小限制："+e.toDisplayString(e.unref(n.StringFormatter).toSize(b)),1)]),e.createElementVNode("div",I,[e.createVNode(z,{modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=r=>w.value=r),label:"请选择文件",rules:g.file,variant:"underlined"},null,8,["modelValue","rules"]),e.createVNode(a,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=r=>C.value=r),clearable:"",label:"请输入文件提取码",color:"primary",rules:g.sendCode,variant:"underlined"},null,8,["modelValue","rules"]),e.createVNode(E,{modelValue:y.value,"onUpdate:modelValue":t[5]||(t[5]=r=>y.value=r),style:{"margin-top":"12px"},rules:g.message,label:"留言",color:"primary",variant:"outlined"},null,8,["modelValue","rules"]),e.createVNode(p,{color:"primary",style:{display:"block",width:"100%"},onClick:P},{default:e.withCtx(()=>[e.createVNode(e.unref(x.CommonIcon),{icon:"mdi-send"}),t[12]||(t[12]=e.createTextVNode(" 发送，走你~ "))]),_:1})])]),_:1},512)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])}}}),M=window.SfcUtils;window.bootContext.addProcessor({taskName:"注册组件 - 文件快速传",execute(f){if(!M.getSystemFeature(l.featurePrefix,l.feature.isEnabled))return;f.component(h.name,h);const o=n.getContext().menu.value.boxMenu.find(c=>c.id=="shareAndCollection"),i={id:"quick-share",icon:"mdi-flash",title:"文件极速传",action(c){c.title="文件极速传",c.currentComponent="quick-share-view"}};o?o.items.push(i):n.getContext().menu.value.boxMenu.push({id:"shareAndCollection",name:"文件交流",items:[i]})}})});
