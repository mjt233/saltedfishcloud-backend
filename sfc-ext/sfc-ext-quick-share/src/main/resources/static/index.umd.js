(function(t,e){typeof exports=="object"&&typeof module!="undefined"?e(require("sfc-common"),require("vue")):typeof define=="function"&&define.amd?define(["sfc-common","vue"],e):(t=typeof globalThis!="undefined"?globalThis:t||self,e(t.SfcCommon,t.Vue))})(this,function(t,e){"use strict";var X=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var S=(t,e,n)=>e in t?X(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,k=(t,e)=>{for(var n in e||(e={}))v.call(e,n)&&S(t,n,e[n]);if(b)for(var n of b(e))ee.call(e,n)&&S(t,n,e[n]);return t},A=(t,e)=>Y(t,Z(e));const n={prefix:"/quickShare",feature:{isEnabled:"isEnabled",maxSize:"maxSize",effectiveDuration:"effectiveDuration"},featurePrefix:"quickshare",upload(m,a){const r=new FormData;return r.set("file",m),{url:`${this.prefix}/upload`,params:a,data:r,method:"post"}},getByCode(m){return{url:`${this.prefix}/getByCode`,params:{code:m}}},getShareFile(m){return{url:`${this.prefix}/getShareFile?id=${m}`}}},B={style:{width:"100%","max-width":"810px",margin:"0 auto",padding:"12px"}},U=e.createTextVNode(" \u63A5\u6536\u6587\u4EF6 "),q=e.createTextVNode(" \u53D1\u9001\u6587\u4EF6 "),T={style:{padding:"12px"}},I=e.createTextVNode(" \u63D0\u53D6 "),P={class:"tip"},M=e.createElementVNode("br",null,null,-1),z={style:{padding:"12px"}},R=e.createTextVNode(" \u53D1\u9001\uFF0C\u8D70\u4F60~ "),W=e.defineComponent({name:"QuickShareView",components:{CommonIcon:t.Components.CommonIcon}}),D=e.defineComponent(A(k({},W),{props:{},setup(m){const a=window.SfcUtils,r=e.ref("1"),c=e.ref(""),V=e.ref(""),x=e.ref([]),_=e.ref(""),g=e.ref(),w=e.ref(),h=e.ref(),j=512,y=(a.getSystemFeature(n.featurePrefix,n.feature.maxSize)||j)*1024*1024,C={sendCode:[t.Validators.maxLen(null,20),t.Validators.minLen(null,1)],extractCode:[t.Validators.notNull()],file:[t.Validators.requireFile(),t.Validators.fileMaxSize(y)],message:[t.Validators.maxLen(null,255)]},E=async()=>{h.value.blur();const i=await w.value.validate();if(!i.valid){a.snackbar("\u6821\u9A8C\u5931\u8D25:"+i.errors.map(u=>u.errorMessages).join(";"));return}const o=a.loadingDialog({msg:"\u6B63\u5728\u83B7\u53D6\u5206\u4EAB\u4FE1\u606F"});try{const d=(await a.request(n.getByCode(c.value))).data.data;d.message?a.alert(d.message,"\u63D0\u53D6\u6210\u529F - \u7559\u8A00").then(()=>a.openApiUrl(n.getShareFile(d.id))):a.openApiUrl(n.getShareFile(d.id))}catch(u){console.error(u),await a.alert("\u83B7\u53D6\u9519\u8BEF: "+u),h.value.focus()}finally{o.close()}},K=async()=>{const i=await g.value.validate();if(!i.valid){a.snackbar("\u6821\u9A8C\u5931\u8D25:"+i.errors.map(s=>s.errorMessages).join(";"));return}const o=e.reactive({msg:"\u4E0A\u4F20\u4E2D"}),u=a.loadingDialog(o),d=n.upload(x.value[0],{code:V.value,message:_.value});d.onUploadProgress=s=>{o.msg="\u4E0A\u4F20\u4E2D..."+(s.loaded/s.total*100).toFixed(2)+"%"};try{const p=(await a.request(d)).data.data;let f="\u4F60\u7684\u63D0\u53D6\u7801\u4E3A\uFF1A"+p;p!=V.value&&(f+="(\u63D0\u53D6\u7801\u51B2\u7A81\uFF0C\u7CFB\u7EDF\u968F\u673A\u65B0\u751F\u6210)");const F=t.StringUtils.appendPath(location.origin,"/#/box/quick-share?code="+encodeURIComponent(p));a.openComponentDialog(e.h("div",null,[e.h("div",null,f),e.h("div",null,[e.h("span",null,"\u63D0\u53D6\u94FE\u63A5\uFF1A"),e.h("a",{class:"link",onClick:()=>{a.copyToClipboard(F),a.snackbar("\u590D\u5236\u6210\u529F")}},F)]),e.h("div",null,"\u6216\u901A\u8FC7\u3010\u767E\u5B9D\u7BB1 - \u6587\u4EF6\u6781\u901F\u4F20\u3011\u529F\u80FD\u4E2D\u76F4\u63A5\u8F93\u5165\u63D0\u53D6\u7801\u63D0\u53D6")]),{showCancel:!1,title:"\u53D1\u9001\u6210\u529F"})}catch(s){a.alert("\u53D1\u9001\u5931\u8D25: "+s),console.error(s)}finally{u.close()}},L=async()=>{var o;const i=(o=t.context.routeInfo.value.curr)==null?void 0:o.query;i&&i.code&&(c.value=decodeURIComponent(i.code))};return e.onMounted(()=>{L()}),(i,o)=>{const u=e.resolveComponent("CommonIcon"),d=e.resolveComponent("v-tab"),s=e.resolveComponent("v-tabs"),p=e.resolveComponent("v-text-field"),f=e.resolveComponent("VBtn"),F=e.resolveComponent("VForm"),N=e.resolveComponent("VWindowItem"),Q=e.resolveComponent("v-file-input"),G=e.resolveComponent("VTextarea"),H=e.resolveComponent("VWindow"),J=e.resolveComponent("VCardText"),O=e.resolveComponent("VCard");return e.openBlock(),e.createElementBlock("div",B,[e.createVNode(O,{title:"\u6587\u4EF6\u6781\u901F\u4F20"},{default:e.withCtx(()=>[e.createVNode(s,{modelValue:r.value,"onUpdate:modelValue":o[0]||(o[0]=l=>r.value=l),color:"primary"},{default:e.withCtx(()=>[e.createVNode(d,{value:"1"},{default:e.withCtx(()=>[e.createVNode(u,{icon:"mdi-folder-download"}),U]),_:1}),e.createVNode(d,{value:"2"},{default:e.withCtx(()=>[e.createVNode(u,{icon:"mdi-send"}),q]),_:1})]),_:1},8,["modelValue"]),e.createVNode(J,null,{default:e.withCtx(()=>[e.createVNode(H,{modelValue:r.value,"onUpdate:modelValue":o[7]||(o[7]=l=>r.value=l)},{default:e.withCtx(()=>[e.createVNode(N,{value:"1"},{default:e.withCtx(()=>[e.createVNode(F,{ref_key:"extractFormRef",ref:w,onSubmit:o[2]||(o[2]=e.withModifiers(()=>{},["prevent"]))},{default:e.withCtx(()=>[e.createElementVNode("div",T,[e.createVNode(p,{ref_key:"extractInput",ref:h,modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=l=>c.value=l),clearable:"",label:"\u8BF7\u8F93\u5165\u6587\u4EF6\u63D0\u53D6\u7801",color:"primary",rules:C.extractCode,variant:"underlined",onKeyup:e.withKeys(E,["enter"])},null,8,["modelValue","rules","onKeyup"]),e.createVNode(f,{color:"primary",style:{display:"block",width:"100%"},onClick:E},{default:e.withCtx(()=>[I]),_:1})])]),_:1},512)]),_:1}),e.createVNode(N,{value:"2"},{default:e.withCtx(()=>[e.createVNode(F,{ref_key:"sendFormRef",ref:g,onSubmit:o[6]||(o[6]=e.withModifiers(()=>{},["prevent"]))},{default:e.withCtx(()=>[e.createElementVNode("div",P,[e.createTextVNode(" \u6587\u4EF6\u4FDD\u7559\u65F6\u957F\uFF1A"+e.toDisplayString(e.unref(a).getSystemFeature(e.unref(n).featurePrefix,e.unref(n).feature.effectiveDuration)||30)+"\u5206\u949F",1),M,e.createTextVNode(" \u6587\u4EF6\u5927\u5C0F\u9650\u5236\uFF1A"+e.toDisplayString(e.unref(t.StringFormatter).toSize(y)),1)]),e.createElementVNode("div",z,[e.createVNode(Q,{modelValue:e.unref(x),"onUpdate:modelValue":o[3]||(o[3]=l=>e.isRef(x)?x.value=l:null),label:"\u8BF7\u9009\u62E9\u6587\u4EF6",rules:C.file,variant:"underlined"},null,8,["modelValue","rules"]),e.createVNode(p,{modelValue:V.value,"onUpdate:modelValue":o[4]||(o[4]=l=>V.value=l),clearable:"",label:"\u8BF7\u8F93\u5165\u6587\u4EF6\u63D0\u53D6\u7801",color:"primary",rules:C.sendCode,variant:"underlined"},null,8,["modelValue","rules"]),e.createVNode(G,{modelValue:_.value,"onUpdate:modelValue":o[5]||(o[5]=l=>_.value=l),style:{"margin-top":"12px"},rules:C.message,label:"\u7559\u8A00",color:"primary",variant:"outlined"},null,8,["modelValue","rules"]),e.createVNode(f,{color:"primary",style:{display:"block",width:"100%"},onClick:K},{default:e.withCtx(()=>[e.createVNode(u,{icon:"mdi-send"}),R]),_:1})])]),_:1},512)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])}}})),$=window.SfcUtils;window.bootContext.addProcessor({taskName:"\u6CE8\u518C\u7EC4\u4EF6 - \u6587\u4EF6\u5FEB\u901F\u4F20",execute(m){if(!$.getSystemFeature(n.featurePrefix,n.feature.isEnabled))return;m.component(D.name,D);const a=t.context.menu.value.boxMenu.find(c=>c.id=="shareAndCollection"),r={id:"quick-share",icon:"mdi-flash",title:"\u6587\u4EF6\u6781\u901F\u4F20",action(c){c.title="\u6587\u4EF6\u6781\u901F\u4F20",c.currentComponent="quick-share-view"}};a?a.items.push(r):t.context.menu.value.boxMenu.push({id:"shareAndCollection",name:"\u6587\u4EF6\u4EA4\u6D41",items:[r]})}})});
