(function(t,B){typeof exports=="object"&&typeof module!="undefined"?B(require("vue"),require("sfc-common")):typeof define=="function"&&define.amd?define(["vue","sfc-common"],B):(t=typeof globalThis!="undefined"?globalThis:t||self,B(t.Vue,t.SfcCommon))})(this,function(t,B){"use strict";var ua=Object.defineProperty,ha=Object.defineProperties;var pa=Object.getOwnPropertyDescriptors;var Qe=Object.getOwnPropertySymbols;var ma=Object.prototype.hasOwnProperty,va=Object.prototype.propertyIsEnumerable;var et=(t,B,T)=>B in t?ua(t,B,{enumerable:!0,configurable:!0,writable:!0,value:T}):t[B]=T,R=(t,B)=>{for(var T in B||(B={}))ma.call(B,T)&&et(t,T,B[T]);if(Qe)for(var T of Qe(B))va.call(B,T)&&et(t,T,B[T]);return t},M=(t,B)=>ha(t,pa(B));const T=t.defineComponent({name:"SubtitleSelector"}),tt=t.defineComponent(M(R({},T),{props:{subtitleList:{type:Array,default:()=>[]}},setup(e){const n=e;return(a,r)=>{const i=t.resolveComponent("v-radio"),s=t.resolveComponent("v-radio-group");return t.openBlock(),t.createBlock(s,null,{default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(n.subtitleList,(o,l)=>(t.openBlock(),t.createBlock(i,{key:l,color:"primary",label:o.title,value:o},null,8,["label","value"]))),128))]),_:1})}}}));function nt(e){var n=e.toLowerCase().trim().split(/\s*;\s*/);return n[0]==="banner"?{name:n[0],delay:n[1]*1||0,leftToRight:n[2]*1||0,fadeAwayWidth:n[3]*1||0}:/^scroll\s/.test(n[0])?{name:n[0],y1:Math.min(n[1]*1,n[2]*1),y2:Math.max(n[1]*1,n[2]*1),delay:n[3]*1||0,fadeAwayHeight:n[4]*1||0}:null}function me(e){return e.toLowerCase().replace(/([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?)/g," $1 ").replace(/([mnlbspc])/g," $1 ").trim().replace(/\s+/g," ").split(/\s(?=[mnlbspc])/).map(function(n){return n.split(" ").filter(function(a,r){return!(r&&Number.isNaN(a*1))})})}var at=["b","i","u","s","fsp","k","K","kf","ko","kt","fe","q","p","pbo","a","an","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"],Ve=at.map(function(e){return{name:e,regex:new RegExp("^"+e+"-?\\d")}});function Fe(e){for(var n,a={},r=0;r<Ve.length;r++){var i=Ve[r],s=i.name,o=i.regex;if(o.test(e))return a[s]=e.slice(s.length)*1,a}if(/^fn/.test(e))a.fn=e.slice(2);else if(/^r/.test(e))a.r=e.slice(1);else if(/^fs[\d+-]/.test(e))a.fs=e.slice(2);else if(/^\d?c&?H?[0-9a-f]+|^\d?c$/i.test(e)){var l=e.match(/^(\d?)c&?H?(\w*)/),c=l[1],f=l[2];a["c"+(c||1)]=f&&("000000"+f).slice(-6)}else if(/^\da&?H?[0-9a-f]+/i.test(e)){var d=e.match(/^(\d)a&?H?(\w\w)/),p=d[1],v=d[2];a["a"+p]=v}else if(/^alpha&?H?[0-9a-f]+/i.test(e))n=e.match(/^alpha&?H?([0-9a-f]+)/i),a.alpha=n[1],a.alpha=("00"+a.alpha).slice(-2);else if(/^(?:pos|org|move|fad|fade)\(/.test(e)){var u=e.match(/^(\w+)\((.*?)\)?$/),m=u[1],y=u[2];a[m]=y.trim().split(/\s*,\s*/).map(Number)}else if(/^i?clip/.test(e)){var g=e.match(/^i?clip\((.*?)\)?$/)[1].trim().split(/\s*,\s*/);a.clip={inverse:/iclip/.test(e),scale:1,drawing:null,dots:null},g.length===1&&(a.clip.drawing=me(g[0])),g.length===2&&(a.clip.scale=g[0]*1,a.clip.drawing=me(g[1])),g.length===4&&(a.clip.dots=g.map(Number))}else if(/^t\(/.test(e)){var h=e.match(/^t\((.*?)\)?$/)[1].trim().replace(/\\.*/,function(w){return w.replace(/,/g,`
`)}).split(/\s*,\s*/);if(!h[0])return a;a.t={t1:0,t2:0,accel:1,tags:h[h.length-1].replace(/\n/g,",").split("\\").slice(1).map(Fe)},h.length===2&&(a.t.accel=h[0]*1),h.length===3&&(a.t.t1=h[0]*1,a.t.t2=h[1]*1),h.length===4&&(a.t.t1=h[0]*1,a.t.t2=h[1]*1,a.t.accel=h[2]*1)}return a}function rt(e){for(var n=[],a=0,r="",i=0;i<e.length;i++){var s=e[i];s==="("&&a++,s===")"&&a--,a<0&&(a=0),!a&&s==="\\"?(r&&n.push(r),r=""):r+=s}return n.push(r),n.map(Fe)}function ot(e){var n=e.split(/{([^{}]*?)}/),a=[];n[0].length&&a.push({tags:[],text:n[0],drawing:[]});for(var r=1;r<n.length;r+=2){var i=rt(n[r]),s=i.reduce(function(o,l){return l.p===void 0?o:!!l.p},!1);a.push({tags:i,text:s?"":n[r+1],drawing:s?me(n[r+1]):[]})}return{raw:e,combined:a.map(function(o){return o.text}).join(""),parsed:a}}function it(e){var n=e.split(":");return n[0]*3600+n[1]*60+n[2]*1}function st(e,n){var a=e.split(",");if(a.length>n.length){var r=a.slice(n.length-1).join();a=a.slice(0,n.length-1),a.push(r)}for(var i={},s=0;s<a.length;s++){var o=n[s],l=a[s].trim();switch(o){case"Layer":case"MarginL":case"MarginR":case"MarginV":i[o]=l*1;break;case"Start":case"End":i[o]=it(l);break;case"Effect":i[o]=nt(l);break;case"Text":i[o]=ot(l);break;default:i[o]=l}}return i}function Be(e){return e.match(/Format\s*:\s*(.*)/i)[1].split(/\s*,\s*/)}function lt(e){return e.match(/Style\s*:\s*(.*)/i)[1].split(/\s*,\s*/)}function ct(e){for(var n={info:{},styles:{format:[],style:[]},events:{format:[],comment:[],dialogue:[]}},a=e.split(/\r?\n/),r=0,i=0;i<a.length;i++){var s=a[i].trim();if(!/^;/.test(s)&&(/^\[Script Info\]/i.test(s)?r=1:/^\[V4\+? Styles\]/i.test(s)?r=2:/^\[Events\]/i.test(s)?r=3:/^\[.*\]/.test(s)&&(r=0),r!==0)){if(r===1&&/:/.test(s)){var o=s.match(/(.*?)\s*:\s*(.*)/),l=o[1],c=o[2];n.info[l]=c}if(r===2&&(/^Format\s*:/i.test(s)&&(n.styles.format=Be(s)),/^Style\s*:/i.test(s)&&n.styles.style.push(lt(s))),r===3&&(/^Format\s*:/i.test(s)&&(n.events.format=Be(s)),/^(?:Comment|Dialogue)\s*:/i.test(s))){var f=s.match(/^(\w+?)\s*:\s*(.*)/i),d=f[1],p=f[2];n.events[d.toLowerCase()].push(st(p,n.events.format))}}}return n}var F=Object.assign||function(n){for(var a=[],r=arguments.length-1;r-- >0;)a[r]=arguments[r+1];for(var i=0;i<a.length;i++)if(!!a[i])for(var s=Object.keys(a[i]),o=0;o<s.length;o++)n[s[o]]=a[i][s[o]];return n};function dt(e){var n={type:null,prev:null,next:null,points:[]};/[mnlbs]/.test(e[0])&&(n.type=e[0].toUpperCase().replace("N","L").replace("B","C"));for(var a=e.length-!(e.length&1),r=1;r<a;r+=2)n.points.push({x:e[r]*1,y:e[r+1]*1});return n}function ft(e){return!(!e.points.length||!e.type||/C|S/.test(e.type)&&e.points.length<3)}function ut(e){var n,a=1/0,r=1/0,i=-1/0,s=-1/0;return(n=[]).concat.apply(n,e.map(function(o){var l=o.points;return l})).forEach(function(o){var l=o.x,c=o.y;a=Math.min(a,l),r=Math.min(r,c),i=Math.max(i,l),s=Math.max(s,c)}),{minX:a,minY:r,width:i-a,height:s-r}}function ht(e,n,a){var r=[],i=[0,.6666666666666666,.3333333333333333,0],s=[0,1/3,2/3,0],o=[0,1/6,2/3,1/6],l=function(v,u){return v[0]*u[0]+v[1]*u[1]+v[2]*u[2]+v[3]*u[3]},c=[e[e.length-1].x,e[0].x,e[1].x,e[2].x],f=[e[e.length-1].y,e[0].y,e[1].y,e[2].y];r.push({type:n==="M"?"M":"L",points:[{x:l(o,c),y:l(o,f)}]});for(var d=3;d<e.length;d++)c=[e[d-3].x,e[d-2].x,e[d-1].x,e[d].x],f=[e[d-3].y,e[d-2].y,e[d-1].y,e[d].y],r.push({type:"C",points:[{x:l(i,c),y:l(i,f)},{x:l(s,c),y:l(s,f)},{x:l(o,c),y:l(o,f)}]});if(a==="L"||a==="C"){var p=e[e.length-1];r.push({type:"L",points:[{x:p.x,y:p.y}]})}return r}function pt(e){return e.map(function(n){var a=n.type,r=n.points;return a+r.map(function(i){var s=i.x,o=i.y;return s+","+o}).join(",")}).join("")}function De(e){for(var n,a=[],r=0;r<e.length;){var i=e[r],s=dt(i);if(ft(s)){if(s.type==="S"){var o=(a[r-1]||{points:[{x:0,y:0}]}).points.slice(-1)[0],l=o.x,c=o.y;s.points.unshift({x:l,y:c})}r&&(s.prev=a[r-1].type,a[r-1].next=s.type),a.push(s),r++}else{if(r&&a[r-1].type==="S"){var f={p:s.points,c:a[r-1].points.slice(0,3)};a[r-1].points=a[r-1].points.concat((f[i[0]]||[]).map(function(p){var v=p.x,u=p.y;return{x:v,y:u}}))}e.splice(r,1)}}var d=(n=[]).concat.apply(n,a.map(function(p){var v=p.type,u=p.points,m=p.prev,y=p.next;return v==="S"?ht(u,m,y):{type:v,points:u}}));return F({instructions:d,d:pt(d)},ut(a))}var mt=["fs","clip","c1","c2","c3","c4","a1","a2","a3","a4","alpha","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"];function z(e,n,a){var r,i,s;a===void 0&&(a={});var o=e[n];if(o===void 0)return null;if(n==="pos"||n==="org")return o.length===2?(r={},r[n]={x:o[0],y:o[1]},r):null;if(n==="move"){var l=o[0],c=o[1],f=o[2],d=o[3],p=o[4];p===void 0&&(p=0);var v=o[5];return v===void 0&&(v=0),o.length===4||o.length===6?{move:{x1:l,y1:c,x2:f,y2:d,t1:p,t2:v}}:null}if(n==="fad"||n==="fade"){if(o.length===2){var u=o[0],m=o[1];return{fade:{type:"fad",t1:u,t2:m}}}if(o.length===7){var y=o[0],g=o[1],h=o[2],w=o[3],N=o[4],x=o[5],E=o[6];return{fade:{type:"fade",a1:y,a2:g,a3:h,t1:w,t2:N,t3:x,t4:E}}}return null}if(n==="clip"){var _=o.inverse,S=o.scale,b=o.drawing,C=o.dots;if(b)return{clip:{inverse:_,scale:S,drawing:De(b),dots:C}};if(C){var I=C[0],A=C[1],J=C[2],H=C[3];return{clip:{inverse:_,scale:S,drawing:b,dots:{x1:I,y1:A,x2:J,y2:H}}}}return null}if(/^[xy]?(bord|shad)$/.test(n)&&(o=Math.max(o,0)),n==="bord")return{xbord:o,ybord:o};if(n==="shad")return{xshad:o,yshad:o};if(/^c\d$/.test(n))return i={},i[n]=o||a[n],i;if(n==="alpha")return{a1:o,a2:o,a3:o,a4:o};if(n==="fr")return{frz:o};if(n==="fs")return{fs:/^\+|-/.test(o)?(o*1>-10?1+o/10:1)*a.fs:o*1};if(n==="t"){var Z=o.t1,se=o.accel,le=o.tags,Q=o.t2||(a.end-a.start)*1e3,Y={};return le.forEach(function(ee){var W=Object.keys(ee)[0];~mt.indexOf(W)&&!(W==="clip"&&!ee[W].dots)&&F(Y,z(ee,W,a))}),{t:{t1:Z,t2:Q,accel:se,tag:Y}}}return s={},s[n]=o,s}var vt=[null,1,2,3,null,7,8,9,null,4,5,6],yt=["r","a","an","pos","org","move","fade","fad","clip"];function Ae(e,n){return{name:e,borderStyle:n[e].style.BorderStyle,tag:n[e].tag,fragments:[]}}function gt(e){for(var n=e.styles,a=e.name,r=e.parsed,i=e.start,s=e.end,o,l,c,f,d,p,v=[],u=Ae(a,n),m={},y=0;y<r.length;y++){for(var g=r[y],h=g.tags,w=g.text,N=g.drawing,x=void 0,E=0;E<h.length;E++){var _=h[E];x=_.r===void 0?x:_.r}for(var S={tag:x===void 0?JSON.parse(JSON.stringify(m)):{},text:w,drawing:N.length?De(N):null},b=0;b<h.length;b++){var C=h[b];o=o||vt[C.a||0]||C.an,l=l||z(C,"pos"),c=c||z(C,"org"),f=f||z(C,"move"),d=d||z(C,"fade")||z(C,"fad"),p=z(C,"clip")||p;var I=Object.keys(C)[0];if(I&&!~yt.indexOf(I)){var A=u.tag,J=A.c1,H=A.c2,Z=A.c3,se=A.c4,le=m.fs||u.tag.fs,Q=z(C,I,{start:i,end:s,c1:J,c2:H,c3:Z,c4:se,fs:le});I==="t"?(S.tag.t=S.tag.t||[],S.tag.t.push(Q.t)):F(S.tag,Q)}}if(m=S.tag,x!==void 0&&(v.push(u),u=Ae(n[x]?x:a,n)),S.text||S.drawing){var Y=u.fragments[u.fragments.length-1]||{};Y.text&&S.text&&!Object.keys(S.tag).length?Y.text+=S.text:u.fragments.push(S)}}return v.push(u),F({alignment:o,slices:v},l,c,f,d,p)}function wt(e){for(var n=e.styles,a=e.dialogues,r=1/0,i=[],s=0;s<a.length;s++){var o=a[s];if(!(o.Start>=o.End)){n[o.Style]||(o.Style="Default");var l=n[o.Style].style,c=gt({styles:n,name:o.Style,parsed:o.Text.parsed,start:o.Start,end:o.End}),f=c.alignment||l.Alignment;r=Math.min(r,o.Layer),i.push(F({layer:o.Layer,start:o.Start,end:o.End,margin:{left:o.MarginL||l.MarginL,right:o.MarginR||l.MarginR,vertical:o.MarginV||l.MarginV},effect:o.Effect},c,{alignment:f}))}}for(var d=0;d<i.length;d++)i[d].layer-=r;return i.sort(function(p,v){return p.start-v.start||p.end-v.end})}var xt={Name:"Default",Fontname:"Arial",Fontsize:"20",PrimaryColour:"&H00FFFFFF&",SecondaryColour:"&H000000FF&",OutlineColour:"&H00000000&",BackColour:"&H00000000&",Bold:"0",Italic:"0",Underline:"0",StrikeOut:"0",ScaleX:"100",ScaleY:"100",Spacing:"0",Angle:"0",BorderStyle:"1",Outline:"2",Shadow:"2",Alignment:"2",MarginL:"10",MarginR:"10",MarginV:"10",Encoding:"1"};function ce(e){if(/^(&|H|&H)[0-9a-f]{6,}/i.test(e)){var n=e.match(/&?H?([0-9a-f]{2})?([0-9a-f]{6})/i),a=n[1],r=n[2];return[a||"00",r]}var i=parseInt(e,10);if(!Number.isNaN(i)){var s=-2147483648,o=2147483647;if(i<s)return["00","000000"];var l=s<=i&&i<=o?("00000000"+(i<0?i+4294967296:i).toString(16)).slice(-8):String(i).slice(0,8);return[l.slice(0,2),l.slice(2)]}return["00","000000"]}function _t(e){for(var n=e.info,a=e.style,r=e.format,i=e.defaultStyle,s={},o=[F({},xt,i,{Name:"Default"})].concat(a.map(function(f){for(var d={},p=0;p<r.length;p++)d[r[p]]=f[p];return d})),l=function(f){var d=o[f];/^(\*+)Default$/.test(d.Name)&&(d.Name="Default"),Object.keys(d).forEach(function(b){b!=="Name"&&b!=="Fontname"&&!/Colour/.test(b)&&(d[b]*=1)});var p=ce(d.PrimaryColour),v=p[0],u=p[1],m=ce(d.SecondaryColour),y=m[0],g=m[1],h=ce(d.OutlineColour),w=h[0],N=h[1],x=ce(d.BackColour),E=x[0],_=x[1],S={fn:d.Fontname,fs:d.Fontsize,c1:u,a1:v,c2:g,a2:y,c3:N,a3:w,c4:_,a4:E,b:Math.abs(d.Bold),i:Math.abs(d.Italic),u:Math.abs(d.Underline),s:Math.abs(d.StrikeOut),fscx:d.ScaleX,fscy:d.ScaleY,fsp:d.Spacing,frz:d.Angle,xbord:d.Outline,ybord:d.Outline,xshad:d.Shadow,yshad:d.Shadow,q:/^[0-3]$/.test(n.WrapStyle)?n.WrapStyle*1:2};s[d.Name]={style:d,tag:S}},c=0;c<o.length;c++)l(c);return s}function bt(e,n){n===void 0&&(n={});var a=ct(e),r=_t({info:a.info,style:a.styles.style,format:a.styles.format,defaultStyle:n.defaultStyle||{}});return{info:a.info,width:a.info.PlayResX*1||null,height:a.info.PlayResY*1||null,collisions:a.info.Collisions||"Normal",styles:r,dialogues:wt({styles:r,dialogues:a.events.dialogue})}}var Te=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return setTimeout(e,50/3)},Ie=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||clearTimeout;function U(e){var n=e.match(/(\w\w)(\w\w)(\w\w)(\w\w)/),a=1-("0x"+n[1])/255,r=+("0x"+n[2]),i=+("0x"+n[3]),s=+("0x"+n[4]);return"rgba("+s+","+i+","+r+","+a+")"}function re(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=Math.random()*16|0,a=e==="x"?n:n&3|8;return a.toString(16)})}function k(e,n){n===void 0&&(n=[]);for(var a=document.createElementNS("http://www.w3.org/2000/svg",e),r=0;r<n.length;r++){var i=n[r];a.setAttributeNS(i[0]==="xlink:href"?"http://www.w3.org/1999/xlink":null,i[0],i[1])}return a}function ve(e){var n=document.body,a=n.style,r=e.replace(/^\w/,function(i){return i.toUpperCase()});return e in a?"":"webkit"+r in a?"-webkit-":"moz"+r in a?"-moz-":""}var X={transform:ve("transform"),animation:ve("animation"),clipPath:ve("clipPath")};function $e(e){var n=e.getRootNode?e.getRootNode():document;return n===document?n.head:n}var Ct=["c3","a3","c4","a4","xbord","ybord","xshad","yshad","blur","be"],Le=["fscx","fscy","frx","fry","frz","fax","fay"];function Et(e){var n=this._.scriptRes.width,a=this._.scriptRes.height,r="";if(e.dots!==null){var i=e.dots,s=i.x1,o=i.y1,l=i.x2,c=i.y2;s/=n,o/=a,l/=n,c/=a,r="M"+s+","+o+"L"+s+","+c+","+l+","+c+","+l+","+o+"Z"}e.drawing!==null&&(r=e.drawing.instructions.map(function(v){var u=v.type,m=v.points;return u+m.map(function(y){var g=y.x,h=y.y;return g/n+","+h/a}).join(",")}).join(""));var f=1/(1<<e.scale-1);e.inverse&&(r+="M0,0L0,"+f+","+f+","+f+","+f+",0,0,0Z");var d="ASS-"+re(),p=k("clipPath",[["id",d],["clipPathUnits","objectBoundingBox"]]);return p.appendChild(k("path",[["d",r],["transform","scale("+f+")"],["clip-rule","evenodd"]])),this._.$defs.appendChild(p),{$clipPath:p,cssText:X.clipPath+"clip-path:url(#"+d+");"}}function St(e){if(!!e.clip){var n=document.createElement("div");this._.$stage.insertBefore(n,e.$div),n.appendChild(e.$div),n.className="ASS-fix-objectBoundingBox";var a=Et.call(this,e.clip),r=a.cssText,i=a.$clipPath;this._.$defs.appendChild(i),n.style.cssText=r,F(e,{$div:n,$clipPath:i})}}var oe=document.createElement("div");oe.className="ASS-fix-font-size",oe.textContent="M";var ye=Object.create(null);function ge(e,n){var a=e+"-"+n;return ye[a]||(oe.style.cssText="line-height:normal;font-size:"+n+'px;font-family:"'+e+'",Arial;',ye[a]=n*n/oe.clientHeight),ye[a]}function kt(e,n,a){var r=e.xbord||e.ybord,i=e.xshad||e.yshad,s=e.a1!=="FF",o=e.blur||e.be||0,l=k("filter",[["id",n]]);l.appendChild(k("feGaussianBlur",[["stdDeviation",r?0:o],["in","SourceGraphic"],["result","sg_b"]])),l.appendChild(k("feFlood",[["flood-color",U(e.a1+e.c1)],["result","c1"]])),l.appendChild(k("feComposite",[["operator","in"],["in","c1"],["in2","sg_b"],["result","main"]])),r&&(l.appendChild(k("feMorphology",[["radius",e.xbord*a+" "+e.ybord*a],["operator","dilate"],["in","SourceGraphic"],["result","dil"]])),l.appendChild(k("feGaussianBlur",[["stdDeviation",o],["in","dil"],["result","dil_b"]])),l.appendChild(k("feComposite",[["operator","out"],["in","dil_b"],["in2","SourceGraphic"],["result","dil_b_o"]])),l.appendChild(k("feFlood",[["flood-color",U(e.a3+e.c3)],["result","c3"]])),l.appendChild(k("feComposite",[["operator","in"],["in","c3"],["in2","dil_b_o"],["result","border"]]))),i&&(r||s)&&(l.appendChild(k("feOffset",[["dx",e.xshad*a],["dy",e.yshad*a],["in",r?"dil":"SourceGraphic"],["result","off"]])),l.appendChild(k("feGaussianBlur",[["stdDeviation",o],["in","off"],["result","off_b"]])),s||(l.appendChild(k("feOffset",[["dx",e.xshad*a],["dy",e.yshad*a],["in","SourceGraphic"],["result","sg_off"]])),l.appendChild(k("feComposite",[["operator","out"],["in","off_b"],["in2","sg_off"],["result","off_b_o"]]))),l.appendChild(k("feFlood",[["flood-color",U(e.a4+e.c4)],["result","c4"]])),l.appendChild(k("feComposite",[["operator","in"],["in","c4"],["in2",s?"off_b":"off_b_o"],["result","shadow"]])));var c=k("feMerge",[]);return i&&(r||s)&&c.appendChild(k("feMergeNode",[["in","shadow"]])),r&&c.appendChild(k("feMergeNode",[["in","border"]])),c.appendChild(k("feMergeNode",[["in","main"]])),l.appendChild(c),l}function de(e,n){var a=[],r=U(e.a3+e.c3),i=e.xbord*n,s=e.ybord*n,o=U(e.a4+e.c4),l=e.xshad*n,c=e.yshad*n,f=e.blur||e.be||0;if(!(i+s+l+c))return"none";if(i||s)for(var d=-1;d<=1;d++)for(var p=-1;p<=1;p++){for(var v=1;v<i;v++)for(var u=1;u<s;u++)(d||p)&&a.push(r+" "+d*v+"px "+p*u+"px "+f+"px");a.push(r+" "+d*i+"px "+p*s+"px "+f+"px")}if(l||c){var m=l>0?1:-1,y=c>0?1:-1;l=Math.abs(l),c=Math.abs(c);for(var g=Math.max(i,l-i);g<l+i;g++)for(var h=Math.max(s,c-s);h<c+s;h++)a.push(o+" "+g*m+"px "+h*y+"px "+f+"px");a.push(o+" "+(l+i)*m+"px "+(c+s)*y+"px "+f+"px")}return a.join()}function we(e){return["perspective(314px)","rotateY("+(e.fry||0)+"deg)","rotateX("+(e.frx||0)+"deg)","rotateZ("+(-e.frz||0)+"deg)","scale("+(e.p?1:(e.fscx||100)/100)+","+(e.p?1:(e.fscy||100)/100)+")","skew("+(e.fax||0)+"rad,"+(e.fay||0)+"rad)"].join(" ")}function Nt(e){var n=e.alignment,a=e.width,r=e.height,i=e.x,s=e.y,o=e.$div,l=e.org;l||(l={x:0,y:0},n%3===1&&(l.x=i),n%3===2&&(l.x=i+a/2),n%3===0&&(l.x=i+a),n<=3&&(l.y=s+r),n>=4&&n<=6&&(l.y=s+r/2),n>=7&&(l.y=s));for(var c=o.childNodes.length-1;c>=0;c--){var f=o.childNodes[c];if(f.dataset.hasRotate==="true"){var d=l.x-i-f.offsetLeft,p=l.y-s-f.offsetTop;f.style.cssText+=X.transform+"transform-origin:"+d+"px "+p+"px;"}}}function Re(e,n){return"@"+X.animation+"keyframes "+e+" {"+n+`}
`}var ie=function(){this.obj={}};ie.prototype.set=function(n,a,r){this.obj[n]||(this.obj[n]={}),this.obj[n][a]=r},ie.prototype.setT=function(n){var a=n.t1,r=n.t2,i=n.duration,s=n.prop,o=n.from,l=n.to;this.set("0.000%",s,o),a<i&&this.set((a/i*100).toFixed(3)+"%",s,o),r<i&&this.set((r/i*100).toFixed(3)+"%",s,l),this.set("100.000%",s,l)},ie.prototype.toString=function(){var n=this;return Object.keys(this.obj).map(function(a){return a+"{"+Object.keys(n.obj[a]).map(function(r){return""+(X[r]||"")+r+":"+n.obj[a][r]+";"}).join("")+"}"}).join("")};function Vt(e){return e.reduceRight(function(n,a){var r=!1;return n.map(function(i){return r=a.t1===i.t1&&a.t2===i.t2&&a.accel===i.accel,F({},i,r?{tag:F({},i.tag,a.tag)}:{})}).concat(r?[]:a)},[])}function Ft(){var e=this,n="";return this.dialogues.forEach(function(a){var r=a.start,i=a.end,s=a.effect,o=a.move,l=a.fade,c=a.slices,f=(i-r)*1e3,d=new ie;if(s&&!o){var p=s.name,v=s.delay,u=s.lefttoright,m=s.y1,y=s.y2||e._.resampledRes.height;if(p==="banner"){var g=e.scale*(f/v)*(u?1:-1);d.set("0.000%","transform","translateX(0)"),d.set("100.000%","transform","translateX("+g+"px)")}if(/^scroll/.test(p)){var h=/up/.test(p)?-1:1,w="translateY("+e.scale*m*h+"px)",N="translateY("+e.scale*y*h+"px)",x=(y-m)/(f/v)*100;d.set("0.000%","transform",w),x<100&&d.set(x.toFixed(3)+"%","transform",N),d.set("100.000%","transform",N)}}if(o){var E=o.x1,_=o.y1,S=o.x2,b=o.y2,C=o.t1,I=o.t2||f,A=a.pos||{x:0,y:0},J=[{x:E,y:_},{x:S,y:b}].map(function($){var L=$.x,P=$.y;return"translate("+e.scale*(L-A.x)+"px, "+e.scale*(P-A.y)+"px)"});d.setT({t1:C,t2:I,duration:f,prop:"transform",from:J[0],to:J[1]})}if(l)if(l.type==="fad"){var H=l.t1,Z=l.t2;d.set("0.000%","opacity",0),H<f?(d.set((H/f*100).toFixed(3)+"%","opacity",1),H+Z<f&&d.set(((f-Z)/f*100).toFixed(3)+"%","opacity",1),d.set("100.000%","opacity",0)):d.set("100.000%","opacity",f/H)}else{var se=l.a1,le=l.a2,Q=l.a3,Y=l.t1,ee=l.t2,W=l.t3,We=l.t4,pe=[Y,ee,W,We].map(function($){return($/f*100).toFixed(3)+"%"}),te=[se,le,Q].map(function($){return 1-$/255});d.set("0.000%","opacity",te[0]),Y<f&&d.set(pe[0],"opacity",te[0]),ee<f&&d.set(pe[1],"opacity",te[1]),W<f&&d.set(pe[2],"opacity",te[1]),We<f&&d.set(pe[3],"opacity",te[2]),d.set("100.000%","opacity",te[2])}var Xe=d.toString();Xe&&(F(a,{animationName:"ASS-"+re()}),n+=Re(a.animationName,Xe)),c.forEach(function($){$.fragments.forEach(function(L){if(!(!L.tag.t||!L.tag.t.length)){var P=new ie,D=F({},$.tag,L.tag);Vt(L.tag.t).forEach(function(Ne){var ne=Ne.t1,ae=Ne.t2,V=Ne.tag;if(V.fs){var Zn=e.scale*ge(D.fn,D.fs)+"px",Qn=e.scale*ge(V.fn,D.fs)+"px";P.setT({t1:ne,t2:ae,duration:f,prop:"font-size",from:Zn,to:Qn})}if(V.fsp){var ea=e.scale*D.fsp+"px",ta=e.scale*V.fsp+"px";P.setT({t1:ne,t2:ae,duration:f,prop:"letter-spacing",from:ea,to:ta})}var Ke=V.a1!==void 0&&V.a1===V.a2&&V.a2===V.a3&&V.a3===V.a4;if(V.c1||V.a1&&!Ke){var na=U(D.a1+D.c1),aa=U((V.a1||D.a1)+(V.c1||D.c1));P.setT({t1:ne,t2:ae,duration:f,prop:"color",from:na,to:aa})}if(Ke){var ra=1-parseInt(D.a1,16)/255,oa=1-parseInt(V.a1,16)/255;P.setT({t1:ne,t2:ae,duration:f,prop:"opacity",from:ra,to:oa})}var ia=Ct.some(function(O){return V[O]!==void 0&&V[O]!==(L.tag[O]||$.tag[O])});if(ia){var Je=/Yes/i.test(e.info.ScaledBorderAndShadow)?e.scale:1,sa=de(D,Je),la=de(F({},D,V),Je);P.setT({t1:ne,t2:ae,duration:f,prop:"text-shadow",from:sa,to:la})}var ca=Le.some(function(O){return V[O]!==void 0&&V[O]!==(L.tag[O]||$.tag[O])});if(ca){var Ze=F({},D,V);L.drawing&&(F(Ze,{p:0,fscx:(V.fscx||D.fscx)/D.fscx*100,fscy:(V.fscy||D.fscy)/D.fscy*100}),F(D,{fscx:100,fscy:100}));var da=we(D),fa=we(Ze);P.setT({t1:ne,t2:ae,duration:f,prop:"transform",from:da,to:fa})}});var Jn=P.toString();F(L,{animationName:"ASS-"+re()}),n+=Re(L.animationName,Jn)}})})}),n}function Me(e,n,a){var r=X.animation;return r+"animation-name:"+e+";"+r+"animation-duration:"+n+"s;"+r+"animation-delay:"+a+"s;"+r+"animation-timing-function:linear;"+r+"animation-iteration-count:1;"+r+"animation-fill-mode:forwards;"}function Bt(e,n){var a=F({},n,e.tag),r=e.drawing,i=r.minX,s=r.minY,o=r.width,l=r.height,c=this.scale/(1<<a.p-1),f=(a.fscx?a.fscx/100:1)*c,d=(a.fscy?a.fscy/100:1)*c,p=a.blur||a.be||0,v=a.xbord+(a.xshad<0?-a.xshad:0)+p,u=a.ybord+(a.yshad<0?-a.yshad:0)+p,m=o*f+2*a.xbord+Math.abs(a.xshad)+2*p,y=l*d+2*a.ybord+Math.abs(a.yshad)+2*p,g=k("svg",[["width",m],["height",y],["viewBox",-v+" "+-u+" "+m+" "+y]]),h=/Yes/i.test(this.info.ScaledBorderAndShadow)?this.scale:1,w="ASS-"+re(),N=k("defs");N.appendChild(kt(a,w,h)),g.appendChild(N);var x="ASS-"+re(),E=k("symbol",[["id",x],["viewBox",i+" "+s+" "+o+" "+l]]);return E.appendChild(k("path",[["d",e.drawing.d]])),g.appendChild(E),g.appendChild(k("use",[["width",o*f],["height",l*d],["xlink:href","#"+x],["filter","url(#"+w+")"]])),g.style.cssText="position:absolute;left:"+(i*f-v)+"px;top:"+(s*d-u)+"px;",{$svg:g,cssText:"position:relative;width:"+o*f+"px;height:"+l*d+"px;"}}function Dt(e,n){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\s/g,"&nbsp;").replace(/\\h/g,"&nbsp;").replace(/\\N/g,"<br>").replace(/\\n/g,n===2?"<br>":"&nbsp;")}function At(e){var n=this,a=document.createElement("div");a.className="ASS-dialogue";var r=document.createDocumentFragment(),i=e.slices,s=e.start,o=e.end;return i.forEach(function(l){var c=l.borderStyle;l.fragments.forEach(function(f){var d=f.text,p=f.drawing,v=f.animationName,u=F({},l.tag,f.tag),m="display:inline-block;",y=n.video.currentTime;if(!p){m+='font-family:"'+u.fn+'",Arial;',m+="font-size:"+n.scale*ge(u.fn,u.fs)+"px;",m+="color:"+U(u.a1+u.c1)+";";var g=/Yes/i.test(n.info.ScaledBorderAndShadow)?n.scale:1;c===1&&(m+="text-shadow:"+de(u,g)+";"),c===3&&(m+="background-color:"+U(u.a3+u.c3)+";box-shadow:"+de(u,g)+";"),m+=u.b?"font-weight:"+(u.b===1?"bold":u.b)+";":"",m+=u.i?"font-style:italic;":"",m+=u.u||u.s?"text-decoration:"+(u.u?"underline":"")+" "+(u.s?"line-through":"")+";":"",m+=u.fsp?"letter-spacing:"+u.fsp+"px;":"",(u.q===1||u.q===0||u.q===3)&&(m+="word-break:break-all;white-space:normal;"),u.q===2&&(m+="word-break:normal;white-space:nowrap;")}var h=Le.some(function(x){return/^fsc[xy]$/.test(x)?u[x]!==100:!!u[x]});if(h&&(m+=X.transform+"transform:"+we(u)+";",p||(m+="transform-style:preserve-3d;word-break:normal;white-space:nowrap;")),v&&(m+=Me(v,o-s,Math.min(0,s-y))),p&&u.pbo){var w=n.scale*-u.pbo*(u.fscy||100)/100;m+="vertical-align:"+w+"px;"}var N=/"fr[xyz]":[^0]/.test(JSON.stringify(u));Dt(d,u.q).split("<br>").forEach(function(x,E){var _=document.createElement("span");if(_.dataset.hasRotate=N,p){var S=Bt.call(n,f,l.tag);_.style.cssText=S.cssText,_.appendChild(S.$svg)}else{if(E&&r.appendChild(document.createElement("br")),!x)return;_.innerHTML=x}_.style.cssText+=m,r.appendChild(_)})})}),a.appendChild(r),a}function Tt(e){var n=e.layer,a=e.margin,r=e.width,i=e.height,s=e.alignment,o=e.end,l=this.width-(this.scale*(a.left+a.right)|0),c=this.height,f=this.scale*a.vertical|0,d=this.video.currentTime*100;this._.space[n]=this._.space[n]||{left:{width:new Uint16Array(c+1),end:new Uint16Array(c+1)},center:{width:new Uint16Array(c+1),end:new Uint16Array(c+1)},right:{width:new Uint16Array(c+1),end:new Uint16Array(c+1)}};var p=this._.space[n],v=["right","left","center"][s%3],u=function(E){var _=p.left.width[E],S=p.center.width[E],b=p.right.width[E],C=p.left.end[E],I=p.center.end[E],A=p.right.end[E];return v==="left"&&(C>d&&_||I>d&&S&&2*r+S>l||A>d&&b&&r+b>l)||v==="center"&&(C>d&&_&&2*_+r>l||I>d&&S||A>d&&b&&2*b+r>l)||v==="right"&&(C>d&&_&&_+r>l||I>d&&S&&2*r+S>l||A>d&&b)},m=0,y=0,g=function(E){return m=u(E)?0:m+1,m>=i?(y=E,!0):!1};if(s<=3)for(var h=c-f-1;h>f&&!g(h);h--);else if(s>=7)for(var w=f+1;w<c-f&&!g(w);w++);else for(var N=c-i>>1;N<c-f&&!g(N);N++);s>3&&(y-=i-1);for(var x=y;x<y+i;x++)p[v].width[x]=r,p[v].end[x]=o*100;return y}function It(e){var n=e.effect,a=e.move,r=e.alignment,i=e.width,s=e.height,o=e.margin,l=e.slices,c=0,f=0;if(n)n.name==="banner"&&(r<=3&&(f=this.height-s-o.vertical),r>=4&&r<=6&&(f=(this.height-s)/2),r>=7&&(f=o.vertical),c=n.lefttoright?-i:this.width);else if(e.pos||a){var d=e.pos||{x:0,y:0};r%3===1&&(c=this.scale*d.x),r%3===2&&(c=this.scale*d.x-i/2),r%3===0&&(c=this.scale*d.x-i),r<=3&&(f=this.scale*d.y-s),r>=4&&r<=6&&(f=this.scale*d.y-s/2),r>=7&&(f=this.scale*d.y)}else{r%3===1&&(c=0),r%3===2&&(c=(this.width-i)/2),r%3===0&&(c=this.width-i-this.scale*o.right);var p=l.some(function(v){return v.fragments.some(function(u){var m=u.animationName;return m})});p?(r<=3&&(f=this.height-s-o.vertical),r>=4&&r<=6&&(f=(this.height-s)/2),r>=7&&(f=o.vertical)):f=Tt.call(this,e)}return{x:c,y:f}}function $t(e){var n=e.layer,a=e.start,r=e.end,i=e.alignment,s=e.effect,o=e.pos,l=e.margin,c=e.animationName,f=e.width,d=e.height,p=e.x,v=e.y,u=this.video.currentTime,m="";if(n&&(m+="z-index:"+n+";"),c&&(m+=Me(c,r-a,Math.min(0,a-u))),m+="text-align:"+["right","left","center"][i%3]+";",!s){var y=this.width-this.scale*(l.left+l.right);m+="max-width:"+y+"px;",o||(i%3===1&&(m+="margin-left:"+this.scale*l.left+"px;"),i%3===0&&(m+="margin-right:"+this.scale*l.right+"px;"),f>this.width-this.scale*(l.left+l.right)&&(m+="margin-left:"+this.scale*l.left+"px;",m+="margin-right:"+this.scale*l.right+"px;"))}return m+="width:"+f+"px;height:"+d+"px;left:"+p+"px;top:"+v+"px;",m}function Lt(e){var n=At.call(this,e);F(e,{$div:n}),this._.$stage.appendChild(n);var a=n.getBoundingClientRect(),r=a.width,i=a.height;return F(e,{width:r,height:i}),F(e,It.call(this,e)),n.style.cssText=$t.call(this,e),Nt(e),St.call(this,e),e}function Ue(){for(var e=this.video.currentTime,n=this._.stagings.length-1;n>=0;n--){var a=this._.stagings[n],r=a.end;if(a.effect&&/scroll/.test(a.effect.name)){var i=a.effect,s=i.y1,o=i.y2,l=i.delay,c=((o||this._.resampledRes.height)-s)/(1e3/l);r=Math.min(r,a.start+c)}r<e&&(this._.$stage.removeChild(a.$div),a.$clipPath&&this._.$defs.removeChild(a.$clipPath),this._.stagings.splice(n,1))}for(var f=this.dialogues;this._.index<f.length&&e>=f[this._.index].start;){if(e<f[this._.index].end){var d=Lt.call(this,f[this._.index]);this._.stagings.push(d)}++this._.index}}function Pe(){var e=this,n=function(){Ue.call(e),e._.requestId=Te(n)};return Ie(this._.requestId),this._.requestId=Te(n),this._.$stage.classList.remove("ASS-animation-paused"),this}function Oe(){return Ie(this._.requestId),this._.requestId=0,this._.$stage.classList.add("ASS-animation-paused"),this}function ze(){for(;this._.$stage.lastChild;)this._.$stage.removeChild(this._.$stage.lastChild);for(;this._.$defs.lastChild;)this._.$defs.removeChild(this._.$defs.lastChild);this._.stagings=[],this._.space=[]}function xe(){var e=this.video.currentTime,n=this.dialogues;ze.call(this),this._.index=function(){for(var a=0,r=n.length-1;a+1<r&&e>n[r+a>>1].end;)a=r+a>>1;if(!a)return 0;for(var i=a;i<r;i++)if(n[i].end>e&&e>=n[i].start||i&&n[i-1].end<e&&e<n[i].start)return i;return r}(),Ue.call(this)}function Rt(){var e=this._.listener;e.play=Pe.bind(this),e.pause=Oe.bind(this),e.seeking=xe.bind(this),this.video.addEventListener("play",e.play),this.video.addEventListener("pause",e.pause),this.video.addEventListener("seeking",e.seeking)}function Mt(){var e=this._.listener;this.video.removeEventListener("play",e.play),this.video.removeEventListener("pause",e.pause),this.video.removeEventListener("seeking",e.seeking),e.play=null,e.pause=null,e.seeking=null}function je(){var e=this.video.clientWidth,n=this.video.clientHeight,a=this.video.videoWidth||e,r=this.video.videoHeight||n,i=this._.scriptRes.width,s=this._.scriptRes.height,o=i,l=s,c=Math.min(e/a,n/r);this.resampling==="video_width"&&(l=i/a*r),this.resampling==="video_height"&&(o=s/r*a),this.scale=Math.min(e/o,n/l),this.resampling==="script_width"&&(this.scale=c*(a/o)),this.resampling==="script_height"&&(this.scale=c*(r/l)),this.width=this.scale*o,this.height=this.scale*l,this._.resampledRes={width:o,height:l},this.container.style.cssText="width:"+e+"px;height:"+n+"px;";var f="width:"+this.width+"px;height:"+this.height+"px;top:"+(n-this.height)/2+"px;left:"+(e-this.width)/2+"px;";return this._.$stage.style.cssText=f,this._.$svg.style.cssText=f,this._.$svg.setAttributeNS(null,"viewBox","0 0 "+i+" "+s),this._.$animation.innerHTML=Ft.call(this),xe.call(this),this}var Ut=".ASS-container,.ASS-stage{position:relative;overflow:hidden}.ASS-container video{position:absolute;top:0;left:0}.ASS-stage{pointer-events:none;position:absolute}.ASS-dialogue{font-size:0;position:absolute}.ASS-fix-font-size{position:absolute;visibility:hidden}.ASS-fix-objectBoundingBox{width:100%;height:100%;position:absolute;top:0;left:0}.ASS-animation-paused *{-webkit-animation-play-state:paused!important;animation-play-state:paused!important}";function Pt(e,n,a){if(a===void 0&&(a={}),this.scale=1,this._={index:0,stagings:[],space:[],listener:{},$svg:k("svg"),$defs:k("defs"),$stage:document.createElement("div"),$animation:document.createElement("style")},this._.$svg.appendChild(this._.$defs),this._.$stage.className="ASS-stage ASS-animation-paused",this._.resampling=a.resampling||"video_height",this.container=a.container||document.createElement("div"),this.container.classList.add("ASS-container"),this.container.appendChild(oe),this.container.appendChild(this._.$svg),this._.hasInitContainer=!!a.container,this.video=n,Rt.call(this),!this._.hasInitContainer){var r=!n.paused;n.parentNode.insertBefore(this.container,n),this.container.appendChild(n),r&&n.paused&&n.play()}this.container.appendChild(this._.$stage);var i=bt(e),s=i.info,o=i.width,l=i.height,c=i.dialogues;this.info=s,this._.scriptRes={width:o||n.videoWidth,height:l||n.videoHeight},this.dialogues=c;var f=$e(this.container),d=f.querySelector("#ASS-global-style");return d||(d=document.createElement("style"),d.type="text/css",d.id="ASS-global-style",d.appendChild(document.createTextNode(Ut)),f.appendChild(d)),this._.$animation.type="text/css",this._.$animation.className="ASS-animation",f.appendChild(this._.$animation),je.call(this),this.video.paused||(xe.call(this),Pe.call(this)),this}function Ot(){return this._.$stage.style.visibility="visible",this}function zt(){return this._.$stage.style.visibility="hidden",this}function jt(){Oe.call(this),ze.call(this),Mt.call(this,this._.listener);var e=$e(this.container);if(!this._.hasInitContainer){var n=!this.video.paused;this.container.parentNode.insertBefore(this.video,this.container),this.container.parentNode.removeChild(this.container),n&&this.video.paused&&this.video.play()}e.removeChild(this._.$animation);for(var a in this)Object.prototype.hasOwnProperty.call(this,a)&&(this[a]=null);return this}var qe=/^(video|script)_(width|height)$/;function qt(){return qe.test(this._.resampling)?this._.resampling:"video_height"}function Ht(e){return e===this._.resampling?e:(qe.test(e)&&(this._.resampling=e,this.resize()),this._.resampling)}var K=function(n,a,r){return typeof n!="string"?this:Pt.call(this,n,a,r)},_e={resampling:{configurable:!0}};K.prototype.resize=function(){return je.call(this)},K.prototype.show=function(){return Ot.call(this)},K.prototype.hide=function(){return zt.call(this)},K.prototype.destroy=function(){return jt.call(this)},_e.resampling.get=function(){return qt.call(this)},_e.resampling.set=function(e){return Ht.call(this,e)},Object.defineProperties(K.prototype,_e);var ya="",Yt=(e,n)=>{const a=e.__vccOpts||e;for(const[r,i]of n)a[r]=i;return a};const Gt=[(e=>(t.pushScopeId("data-v-5ef15dba"),e=e(),t.popScopeId(),e))(()=>t.createElementVNode("h1",null,"\u64AD\u653E\u52A0\u8F7D\u5931\u8D25\u4E86QAQ",-1))],Wt=t.defineComponent({name:"VideoEnhancePlayer"}),Xt=t.defineComponent(M(R({},Wt),{props:{url:{type:String,default:void 0},videoInfo:{type:Object,default:void 0},subtitleList:{type:Array,default:()=>[]}},setup(e){const n=e,a=window.SfcUtils,r=t.ref(),i=t.ref();let s,o,l;const c=async u=>{const m=s.video.currentTime;s.destroy(),s=new window.DPlayer(u),s.play(),s.seek(m)},f=B.MethodInterceptor.createThrottleProxy({autoResizeAss(){o&&o.resize()}},{afterExecute:!0,delay:500});function d(){l&&(clearInterval(l),l=null)}function p(u){o&&(o.destroy(),o=null);const m=document.createElement("div");m.classList.add("subtitle");const y=i.value.getAttributeNames().find(w=>w.startsWith("data-v-"));m.setAttribute(y,""),i.value.appendChild(m),o=new K(u,s.video,{container:m,resampling:"video_width"}),d();const g="21px",h=i.value.querySelector(".ASS-stage");if(h&&h.getAttribute("has-hock-append-child")!="1"){h.setAttribute("has-hock-append-child","1");const w=h.appendChild.bind(h);h.appendChild=N=>{if(N instanceof HTMLElement){const x=N.querySelector("span");x&&(x.style.fontSize=g)}return w(N)}}l=setInterval(()=>{i.value.querySelectorAll(".ASS-stage span").forEach(w=>w.style.fontSize=g)},500)}const v=()=>{if(!n.url)return;const u={container:i.value,video:{url:n.url}},m=t.ref();n.videoInfo&&(n.subtitleList.length&&(window.SfcUtils.snackbar(`\u68C0\u6D4B\u5230${n.subtitleList.length}\u4E2A\u5B57\u5E55`),u.contextmenu=[{text:"\u9009\u62E9\u5B57\u5E55",click(){window.SfcUtils.openComponentDialog(tt,{props:t.reactive({subtitleList:n.subtitleList,"onUpdate:modelValue"(y){m.value=y},modelValue:m}),title:"\u9009\u62E9\u5B57\u5E55",contentMaxHeight:"360px",async onConfirm(){if(m.value.type=="webvtt")u.subtitle={url:m.value.url,fontSize:"21px"},u.contextmenu[0].text="\u5B57\u5E55\uFF1A"+m.value.title,c(u),d();else{u.subtitle=void 0,u.contextmenu[0].text="\u5B57\u5E55\uFF1A"+m.value.title,c(u);const y=(await a.request({url:m.value.url})).data;p(y)}return!0}})}}]),n.videoInfo.chapters.length&&(u.highlight=n.videoInfo.chapters.map(y=>({text:y.title,time:Number(y.startTime)})))),s=new window.DPlayer(u),s.play()};return t.onMounted(async()=>{await t.nextTick(),v(),window.addEventListener("resize",f.autoResizeAss)}),t.onUnmounted(()=>{window.removeEventListener("resize",f.autoResizeAss),d()}),t.watch(()=>n.url,v),(u,m)=>(t.openBlock(),t.createElementBlock("div",{ref_key:"rootRef",ref:r,class:"player-root"},[t.createElementVNode("div",{ref_key:"playerRef",ref:i,class:"player"},Gt,512)],512))}}));var Kt=Yt(Xt,[["__scopeId","data-v-5ef15dba"]]);const Jt=t.defineComponent({name:"ConfigureInfo"}),Zt=t.defineComponent(M(R({},Jt),{props:{modelValue:{type:String,default:""}},setup(e){const n=e,a=()=>{window.SfcUtils.alert(n.modelValue,"\u7F16\u8BD1\u53C2\u6570")};return(r,i)=>(t.openBlock(),t.createElementBlock("a",{class:"link",onClick:a},"\u67E5\u770B\u7F16\u8BD1\u53C2\u6570"))}})),Qt=t.createElementVNode("thead",null,[t.createElementVNode("tr",null,[t.createElementVNode("th",{style:{width:"90px"}}," \u7F16\u7801\u5668 "),t.createElementVNode("th",null,"\u63CF\u8FF0")])],-1),en={class:"break-text"},tn=t.defineComponent({name:"EncoderInfoList"}),He=t.defineComponent(M(R({},tn),{props:{modelValue:{type:Array,default:()=>[]}},setup(e){return(n,a)=>{const r=t.resolveComponent("VTable"),i=t.resolveComponent("EmptyTip");return e.modelValue&&e.modelValue.length?(t.openBlock(),t.createBlock(r,{key:0},{default:t.withCtx(()=>[Qt,t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.modelValue,s=>(t.openBlock(),t.createElementBlock("tr",{key:s.name},[t.createElementVNode("td",en,t.toDisplayString(s.name),1),t.createElementVNode("td",null,t.toDisplayString(s.describe),1)]))),128))])]),_:1})):(t.openBlock(),t.createBlock(i,{key:1}))}}})),nn=t.defineComponent({name:"EncoderInfo"}),an=t.defineComponent(M(R({},nn),{props:{modelValue:{type:Array,default:()=>[]}},setup(e){const n=e,a=()=>{window.SfcUtils.openComponentDialog(He,{props:{modelValue:n.modelValue},title:"\u7F16\u7801\u5668\u8BE6\u60C5"})};return(r,i)=>(t.openBlock(),t.createElementBlock("a",{class:"link",onClick:a},"\u67E5\u770B\u8BE6\u60C5("+t.toDisplayString(e.modelValue.length)+"\u4E2A)",1))}}));var G;(e=>{function n(){return{url:"/video/getFFMpegInfo"}}e.getFFMpegInfo=n;function a(o){return{url:"/video/encodeConvert",data:o,method:"post",headers:{"Content-Type":"application/json"}}}e.encodeConvert=a;function r(){return{url:"/video/check"}}e.check=r;function i(o,l,c,f){return{url:"/video/listConvertTask",params:{uid:o,status:l,page:c,pageSize:f}}}e.listConvertTask=i;function s(o){return{url:"/video/getLog",params:{taskId:o}}}e.getLog=s})(G||(G={}));const rn=t.createTextVNode(" \u68C0\u67E5 "),on=t.defineComponent({name:"VideoEnhanceCheck"}),Ye=t.defineComponent(M(R({},on),{setup(e){const n=window.SfcUtils,a=async()=>{const r=window.SfcUtils.loadingDialog({msg:"\u68C0\u67E5\u4E2D..."});try{await n.request(G.check()),r.close(),await n.sleep(250),await n.alert("\u914D\u7F6E\u6B63\u786E")}catch(i){r.close(),await n.sleep(250),n.alert(""+i,"\u914D\u7F6E\u9519\u8BEF")}};return(r,i)=>{const s=t.resolveComponent("VBtn");return t.openBlock(),t.createElementBlock("div",null,[t.createVNode(s,{onClick:a},{default:t.withCtx(()=>[rn]),_:1})])}}}));window.bootContext.addProcessor({taskName:"\u6CE8\u518C\u7EC4\u4EF6",execute(e,n){e.component("ConfigureInfo",Zt),e.component("EncoderInfo",an),e.component("EncoderInfoList",He),e.component(Ye.name,Ye)}});function be(e){return e<10?"0"+e:""+e}var fe;(e=>{function n(r){return r<1e3?r+"bps":r<1e6?(Number(r)/1e3).toFixed(2)+"Kbps":r<1e9?(Number(r)/1e6).toFixed(2)+"Mbps":r}e.formatBitRate=n;function a(r){const i=Number(r),s=be(Math.floor(i/3600)),o=be(Math.floor(i/60%60)),l=be(Math.floor(i%60));return`${s}:${o}:${l}`}e.formatDuration=a})(fe||(fe={}));const sn=t.createElementVNode("div",{class:"text-title"}," \u57FA\u672C\u4FE1\u606F ",-1),ln=t.createElementVNode("td",{style:{"min-width":"160px"}}," \u5C01\u88C5\u683C\u5F0F ",-1),cn=t.createElementVNode("td",null,"\u5C01\u88C5\u683C\u5F0F\u5168\u79F0",-1),dn=t.createElementVNode("td",null,"\u7801\u7387",-1),fn=t.createElementVNode("td",null,"\u6301\u7EED\u65F6\u957F",-1),un={key:0},hn=t.createElementVNode("td",null,"\u5176\u4ED6\u6807\u8BB0",-1),pn=t.createElementVNode("thead",null,[t.createElementVNode("tr",null,[t.createElementVNode("th",null,"\u540D\u79F0"),t.createElementVNode("th",null,"\u503C")])],-1),mn=t.createElementVNode("div",{class:"text-title"}," \u89C6\u9891\u6D41 ",-1),vn=t.createElementVNode("thead",null,[t.createElementVNode("tr",null,[t.createElementVNode("th",null,"\u7F16\u7801"),t.createElementVNode("th",null,"\u5206\u8FA8\u7387"),t.createElementVNode("th",null,"\u5E27\u7387"),t.createElementVNode("th",null,"\u8BED\u8A00")])],-1),yn=t.createElementVNode("div",{class:"text-title"}," \u97F3\u9891\u6D41 ",-1),gn=t.createElementVNode("thead",null,[t.createElementVNode("tr",null,[t.createElementVNode("th",null,"\u7F16\u7801"),t.createElementVNode("th",null,"\u91C7\u6837"),t.createElementVNode("th",null,"\u7801\u7387"),t.createElementVNode("th",null,"\u58F0\u9053"),t.createElementVNode("th",null,"\u8BED\u8A00")])],-1),wn=t.defineComponent({name:"VideoInfo"}),xn=t.defineComponent(M(R({},wn),{props:{videoInfo:{type:Object,default:()=>({})},file:{type:Object,default:void 0}},setup(e){const n=e,a=t.ref(!1),r=t.computed(()=>n.videoInfo.streams.filter(s=>s.codecType=="video")),i=t.computed(()=>n.videoInfo.streams.filter(s=>s.codecType=="audio"));return(s,o)=>{const l=t.resolveComponent("VTable");return t.openBlock(),t.createElementBlock("div",null,[sn,t.createVNode(l,null,{default:t.withCtx(()=>[t.createElementVNode("tbody",null,[t.createElementVNode("tr",null,[ln,t.createElementVNode("td",null,t.toDisplayString(e.videoInfo.format.formatName),1)]),t.createElementVNode("tr",null,[cn,t.createElementVNode("td",null,t.toDisplayString(e.videoInfo.format.formatLongName),1)]),t.createElementVNode("tr",null,[dn,t.createElementVNode("td",null,t.toDisplayString(t.unref(fe).formatBitRate(e.videoInfo.format.bitRate))+" ("+t.toDisplayString(e.videoInfo.format.bitRate)+")",1)]),t.createElementVNode("tr",null,[fn,t.createElementVNode("td",null,t.toDisplayString(t.unref(fe).formatDuration(e.videoInfo.format.duration)),1)]),e.videoInfo.format.tags?(t.openBlock(),t.createElementBlock("tr",un,[hn,t.createElementVNode("td",null,[a.value?(t.openBlock(),t.createBlock(l,{key:0},{default:t.withCtx(()=>[pn,t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(Object.keys(e.videoInfo.format.tags),c=>(t.openBlock(),t.createElementBlock("tr",{key:c},[t.createElementVNode("td",null,t.toDisplayString(c),1),t.createElementVNode("td",null,t.toDisplayString(e.videoInfo.format.tags[c]),1)]))),128))])]),_:1})):t.createCommentVNode("",!0),t.createElementVNode("a",{class:"link",onClick:o[0]||(o[0]=c=>a.value=!a.value)},t.toDisplayString(a.value?"\u6536\u8D77":"\u5C55\u5F00"),1)])])):t.createCommentVNode("",!0)])]),_:1}),mn,t.createVNode(l,null,{default:t.withCtx(()=>[vn,t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(r),c=>(t.openBlock(),t.createElementBlock("tr",{key:c.index},[t.createElementVNode("td",null,t.toDisplayString(c.codecName),1),t.createElementVNode("td",null,t.toDisplayString(c.width)+"x"+t.toDisplayString(c.height),1),t.createElementVNode("td",null,t.toDisplayString((c.avgFrameRate||0).toFixed(3)),1),t.createElementVNode("td",null,t.toDisplayString(c.language||"-"),1)]))),128))])]),_:1}),yn,t.createVNode(l,null,{default:t.withCtx(()=>[gn,t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(i),c=>(t.openBlock(),t.createElementBlock("tr",{key:c.index},[t.createElementVNode("td",null,t.toDisplayString(c.codecName),1),t.createElementVNode("td",null,t.toDisplayString(c.sampleRate/1e3)+"kHz",1),t.createElementVNode("td",null,t.toDisplayString(c.bitRate/1e3)+"K",1),t.createElementVNode("td",null,t.toDisplayString(c.channels),1),t.createElementVNode("td",null,t.toDisplayString(c.language||"-"),1)]))),128))])]),_:1})])}}})),_n=t.createElementVNode("div",{class:"text-h6"}," \u89C6\u9891 ",-1),bn=t.createElementVNode("thead",null,[t.createElementVNode("tr",null,[t.createElementVNode("th",{style:{width:"64px"}}," \u9009\u62E9 "),t.createElementVNode("th",null,"\u539F\u7F16\u7801"),t.createElementVNode("th",null,"\u8BED\u8A00"),t.createElementVNode("th",null,"\u7F16\u7801\u5668")])],-1),Cn=t.createElementVNode("div",{class:"text-h6"}," \u97F3\u9891 ",-1),En=t.createElementVNode("thead",null,[t.createElementVNode("tr",null,[t.createElementVNode("th",{style:{width:"64px"}}," \u9009\u62E9 "),t.createElementVNode("th",null,"\u539F\u7F16\u7801"),t.createElementVNode("th",null,"\u8BED\u8A00"),t.createElementVNode("th",null,"\u7F16\u7801\u5668")])],-1),Sn=t.defineComponent({name:"VideoConvertForm"}),kn=t.defineComponent(M(R({},Sn),{props:{videoInfo:{type:Object,default:()=>({})}},emits:["submit"],setup(e,{expose:n,emit:a}){const r=e,i=t.ref(),s=t.ref(),o={title:"\u590D\u5236",value:"copy"},l=window.FormUtils.defineForm({actions:{async submit(){if(!r.videoInfo.streams.find(w=>(w.codecType=="audio"||w.codecType=="video")&&c.mapStreams[w.index]))throw new Error("\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u97F3\u9891\u6216\u89C6\u9891\u6D41");r.videoInfo.streams.find(w=>w.codecType=="video"&&c.mapStreams[w.index])||await window.SfcUtils.confirm("\u6CA1\u6709\u9009\u62E9\u89C6\u9891\u6D41\uFF0C\u786E\u5B9A\uFF1F","\u63D0\u793A",{cancelToReject:!0}),r.videoInfo.streams.find(w=>w.codecType=="audio"&&c.mapStreams[w.index])||await window.SfcUtils.confirm("\u6CA1\u6709\u9009\u62E9\u97F3\u9891\u6D41\uFF0C\u786E\u5B9A\uFF1F","\u63D0\u793A",{cancelToReject:!0}),u()},async loadFFMpegInfo(){v.beginLoading();try{const h=(await window.SfcUtils.request(G.getFFMpegInfo())).data.data;s.value=h,g.video=[o].concat(h.videoEncoders.filter(w=>w.name.includes("264")||w.name.includes("265")||w.name.includes("hevc")).map(w=>({title:w.name,value:w.name}))),g.audio=[o].concat(h.audioEncoders.filter(w=>w.name.includes("aac")).map(w=>({title:w.name,value:w.name}))),g.subtitle=[o].concat(h.subtitleEncoders.map(w=>({title:w.name,value:w.name})))}catch(h){window.SfcUtils.snackbar(h)}finally{v.closeLoading()}}},formData:{convertRules:{},mapStreams:{},enabledConvertRules:[]},formRef:i,validators:{},throwError:!0}),{formData:c,actions:f,validators:d,loadingRef:p,loadingManager:v}=l,u=()=>{c.enabledConvertRules=r.videoInfo.streams.filter(h=>c.mapStreams[h.index]).map(h=>c.convertRules[h.index]),c.enabledConvertRules.forEach(h=>{h.encoder!="copy"?h.method="convert":h.method="copy"})};r.videoInfo.streams.forEach(h=>{c.convertRules[h.index]={index:h.index,encoder:"copy",method:"copy",type:h.codecType},c.mapStreams[h.index]=!0}),u(),t.onMounted(async()=>{await f.loadFFMpegInfo()});const m=t.computed(()=>r.videoInfo.streams.filter(h=>h.codecType=="video")),y=t.computed(()=>r.videoInfo.streams.filter(h=>h.codecType=="audio"));t.computed(()=>r.videoInfo.streams.filter(h=>h.codecType=="subtitle"));const g=t.reactive({video:[],audio:[],subtitle:[]});return n(l),(h,w)=>{const N=t.resolveComponent("LoadingMask"),x=t.resolveComponent("VCheckbox"),E=t.resolveComponent("FormSelect"),_=t.resolveComponent("VTable"),S=t.resolveComponent("base-form");return t.openBlock(),t.createBlock(S,{ref_key:"formRef",ref:i,"model-value":t.unref(c),"submit-action":t.unref(f).submit},{default:t.withCtx(()=>[t.createVNode(N,{loading:t.unref(p)},null,8,["loading"]),_n,t.createVNode(_,null,{default:t.withCtx(()=>[bn,t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(m),b=>(t.openBlock(),t.createElementBlock("tr",{key:b.index},[t.createElementVNode("td",null,[t.createVNode(x,{modelValue:t.unref(c).mapStreams[b.index],"onUpdate:modelValue":C=>t.unref(c).mapStreams[b.index]=C,color:"primary",style:{"margin-top":"6px"},density:"comfortable","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),t.createElementVNode("td",null,t.toDisplayString(b.codecName),1),t.createElementVNode("td",null,t.toDisplayString(b.language||"-"),1),t.createElementVNode("td",null,[t.unref(g).video.length?(t.openBlock(),t.createBlock(E,{key:0,modelValue:t.unref(c).convertRules[b.index].encoder,"onUpdate:modelValue":C=>t.unref(c).convertRules[b.index].encoder=C,disabled:!t.unref(c).mapStreams[b.index],style:{width:"160px"},items:t.unref(g).video,onChange:u},null,8,["modelValue","onUpdate:modelValue","disabled","items"])):t.createCommentVNode("",!0)])]))),128))])]),_:1}),Cn,t.createVNode(_,null,{default:t.withCtx(()=>[En,t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(y),b=>(t.openBlock(),t.createElementBlock("tr",{key:b.index},[t.createElementVNode("td",null,[t.createVNode(x,{modelValue:t.unref(c).mapStreams[b.index],"onUpdate:modelValue":C=>t.unref(c).mapStreams[b.index]=C,color:"primary",style:{"margin-top":"6px"},density:"comfortable","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),t.createElementVNode("td",null,t.toDisplayString(b.codecName),1),t.createElementVNode("td",null,t.toDisplayString(b.language||"-"),1),t.createElementVNode("td",null,[t.unref(g).audio.length?(t.openBlock(),t.createBlock(E,{key:0,modelValue:t.unref(c).convertRules[b.index].encoder,"onUpdate:modelValue":C=>t.unref(c).convertRules[b.index].encoder=C,disabled:!t.unref(c).mapStreams[b.index],style:{width:"160px"},items:t.unref(g).audio,onChange:u},null,8,["modelValue","onUpdate:modelValue","disabled","items"])):t.createCommentVNode("",!0)])]))),128))])]),_:1})]),_:1},8,["model-value","submit-action"])}}})),Nn={style:{padding:"16px"}},Vn={class:"d-flex align-center"},Fn={style:{padding:"0 8px",flex:"1"}},Bn={class:"break-text"},Dn={class:"tip",style:{"line-height":"16px"}},An={key:0},Tn={key:1},In={key:2},$n={key:3},Ln={key:0,class:"break-text"},Rn={class:"min-width: 64px"},Mn=t.createElementVNode("div",null,[t.createElementVNode("a",{style:{"font-size":"9px"}},"\u67E5\u770B\u65E5\u5FD7")],-1),Un=t.createElementVNode("div",null,[t.createElementVNode("a",{style:{"font-size":"9px"}},"\u53D6\u6D88")],-1),Pn=t.defineComponent({name:"EncodeConvertTaskInfo"}),ue=t.defineComponent(M(R({},Pn),{props:{task:{type:Object,default(){return{}}},haveLog:{type:Boolean,default:!1},showCancel:{type:Boolean,default:!1}},setup(e){const n=e,a=t.computed(()=>JSON.parse(n.task.params||"{}")),r=window.StringFormatter.toDate,i=async()=>{const o=window.SfcUtils.loadingDialog();try{const l=(await window.SfcUtils.request(G.getLog(n.task.asyncTaskRecord.id))).data.data;l?window.SfcUtils.openComponentDialog(window.components.CodeEditor,{props:{modelValue:l.taskLog,readOnly:!0,useMiniMap:!0,style:{height:"100%"}},fullscreen:!0}):window.SfcUtils.alert("\u6CA1\u80FD\u67E5\u8BE2\u5230\u65E5\u5FD7")}catch(l){window.SfcUtils.alert(l,"\u9519\u8BEF")}finally{o.close()}},s=async()=>{const o=window.SfcUtils.loadingDialog({msg:"\u8BF7\u6C42\u4E2D..."});try{await window.SfcUtils.sleep(150),await window.SfcUtils.request(window.API.asyncTask.interrupt(n.task.asyncTaskRecord.id)),o.close()}catch(l){o.close(),await window.SfcUtils.sleep(250),window.SfcUtils.alert("\u8BF7\u6C42\u5931\u8D25: "+l)}};return(o,l)=>{var p,v;const c=t.resolveComponent("FileIcon"),f=t.resolveComponent("VProgressLinear"),d=t.resolveComponent("CommonIcon");return t.openBlock(),t.createElementBlock("div",Nn,[t.createElementVNode("div",Vn,[t.createElementVNode("div",null,[t.createVNode(c,{width:"36","file-name":"aaa.mp4"})]),t.createElementVNode("div",Fn,[t.createElementVNode("div",Bn,[t.createElementVNode("div",null,t.toDisplayString((v=(p=t.unref(a))==null?void 0:p.source)==null?void 0:v.name),1),t.createElementVNode("div",Dn,[e.task.asyncTaskRecord.executeDate?(t.openBlock(),t.createElementBlock("div",An," \u6267\u884C\u65E5\u671F: "+t.toDisplayString(t.unref(r)(e.task.asyncTaskRecord.executeDate)),1)):t.createCommentVNode("",!0),e.task.asyncTaskRecord.finishDate?(t.openBlock(),t.createElementBlock("div",Tn," \u5B8C\u6210\u65E5\u671F: "+t.toDisplayString(t.unref(r)(e.task.asyncTaskRecord.finishDate)),1)):t.createCommentVNode("",!0),e.task.asyncTaskRecord.failedDate?(t.openBlock(),t.createElementBlock("div",In," \u5931\u8D25\u65E5\u671F: "+t.toDisplayString(t.unref(r)(e.task.asyncTaskRecord.failedDate)),1)):t.createCommentVNode("",!0),e.task.asyncTaskRecord.executeDate?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",$n,t.toDisplayString(e.task.asyncTaskRecord.status==4?"\u5DF2\u53D6\u6D88":"\u7B49\u5F85\u4E2D"),1))])]),e.task.progress?(t.openBlock(),t.createElementBlock("div",Ln,[t.createVNode(f,{color:"primary","model-value":e.task.progress.loaded,max:e.task.progress.total},null,8,["model-value","max"])])):t.createCommentVNode("",!0)]),t.createElementVNode("div",Rn,[t.createElementVNode("div",{class:"text-center link",onClick:i},[t.createElementVNode("div",null,[t.createVNode(d,{color:"primary",icon:"mdi-eye"})]),Mn]),e.showCancel?(t.openBlock(),t.createElementBlock("div",{key:0,class:"text-center link",style:{"margin-left":"12px"},onClick:s},[t.createElementVNode("div",null,[t.createVNode(d,{color:"primary",icon:"mdi-close"})]),Un])):t.createCommentVNode("",!0)])])])}}})),On=t.createTextVNode(" \u8FDB\u884C\u4E2D"),zn=t.createTextVNode(" \u5DF2\u5B8C\u6210"),jn={key:0},qn=t.createTextVNode(" \u6267\u884C\u5931\u8D25"),Hn={key:0},Yn=t.defineComponent({name:"EncodeConvertTask",components:{EncodeConvertTaskInfo:ue}}),Gn=t.defineComponent(M(R({},Yn),{props:{uid:{type:[String,Number],default:0}},setup(e){const n=e,a=t.ref("1"),r=t.ref(0),i=t.ref([]),s=t.ref([]),o=t.ref(0),l=t.ref([]),c=t.ref(0),f=async y=>(await window.SfcUtils.request(G.listConvertTask(n.uid,y,0,20))).data.data,d=async()=>{const y=f(1),g=f(0),h=await Promise.all([y,g]);r.value=Number(h[0].totalCount)||0,i.value=h[0].content,r.value+=Number(h[1].totalCount),i.value=i.value.concat(h[1].content)},p=async()=>{const y=await f(2);o.value=y.totalCount,s.value=y.content},v=async()=>{const y=await Promise.all([f(3),f(4)]);c.value=Number(y[0].totalCount)+Number(y[1].totalCount),l.value=(y[0].content||[]).concat(y[1].content)};let u,m=!1;return t.onMounted(()=>{p(),d(),v(),u=setInterval(async()=>{if(!m)try{m=!0;let y;a.value=="1"?y=d():a.value=="2"?y=p():y=v(),await y}finally{m=!1}},2500)}),t.onUnmounted(()=>{u&&clearInterval(u)}),(y,g)=>{const h=t.resolveComponent("v-tab"),w=t.resolveComponent("v-tabs"),N=t.resolveComponent("EmptyTip"),x=t.resolveComponent("v-window-item"),E=t.resolveComponent("v-window");return t.openBlock(),t.createElementBlock("div",null,[t.createVNode(w,{modelValue:a.value,"onUpdate:modelValue":g[0]||(g[0]=_=>a.value=_),color:"primary","fixed-tabs":""},{default:t.withCtx(()=>[t.createVNode(h,{value:"1"},{default:t.withCtx(()=>[On,t.createElementVNode("span",null,"("+t.toDisplayString(r.value)+")",1)]),_:1}),t.createVNode(h,{value:"2"},{default:t.withCtx(()=>[zn,o.value?(t.openBlock(),t.createElementBlock("span",jn,"("+t.toDisplayString(o.value)+")",1)):t.createCommentVNode("",!0)]),_:1}),t.createVNode(h,{value:"3"},{default:t.withCtx(()=>[qn,c.value?(t.openBlock(),t.createElementBlock("span",Hn,"("+t.toDisplayString(c.value)+")",1)):t.createCommentVNode("",!0)]),_:1})]),_:1},8,["modelValue"]),t.createVNode(E,{modelValue:a.value,"onUpdate:modelValue":g[1]||(g[1]=_=>a.value=_)},{default:t.withCtx(()=>[t.createVNode(x,{value:"1"},{default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(i.value,_=>(t.openBlock(),t.createBlock(ue,{key:_.id,task:_,"show-cancel":""},null,8,["task"]))),128)),i.value.length?t.createCommentVNode("",!0):(t.openBlock(),t.createBlock(N,{key:0}))]),_:1}),t.createVNode(x,{value:"2"},{default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(s.value,_=>(t.openBlock(),t.createBlock(ue,{key:_.id,task:_,"have-log":!0},null,8,["task"]))),128)),s.value.length?t.createCommentVNode("",!0):(t.openBlock(),t.createBlock(N,{key:0}))]),_:1}),t.createVNode(x,{value:"3"},{default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(l.value,_=>(t.openBlock(),t.createBlock(ue,{key:_.id,task:_,"have-log":!0},null,8,["task"]))),128)),l.value.length?t.createCommentVNode("",!0):(t.openBlock(),t.createBlock(N,{key:0}))]),_:1})]),_:1},8,["modelValue"])])}}})),j=window.context,q=window.SfcUtils;function Wn(e,n,a,r){if(!n.name.endsWith(".mkv"))return null;const i={name:n.name,path:a,protocol:"subtitle",targetId:e.uid,stream:r};if(e.protocol=="main")return window.SfcUtils.getApiUrl(window.API.resource.getCommonResource(i));const s=e.getProtocolParams();return i.sourceProtocol=e.protocol,i.sourceId=s.id,Object.keys(s).filter(o=>o!="id").forEach(o=>{i[o]=s[o]}),window.SfcUtils.getApiUrl(window.API.resource.getCommonResource(i))}async function Ce(e,n,a){const r={name:n.name,path:a,targetId:e.uid,sourceProtocol:e.protocol||"main",protocol:e.protocol||"main"},i=e.getProtocolParams();return r.sourceId=i.id,Object.keys(i).filter(s=>s!="id").forEach(s=>{r[s]=i[s]}),r}async function Ee(e,n,a){const r=await Ce(e,n,a);return r.protocol="videoInfo",(await await q.request(window.API.resource.getCommonResource(r))).data}const Xn=new Set(["mp4","mkv","avi","rm","rmvb","m4v","flv","mpg","mpeg","mpe","ts"]);function Se(e){const n=e.split(".").pop();return!!n&&Xn.has(n)}const he=j.fileOpenHandler.value.findIndex(e=>e.id=="play-video"),ke=he==-1?null:j.fileOpenHandler.value[he],Ge={id:"player",icon:"mdi-play-circle",matcher(e,n){return Se(n.name)},title:"\u64AD\u653E\u89C6\u9891",async action(e,n){try{let a=n.path;a||(a=(await q.request(window.API.resource.parseNodeId(n.uid,n.node))).data.data),q.beginLoading(),await window.SfcUtils.sleep(100);const r=await Ee(e,n,a),i=[],s=n.name.lastIndexOf(".");if(s!=-1){const o=n.name.substring(0,s),l=["ass","vtt"].map(f=>`${o}.${f}`),c=e.fileList.filter(f=>l.find(d=>d==f.name)).forEach(f=>{const d=e.getFileUrl(f);d&&i.push({title:`[\u5916\u6302\u5B57\u5E55] ${f.name}`,url:d,type:f.name.endsWith(".ass")?"ass":"webvtt"})})}r.streams.filter(o=>o.codecType=="subtitle").forEach(o=>{i.push({title:`${o.language}${o.title?"("+o.title+")":""}`,url:Wn(e,n,a,o.index),type:"webvtt"})}),q.openComponentDialog(Kt,{props:{url:e.getFileUrl(n),videoInfo:r,subtitleList:i},dense:!0,showCancel:!1,title:"\u89C6\u9891\u9884\u89C8\uFF1A"+n.name,extraDialogOptions:{maxWidth:"80%"}})}catch(a){ke&&ke.matcher(e,n)?(q.snackbar(`\u589E\u5F3A\u7248\u64AD\u653E\u5668\u64AD\u653E\u5931\u8D25, \u6539\u7528\u901A\u7528\u7248\u672C\u3002\u539F\u56E0: ${a}`),ke.action(e,n)):q.snackbar(a)}finally{q.closeLoading()}},sort:0},Kn={id:"video",name:"\u89C6\u9891",items:[{title:"\u89C6\u9891\u8F6C\u7801",id:"video-convert",icon:"mdi-cached",renderOn(e){return e&&e.selectFileList.length==1&&!e.selectFileList[0].mount&&Se(e.selectFileList[0].name)&&!e.readonly},async action(e){const n=e.selectFileList[0],a=await Ee(e,n,n.path),r=window.SfcUtils.openComponentDialog(kn,{props:{videoInfo:a},title:`\u89C6\u9891\u8F6C\u7801\uFF1A${e.selectFileList[0].name}`,async onConfirm(){const i=window.SfcUtils.loadingDialog({msg:"\u4EFB\u52A1\u521B\u5EFA\u4E2D"});try{if((await r.getInstAsForm().submit()).success){const o=r.getInstAsForm().getFormData().enabledConvertRules,l=await Ce(e,n,n.path),c=await Ce(e,n,n.path);return c.name="convert_"+c.name,await window.SfcUtils.request(G.encodeConvert({rules:o,source:l,target:c})),window.SfcUtils.snackbar("\u4EFB\u52A1\u521B\u5EFA\u6210\u529F"),!0}else return!1}catch(s){return q.snackbar(s),!1}finally{i.close()}}})}},{title:"\u89C6\u9891\u4FE1\u606F",id:"video-info",renderOn(e){return e&&e.selectFileList.length==1&&!e.selectFileList[0].mount&&Se(e.selectFileList[0].name)},icon:"mdi-information-variant",async action(e){const n=await Ee(e,e.selectFileList[0],e.selectFileList[0].path);window.SfcUtils.openComponentDialog(xn,{props:{videoInfo:n},title:`\u5A92\u4F53\u4FE1\u606F\uFF1A${e.selectFileList[0].name}`})}}]};j.menu.value.boxMenu.push({name:"\u89C6\u9891\u670D\u52A1",id:"video",items:[{id:"encoder-convert",title:"\u89C6\u9891\u8F6C\u7801",icon:"mdi-cached",renderOn(){return!!j.session.value.token},action(e){e.title="\u89C6\u9891\u8F6C\u7801",e.currentComponent=t.h(Gn,{style:{maxWidth:"640px",margin:"auto"},uid:j.session.value.user.id})}}]}),he!=-1?j.fileOpenHandler.value[he]=Ge:j.fileOpenHandler.value.push(Ge),j.menu.value.fileListMenu.push(Kn)});
