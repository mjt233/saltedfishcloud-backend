(function(t,F){typeof exports=="object"&&typeof module!="undefined"?F(require("vue"),require("sfc-common")):typeof define=="function"&&define.amd?define(["vue","sfc-common"],F):(t=typeof globalThis!="undefined"?globalThis:t||self,F(t.Vue,t.SfcCommon))})(this,function(t,F){"use strict";var ua=Object.defineProperty,ha=Object.defineProperties;var pa=Object.getOwnPropertyDescriptors;var Qe=Object.getOwnPropertySymbols;var ma=Object.prototype.hasOwnProperty,ga=Object.prototype.propertyIsEnumerable;var et=(t,F,$)=>F in t?ua(t,F,{enumerable:!0,configurable:!0,writable:!0,value:$}):t[F]=$,R=(t,F)=>{for(var $ in F||(F={}))ma.call(F,$)&&et(t,$,F[$]);if(Qe)for(var $ of Qe(F))ga.call(F,$)&&et(t,$,F[$]);return t},M=(t,F)=>ha(t,pa(F));const $=t.defineComponent({name:"SubtitleSelector"}),tt=t.defineComponent(M(R({},$),{props:{subtitleList:{type:Array,default:()=>[]}},setup(e){const n=e;return(a,r)=>{const i=t.resolveComponent("v-radio"),s=t.resolveComponent("v-radio-group");return t.openBlock(),t.createBlock(s,null,{default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(n.subtitleList,(o,l)=>(t.openBlock(),t.createBlock(i,{key:l,color:"primary",label:o.title,value:o},null,8,["label","value"]))),128))]),_:1})}}}));var P;(e=>{function n(){return{url:"/video/getFFMpegInfo"}}e.getFFMpegInfo=n;function a(c){return{url:"/video/encodeConvert",data:c,method:"post",headers:{"Content-Type":"application/json"}}}e.encodeConvert=a;function r(){return{url:"/video/check"}}e.check=r;function i(c,f,d,h){return{url:"/video/listConvertTask",params:{uid:c,status:f,page:d,pageSize:h}}}e.listConvertTask=i;function s(c){return{url:"/video/getLog",params:{taskId:c}}}e.getLog=s;function o(c,f,d){return{url:"/video/recordWatchProgress",params:{uid:c,identify:f,time:d},method:"post"}}e.recordWatchProgress=o;function l(c,f){return{url:"/video/getWatchProgress",params:{uid:c,identify:f}}}e.getWatchProgress=l})(P||(P={}));function nt(e){var n=e.toLowerCase().trim().split(/\s*;\s*/);return n[0]==="banner"?{name:n[0],delay:n[1]*1||0,leftToRight:n[2]*1||0,fadeAwayWidth:n[3]*1||0}:/^scroll\s/.test(n[0])?{name:n[0],y1:Math.min(n[1]*1,n[2]*1),y2:Math.max(n[1]*1,n[2]*1),delay:n[3]*1||0,fadeAwayHeight:n[4]*1||0}:null}function me(e){return e.toLowerCase().replace(/([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?)/g," $1 ").replace(/([mnlbspc])/g," $1 ").trim().replace(/\s+/g," ").split(/\s(?=[mnlbspc])/).map(function(n){return n.split(" ").filter(function(a,r){return!(r&&Number.isNaN(a*1))})})}var at=["b","i","u","s","fsp","k","K","kf","ko","kt","fe","q","p","pbo","a","an","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"],Ve=at.map(function(e){return{name:e,regex:new RegExp("^"+e+"-?\\d")}});function Fe(e){for(var n,a={},r=0;r<Ve.length;r++){var i=Ve[r],s=i.name,o=i.regex;if(o.test(e))return a[s]=e.slice(s.length)*1,a}if(/^fn/.test(e))a.fn=e.slice(2);else if(/^r/.test(e))a.r=e.slice(1);else if(/^fs[\d+-]/.test(e))a.fs=e.slice(2);else if(/^\d?c&?H?[0-9a-f]+|^\d?c$/i.test(e)){var l=e.match(/^(\d?)c&?H?(\w*)/),c=l[1],f=l[2];a["c"+(c||1)]=f&&("000000"+f).slice(-6)}else if(/^\da&?H?[0-9a-f]+/i.test(e)){var d=e.match(/^(\d)a&?H?(\w\w)/),h=d[1],v=d[2];a["a"+h]=v}else if(/^alpha&?H?[0-9a-f]+/i.test(e))n=e.match(/^alpha&?H?([0-9a-f]+)/i),a.alpha=n[1],a.alpha=("00"+a.alpha).slice(-2);else if(/^(?:pos|org|move|fad|fade)\(/.test(e)){var u=e.match(/^(\w+)\((.*?)\)?$/),g=u[1],w=u[2];a[g]=w.trim().split(/\s*,\s*/).map(Number)}else if(/^i?clip/.test(e)){var _=e.match(/^i?clip\((.*?)\)?$/)[1].trim().split(/\s*,\s*/);a.clip={inverse:/iclip/.test(e),scale:1,drawing:null,dots:null},_.length===1&&(a.clip.drawing=me(_[0])),_.length===2&&(a.clip.scale=_[0]*1,a.clip.drawing=me(_[1])),_.length===4&&(a.clip.dots=_.map(Number))}else if(/^t\(/.test(e)){var p=e.match(/^t\((.*?)\)?$/)[1].trim().replace(/\\.*/,function(b){return b.replace(/,/g,`
`)}).split(/\s*,\s*/);if(!p[0])return a;a.t={t1:0,t2:0,accel:1,tags:p[p.length-1].replace(/\n/g,",").split("\\").slice(1).map(Fe)},p.length===2&&(a.t.accel=p[0]*1),p.length===3&&(a.t.t1=p[0]*1,a.t.t2=p[1]*1),p.length===4&&(a.t.t1=p[0]*1,a.t.t2=p[1]*1,a.t.accel=p[2]*1)}return a}function rt(e){for(var n=[],a=0,r="",i=0;i<e.length;i++){var s=e[i];s==="("&&a++,s===")"&&a--,a<0&&(a=0),!a&&s==="\\"?(r&&n.push(r),r=""):r+=s}return n.push(r),n.map(Fe)}function ot(e){var n=e.split(/{([^{}]*?)}/),a=[];n[0].length&&a.push({tags:[],text:n[0],drawing:[]});for(var r=1;r<n.length;r+=2){var i=rt(n[r]),s=i.reduce(function(o,l){return l.p===void 0?o:!!l.p},!1);a.push({tags:i,text:s?"":n[r+1],drawing:s?me(n[r+1]):[]})}return{raw:e,combined:a.map(function(o){return o.text}).join(""),parsed:a}}function it(e){var n=e.split(":");return n[0]*3600+n[1]*60+n[2]*1}function st(e,n){var a=e.split(",");if(a.length>n.length){var r=a.slice(n.length-1).join();a=a.slice(0,n.length-1),a.push(r)}for(var i={},s=0;s<a.length;s++){var o=n[s],l=a[s].trim();switch(o){case"Layer":case"MarginL":case"MarginR":case"MarginV":i[o]=l*1;break;case"Start":case"End":i[o]=it(l);break;case"Effect":i[o]=nt(l);break;case"Text":i[o]=ot(l);break;default:i[o]=l}}return i}function Be(e){return e.match(/Format\s*:\s*(.*)/i)[1].split(/\s*,\s*/)}function lt(e){return e.match(/Style\s*:\s*(.*)/i)[1].split(/\s*,\s*/)}function ct(e){for(var n={info:{},styles:{format:[],style:[]},events:{format:[],comment:[],dialogue:[]}},a=e.split(/\r?\n/),r=0,i=0;i<a.length;i++){var s=a[i].trim();if(!/^;/.test(s)&&(/^\[Script Info\]/i.test(s)?r=1:/^\[V4\+? Styles\]/i.test(s)?r=2:/^\[Events\]/i.test(s)?r=3:/^\[.*\]/.test(s)&&(r=0),r!==0)){if(r===1&&/:/.test(s)){var o=s.match(/(.*?)\s*:\s*(.*)/),l=o[1],c=o[2];n.info[l]=c}if(r===2&&(/^Format\s*:/i.test(s)&&(n.styles.format=Be(s)),/^Style\s*:/i.test(s)&&n.styles.style.push(lt(s))),r===3&&(/^Format\s*:/i.test(s)&&(n.events.format=Be(s)),/^(?:Comment|Dialogue)\s*:/i.test(s))){var f=s.match(/^(\w+?)\s*:\s*(.*)/i),d=f[1],h=f[2];n.events[d.toLowerCase()].push(st(h,n.events.format))}}}return n}var B=Object.assign||function(n){for(var a=[],r=arguments.length-1;r-- >0;)a[r]=arguments[r+1];for(var i=0;i<a.length;i++)if(!!a[i])for(var s=Object.keys(a[i]),o=0;o<s.length;o++)n[s[o]]=a[i][s[o]];return n};function dt(e){var n={type:null,prev:null,next:null,points:[]};/[mnlbs]/.test(e[0])&&(n.type=e[0].toUpperCase().replace("N","L").replace("B","C"));for(var a=e.length-!(e.length&1),r=1;r<a;r+=2)n.points.push({x:e[r]*1,y:e[r+1]*1});return n}function ft(e){return!(!e.points.length||!e.type||/C|S/.test(e.type)&&e.points.length<3)}function ut(e){var n,a=1/0,r=1/0,i=-1/0,s=-1/0;return(n=[]).concat.apply(n,e.map(function(o){var l=o.points;return l})).forEach(function(o){var l=o.x,c=o.y;a=Math.min(a,l),r=Math.min(r,c),i=Math.max(i,l),s=Math.max(s,c)}),{minX:a,minY:r,width:i-a,height:s-r}}function ht(e,n,a){var r=[],i=[0,.6666666666666666,.3333333333333333,0],s=[0,1/3,2/3,0],o=[0,1/6,2/3,1/6],l=function(v,u){return v[0]*u[0]+v[1]*u[1]+v[2]*u[2]+v[3]*u[3]},c=[e[e.length-1].x,e[0].x,e[1].x,e[2].x],f=[e[e.length-1].y,e[0].y,e[1].y,e[2].y];r.push({type:n==="M"?"M":"L",points:[{x:l(o,c),y:l(o,f)}]});for(var d=3;d<e.length;d++)c=[e[d-3].x,e[d-2].x,e[d-1].x,e[d].x],f=[e[d-3].y,e[d-2].y,e[d-1].y,e[d].y],r.push({type:"C",points:[{x:l(i,c),y:l(i,f)},{x:l(s,c),y:l(s,f)},{x:l(o,c),y:l(o,f)}]});if(a==="L"||a==="C"){var h=e[e.length-1];r.push({type:"L",points:[{x:h.x,y:h.y}]})}return r}function pt(e){return e.map(function(n){var a=n.type,r=n.points;return a+r.map(function(i){var s=i.x,o=i.y;return s+","+o}).join(",")}).join("")}function De(e){for(var n,a=[],r=0;r<e.length;){var i=e[r],s=dt(i);if(ft(s)){if(s.type==="S"){var o=(a[r-1]||{points:[{x:0,y:0}]}).points.slice(-1)[0],l=o.x,c=o.y;s.points.unshift({x:l,y:c})}r&&(s.prev=a[r-1].type,a[r-1].next=s.type),a.push(s),r++}else{if(r&&a[r-1].type==="S"){var f={p:s.points,c:a[r-1].points.slice(0,3)};a[r-1].points=a[r-1].points.concat((f[i[0]]||[]).map(function(h){var v=h.x,u=h.y;return{x:v,y:u}}))}e.splice(r,1)}}var d=(n=[]).concat.apply(n,a.map(function(h){var v=h.type,u=h.points,g=h.prev,w=h.next;return v==="S"?ht(u,g,w):{type:v,points:u}}));return B({instructions:d,d:pt(d)},ut(a))}var mt=["fs","clip","c1","c2","c3","c4","a1","a2","a3","a4","alpha","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"];function j(e,n,a){var r,i,s;a===void 0&&(a={});var o=e[n];if(o===void 0)return null;if(n==="pos"||n==="org")return o.length===2?(r={},r[n]={x:o[0],y:o[1]},r):null;if(n==="move"){var l=o[0],c=o[1],f=o[2],d=o[3],h=o[4];h===void 0&&(h=0);var v=o[5];return v===void 0&&(v=0),o.length===4||o.length===6?{move:{x1:l,y1:c,x2:f,y2:d,t1:h,t2:v}}:null}if(n==="fad"||n==="fade"){if(o.length===2){var u=o[0],g=o[1];return{fade:{type:"fad",t1:u,t2:g}}}if(o.length===7){var w=o[0],_=o[1],p=o[2],b=o[3],N=o[4],m=o[5],x=o[6];return{fade:{type:"fade",a1:w,a2:_,a3:p,t1:b,t2:N,t3:m,t4:x}}}return null}if(n==="clip"){var y=o.inverse,S=o.scale,E=o.drawing,C=o.dots;if(E)return{clip:{inverse:y,scale:S,drawing:De(E),dots:C}};if(C){var A=C[0],T=C[1],Z=C[2],W=C[3];return{clip:{inverse:y,scale:S,drawing:E,dots:{x1:A,y1:T,x2:Z,y2:W}}}}return null}if(/^[xy]?(bord|shad)$/.test(n)&&(o=Math.max(o,0)),n==="bord")return{xbord:o,ybord:o};if(n==="shad")return{xshad:o,yshad:o};if(/^c\d$/.test(n))return i={},i[n]=o||a[n],i;if(n==="alpha")return{a1:o,a2:o,a3:o,a4:o};if(n==="fr")return{frz:o};if(n==="fs")return{fs:/^\+|-/.test(o)?(o*1>-10?1+o/10:1)*a.fs:o*1};if(n==="t"){var J=o.t1,se=o.accel,le=o.tags,Q=o.t2||(a.end-a.start)*1e3,Y={};return le.forEach(function(ee){var G=Object.keys(ee)[0];~mt.indexOf(G)&&!(G==="clip"&&!ee[G].dots)&&B(Y,j(ee,G,a))}),{t:{t1:J,t2:Q,accel:se,tag:Y}}}return s={},s[n]=o,s}var gt=[null,1,2,3,null,7,8,9,null,4,5,6],vt=["r","a","an","pos","org","move","fade","fad","clip"];function Ae(e,n){return{name:e,borderStyle:n[e].style.BorderStyle,tag:n[e].tag,fragments:[]}}function yt(e){for(var n=e.styles,a=e.name,r=e.parsed,i=e.start,s=e.end,o,l,c,f,d,h,v=[],u=Ae(a,n),g={},w=0;w<r.length;w++){for(var _=r[w],p=_.tags,b=_.text,N=_.drawing,m=void 0,x=0;x<p.length;x++){var y=p[x];m=y.r===void 0?m:y.r}for(var S={tag:m===void 0?JSON.parse(JSON.stringify(g)):{},text:b,drawing:N.length?De(N):null},E=0;E<p.length;E++){var C=p[E];o=o||gt[C.a||0]||C.an,l=l||j(C,"pos"),c=c||j(C,"org"),f=f||j(C,"move"),d=d||j(C,"fade")||j(C,"fad"),h=j(C,"clip")||h;var A=Object.keys(C)[0];if(A&&!~vt.indexOf(A)){var T=u.tag,Z=T.c1,W=T.c2,J=T.c3,se=T.c4,le=g.fs||u.tag.fs,Q=j(C,A,{start:i,end:s,c1:Z,c2:W,c3:J,c4:se,fs:le});A==="t"?(S.tag.t=S.tag.t||[],S.tag.t.push(Q.t)):B(S.tag,Q)}}if(g=S.tag,m!==void 0&&(v.push(u),u=Ae(n[m]?m:a,n)),S.text||S.drawing){var Y=u.fragments[u.fragments.length-1]||{};Y.text&&S.text&&!Object.keys(S.tag).length?Y.text+=S.text:u.fragments.push(S)}}return v.push(u),B({alignment:o,slices:v},l,c,f,d,h)}function wt(e){for(var n=e.styles,a=e.dialogues,r=1/0,i=[],s=0;s<a.length;s++){var o=a[s];if(!(o.Start>=o.End)){n[o.Style]||(o.Style="Default");var l=n[o.Style].style,c=yt({styles:n,name:o.Style,parsed:o.Text.parsed,start:o.Start,end:o.End}),f=c.alignment||l.Alignment;r=Math.min(r,o.Layer),i.push(B({layer:o.Layer,start:o.Start,end:o.End,margin:{left:o.MarginL||l.MarginL,right:o.MarginR||l.MarginR,vertical:o.MarginV||l.MarginV},effect:o.Effect},c,{alignment:f}))}}for(var d=0;d<i.length;d++)i[d].layer-=r;return i.sort(function(h,v){return h.start-v.start||h.end-v.end})}var xt={Name:"Default",Fontname:"Arial",Fontsize:"20",PrimaryColour:"&H00FFFFFF&",SecondaryColour:"&H000000FF&",OutlineColour:"&H00000000&",BackColour:"&H00000000&",Bold:"0",Italic:"0",Underline:"0",StrikeOut:"0",ScaleX:"100",ScaleY:"100",Spacing:"0",Angle:"0",BorderStyle:"1",Outline:"2",Shadow:"2",Alignment:"2",MarginL:"10",MarginR:"10",MarginV:"10",Encoding:"1"};function ce(e){if(/^(&|H|&H)[0-9a-f]{6,}/i.test(e)){var n=e.match(/&?H?([0-9a-f]{2})?([0-9a-f]{6})/i),a=n[1],r=n[2];return[a||"00",r]}var i=parseInt(e,10);if(!Number.isNaN(i)){var s=-2147483648,o=2147483647;if(i<s)return["00","000000"];var l=s<=i&&i<=o?("00000000"+(i<0?i+4294967296:i).toString(16)).slice(-8):String(i).slice(0,8);return[l.slice(0,2),l.slice(2)]}return["00","000000"]}function _t(e){for(var n=e.info,a=e.style,r=e.format,i=e.defaultStyle,s={},o=[B({},xt,i,{Name:"Default"})].concat(a.map(function(f){for(var d={},h=0;h<r.length;h++)d[r[h]]=f[h];return d})),l=function(f){var d=o[f];/^(\*+)Default$/.test(d.Name)&&(d.Name="Default"),Object.keys(d).forEach(function(E){E!=="Name"&&E!=="Fontname"&&!/Colour/.test(E)&&(d[E]*=1)});var h=ce(d.PrimaryColour),v=h[0],u=h[1],g=ce(d.SecondaryColour),w=g[0],_=g[1],p=ce(d.OutlineColour),b=p[0],N=p[1],m=ce(d.BackColour),x=m[0],y=m[1],S={fn:d.Fontname,fs:d.Fontsize,c1:u,a1:v,c2:_,a2:w,c3:N,a3:b,c4:y,a4:x,b:Math.abs(d.Bold),i:Math.abs(d.Italic),u:Math.abs(d.Underline),s:Math.abs(d.StrikeOut),fscx:d.ScaleX,fscy:d.ScaleY,fsp:d.Spacing,frz:d.Angle,xbord:d.Outline,ybord:d.Outline,xshad:d.Shadow,yshad:d.Shadow,q:/^[0-3]$/.test(n.WrapStyle)?n.WrapStyle*1:2};s[d.Name]={style:d,tag:S}},c=0;c<o.length;c++)l(c);return s}function bt(e,n){n===void 0&&(n={});var a=ct(e),r=_t({info:a.info,style:a.styles.style,format:a.styles.format,defaultStyle:n.defaultStyle||{}});return{info:a.info,width:a.info.PlayResX*1||null,height:a.info.PlayResY*1||null,collisions:a.info.Collisions||"Normal",styles:r,dialogues:wt({styles:r,dialogues:a.events.dialogue})}}var Te=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return setTimeout(e,50/3)},$e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||clearTimeout;function U(e){var n=e.match(/(\w\w)(\w\w)(\w\w)(\w\w)/),a=1-("0x"+n[1])/255,r=+("0x"+n[2]),i=+("0x"+n[3]),s=+("0x"+n[4]);return"rgba("+s+","+i+","+r+","+a+")"}function re(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=Math.random()*16|0,a=e==="x"?n:n&3|8;return a.toString(16)})}function k(e,n){n===void 0&&(n=[]);for(var a=document.createElementNS("http://www.w3.org/2000/svg",e),r=0;r<n.length;r++){var i=n[r];a.setAttributeNS(i[0]==="xlink:href"?"http://www.w3.org/1999/xlink":null,i[0],i[1])}return a}function ge(e){var n=document.body,a=n.style,r=e.replace(/^\w/,function(i){return i.toUpperCase()});return e in a?"":"webkit"+r in a?"-webkit-":"moz"+r in a?"-moz-":""}var X={transform:ge("transform"),animation:ge("animation"),clipPath:ge("clipPath")};function Ie(e){var n=e.getRootNode?e.getRootNode():document;return n===document?n.head:n}var Et=["c3","a3","c4","a4","xbord","ybord","xshad","yshad","blur","be"],Le=["fscx","fscy","frx","fry","frz","fax","fay"];function Ct(e){var n=this._.scriptRes.width,a=this._.scriptRes.height,r="";if(e.dots!==null){var i=e.dots,s=i.x1,o=i.y1,l=i.x2,c=i.y2;s/=n,o/=a,l/=n,c/=a,r="M"+s+","+o+"L"+s+","+c+","+l+","+c+","+l+","+o+"Z"}e.drawing!==null&&(r=e.drawing.instructions.map(function(v){var u=v.type,g=v.points;return u+g.map(function(w){var _=w.x,p=w.y;return _/n+","+p/a}).join(",")}).join(""));var f=1/(1<<e.scale-1);e.inverse&&(r+="M0,0L0,"+f+","+f+","+f+","+f+",0,0,0Z");var d="ASS-"+re(),h=k("clipPath",[["id",d],["clipPathUnits","objectBoundingBox"]]);return h.appendChild(k("path",[["d",r],["transform","scale("+f+")"],["clip-rule","evenodd"]])),this._.$defs.appendChild(h),{$clipPath:h,cssText:X.clipPath+"clip-path:url(#"+d+");"}}function St(e){if(!!e.clip){var n=document.createElement("div");this._.$stage.insertBefore(n,e.$div),n.appendChild(e.$div),n.className="ASS-fix-objectBoundingBox";var a=Ct.call(this,e.clip),r=a.cssText,i=a.$clipPath;this._.$defs.appendChild(i),n.style.cssText=r,B(e,{$div:n,$clipPath:i})}}var oe=document.createElement("div");oe.className="ASS-fix-font-size",oe.textContent="M";var ve=Object.create(null);function ye(e,n){var a=e+"-"+n;return ve[a]||(oe.style.cssText="line-height:normal;font-size:"+n+'px;font-family:"'+e+'",Arial;',ve[a]=n*n/oe.clientHeight),ve[a]}function kt(e,n,a){var r=e.xbord||e.ybord,i=e.xshad||e.yshad,s=e.a1!=="FF",o=e.blur||e.be||0,l=k("filter",[["id",n]]);l.appendChild(k("feGaussianBlur",[["stdDeviation",r?0:o],["in","SourceGraphic"],["result","sg_b"]])),l.appendChild(k("feFlood",[["flood-color",U(e.a1+e.c1)],["result","c1"]])),l.appendChild(k("feComposite",[["operator","in"],["in","c1"],["in2","sg_b"],["result","main"]])),r&&(l.appendChild(k("feMorphology",[["radius",e.xbord*a+" "+e.ybord*a],["operator","dilate"],["in","SourceGraphic"],["result","dil"]])),l.appendChild(k("feGaussianBlur",[["stdDeviation",o],["in","dil"],["result","dil_b"]])),l.appendChild(k("feComposite",[["operator","out"],["in","dil_b"],["in2","SourceGraphic"],["result","dil_b_o"]])),l.appendChild(k("feFlood",[["flood-color",U(e.a3+e.c3)],["result","c3"]])),l.appendChild(k("feComposite",[["operator","in"],["in","c3"],["in2","dil_b_o"],["result","border"]]))),i&&(r||s)&&(l.appendChild(k("feOffset",[["dx",e.xshad*a],["dy",e.yshad*a],["in",r?"dil":"SourceGraphic"],["result","off"]])),l.appendChild(k("feGaussianBlur",[["stdDeviation",o],["in","off"],["result","off_b"]])),s||(l.appendChild(k("feOffset",[["dx",e.xshad*a],["dy",e.yshad*a],["in","SourceGraphic"],["result","sg_off"]])),l.appendChild(k("feComposite",[["operator","out"],["in","off_b"],["in2","sg_off"],["result","off_b_o"]]))),l.appendChild(k("feFlood",[["flood-color",U(e.a4+e.c4)],["result","c4"]])),l.appendChild(k("feComposite",[["operator","in"],["in","c4"],["in2",s?"off_b":"off_b_o"],["result","shadow"]])));var c=k("feMerge",[]);return i&&(r||s)&&c.appendChild(k("feMergeNode",[["in","shadow"]])),r&&c.appendChild(k("feMergeNode",[["in","border"]])),c.appendChild(k("feMergeNode",[["in","main"]])),l.appendChild(c),l}function de(e,n){var a=[],r=U(e.a3+e.c3),i=e.xbord*n,s=e.ybord*n,o=U(e.a4+e.c4),l=e.xshad*n,c=e.yshad*n,f=e.blur||e.be||0;if(!(i+s+l+c))return"none";if(i||s)for(var d=-1;d<=1;d++)for(var h=-1;h<=1;h++){for(var v=1;v<i;v++)for(var u=1;u<s;u++)(d||h)&&a.push(r+" "+d*v+"px "+h*u+"px "+f+"px");a.push(r+" "+d*i+"px "+h*s+"px "+f+"px")}if(l||c){var g=l>0?1:-1,w=c>0?1:-1;l=Math.abs(l),c=Math.abs(c);for(var _=Math.max(i,l-i);_<l+i;_++)for(var p=Math.max(s,c-s);p<c+s;p++)a.push(o+" "+_*g+"px "+p*w+"px "+f+"px");a.push(o+" "+(l+i)*g+"px "+(c+s)*w+"px "+f+"px")}return a.join()}function we(e){return["perspective(314px)","rotateY("+(e.fry||0)+"deg)","rotateX("+(e.frx||0)+"deg)","rotateZ("+(-e.frz||0)+"deg)","scale("+(e.p?1:(e.fscx||100)/100)+","+(e.p?1:(e.fscy||100)/100)+")","skew("+(e.fax||0)+"rad,"+(e.fay||0)+"rad)"].join(" ")}function Nt(e){var n=e.alignment,a=e.width,r=e.height,i=e.x,s=e.y,o=e.$div,l=e.org;l||(l={x:0,y:0},n%3===1&&(l.x=i),n%3===2&&(l.x=i+a/2),n%3===0&&(l.x=i+a),n<=3&&(l.y=s+r),n>=4&&n<=6&&(l.y=s+r/2),n>=7&&(l.y=s));for(var c=o.childNodes.length-1;c>=0;c--){var f=o.childNodes[c];if(f.dataset.hasRotate==="true"){var d=l.x-i-f.offsetLeft,h=l.y-s-f.offsetTop;f.style.cssText+=X.transform+"transform-origin:"+d+"px "+h+"px;"}}}function Re(e,n){return"@"+X.animation+"keyframes "+e+" {"+n+`}
`}var ie=function(){this.obj={}};ie.prototype.set=function(n,a,r){this.obj[n]||(this.obj[n]={}),this.obj[n][a]=r},ie.prototype.setT=function(n){var a=n.t1,r=n.t2,i=n.duration,s=n.prop,o=n.from,l=n.to;this.set("0.000%",s,o),a<i&&this.set((a/i*100).toFixed(3)+"%",s,o),r<i&&this.set((r/i*100).toFixed(3)+"%",s,l),this.set("100.000%",s,l)},ie.prototype.toString=function(){var n=this;return Object.keys(this.obj).map(function(a){return a+"{"+Object.keys(n.obj[a]).map(function(r){return""+(X[r]||"")+r+":"+n.obj[a][r]+";"}).join("")+"}"}).join("")};function Vt(e){return e.reduceRight(function(n,a){var r=!1;return n.map(function(i){return r=a.t1===i.t1&&a.t2===i.t2&&a.accel===i.accel,B({},i,r?{tag:B({},i.tag,a.tag)}:{})}).concat(r?[]:a)},[])}function Ft(){var e=this,n="";return this.dialogues.forEach(function(a){var r=a.start,i=a.end,s=a.effect,o=a.move,l=a.fade,c=a.slices,f=(i-r)*1e3,d=new ie;if(s&&!o){var h=s.name,v=s.delay,u=s.lefttoright,g=s.y1,w=s.y2||e._.resampledRes.height;if(h==="banner"){var _=e.scale*(f/v)*(u?1:-1);d.set("0.000%","transform","translateX(0)"),d.set("100.000%","transform","translateX("+_+"px)")}if(/^scroll/.test(h)){var p=/up/.test(h)?-1:1,b="translateY("+e.scale*g*p+"px)",N="translateY("+e.scale*w*p+"px)",m=(w-g)/(f/v)*100;d.set("0.000%","transform",b),m<100&&d.set(m.toFixed(3)+"%","transform",N),d.set("100.000%","transform",N)}}if(o){var x=o.x1,y=o.y1,S=o.x2,E=o.y2,C=o.t1,A=o.t2||f,T=a.pos||{x:0,y:0},Z=[{x,y},{x:S,y:E}].map(function(I){var L=I.x,O=I.y;return"translate("+e.scale*(L-T.x)+"px, "+e.scale*(O-T.y)+"px)"});d.setT({t1:C,t2:A,duration:f,prop:"transform",from:Z[0],to:Z[1]})}if(l)if(l.type==="fad"){var W=l.t1,J=l.t2;d.set("0.000%","opacity",0),W<f?(d.set((W/f*100).toFixed(3)+"%","opacity",1),W+J<f&&d.set(((f-J)/f*100).toFixed(3)+"%","opacity",1),d.set("100.000%","opacity",0)):d.set("100.000%","opacity",f/W)}else{var se=l.a1,le=l.a2,Q=l.a3,Y=l.t1,ee=l.t2,G=l.t3,Ge=l.t4,pe=[Y,ee,G,Ge].map(function(I){return(I/f*100).toFixed(3)+"%"}),te=[se,le,Q].map(function(I){return 1-I/255});d.set("0.000%","opacity",te[0]),Y<f&&d.set(pe[0],"opacity",te[0]),ee<f&&d.set(pe[1],"opacity",te[1]),G<f&&d.set(pe[2],"opacity",te[1]),Ge<f&&d.set(pe[3],"opacity",te[2]),d.set("100.000%","opacity",te[2])}var Xe=d.toString();Xe&&(B(a,{animationName:"ASS-"+re()}),n+=Re(a.animationName,Xe)),c.forEach(function(I){I.fragments.forEach(function(L){if(!(!L.tag.t||!L.tag.t.length)){var O=new ie,D=B({},I.tag,L.tag);Vt(L.tag.t).forEach(function(Ne){var ne=Ne.t1,ae=Ne.t2,V=Ne.tag;if(V.fs){var Jn=e.scale*ye(D.fn,D.fs)+"px",Qn=e.scale*ye(V.fn,D.fs)+"px";O.setT({t1:ne,t2:ae,duration:f,prop:"font-size",from:Jn,to:Qn})}if(V.fsp){var ea=e.scale*D.fsp+"px",ta=e.scale*V.fsp+"px";O.setT({t1:ne,t2:ae,duration:f,prop:"letter-spacing",from:ea,to:ta})}var Ke=V.a1!==void 0&&V.a1===V.a2&&V.a2===V.a3&&V.a3===V.a4;if(V.c1||V.a1&&!Ke){var na=U(D.a1+D.c1),aa=U((V.a1||D.a1)+(V.c1||D.c1));O.setT({t1:ne,t2:ae,duration:f,prop:"color",from:na,to:aa})}if(Ke){var ra=1-parseInt(D.a1,16)/255,oa=1-parseInt(V.a1,16)/255;O.setT({t1:ne,t2:ae,duration:f,prop:"opacity",from:ra,to:oa})}var ia=Et.some(function(z){return V[z]!==void 0&&V[z]!==(L.tag[z]||I.tag[z])});if(ia){var Ze=/Yes/i.test(e.info.ScaledBorderAndShadow)?e.scale:1,sa=de(D,Ze),la=de(B({},D,V),Ze);O.setT({t1:ne,t2:ae,duration:f,prop:"text-shadow",from:sa,to:la})}var ca=Le.some(function(z){return V[z]!==void 0&&V[z]!==(L.tag[z]||I.tag[z])});if(ca){var Je=B({},D,V);L.drawing&&(B(Je,{p:0,fscx:(V.fscx||D.fscx)/D.fscx*100,fscy:(V.fscy||D.fscy)/D.fscy*100}),B(D,{fscx:100,fscy:100}));var da=we(D),fa=we(Je);O.setT({t1:ne,t2:ae,duration:f,prop:"transform",from:da,to:fa})}});var Zn=O.toString();B(L,{animationName:"ASS-"+re()}),n+=Re(L.animationName,Zn)}})})}),n}function Me(e,n,a){var r=X.animation;return r+"animation-name:"+e+";"+r+"animation-duration:"+n+"s;"+r+"animation-delay:"+a+"s;"+r+"animation-timing-function:linear;"+r+"animation-iteration-count:1;"+r+"animation-fill-mode:forwards;"}function Bt(e,n){var a=B({},n,e.tag),r=e.drawing,i=r.minX,s=r.minY,o=r.width,l=r.height,c=this.scale/(1<<a.p-1),f=(a.fscx?a.fscx/100:1)*c,d=(a.fscy?a.fscy/100:1)*c,h=a.blur||a.be||0,v=a.xbord+(a.xshad<0?-a.xshad:0)+h,u=a.ybord+(a.yshad<0?-a.yshad:0)+h,g=o*f+2*a.xbord+Math.abs(a.xshad)+2*h,w=l*d+2*a.ybord+Math.abs(a.yshad)+2*h,_=k("svg",[["width",g],["height",w],["viewBox",-v+" "+-u+" "+g+" "+w]]),p=/Yes/i.test(this.info.ScaledBorderAndShadow)?this.scale:1,b="ASS-"+re(),N=k("defs");N.appendChild(kt(a,b,p)),_.appendChild(N);var m="ASS-"+re(),x=k("symbol",[["id",m],["viewBox",i+" "+s+" "+o+" "+l]]);return x.appendChild(k("path",[["d",e.drawing.d]])),_.appendChild(x),_.appendChild(k("use",[["width",o*f],["height",l*d],["xlink:href","#"+m],["filter","url(#"+b+")"]])),_.style.cssText="position:absolute;left:"+(i*f-v)+"px;top:"+(s*d-u)+"px;",{$svg:_,cssText:"position:relative;width:"+o*f+"px;height:"+l*d+"px;"}}function Dt(e,n){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\s/g,"&nbsp;").replace(/\\h/g,"&nbsp;").replace(/\\N/g,"<br>").replace(/\\n/g,n===2?"<br>":"&nbsp;")}function At(e){var n=this,a=document.createElement("div");a.className="ASS-dialogue";var r=document.createDocumentFragment(),i=e.slices,s=e.start,o=e.end;return i.forEach(function(l){var c=l.borderStyle;l.fragments.forEach(function(f){var d=f.text,h=f.drawing,v=f.animationName,u=B({},l.tag,f.tag),g="display:inline-block;",w=n.video.currentTime;if(!h){g+='font-family:"'+u.fn+'",Arial;',g+="font-size:"+n.scale*ye(u.fn,u.fs)+"px;",g+="color:"+U(u.a1+u.c1)+";";var _=/Yes/i.test(n.info.ScaledBorderAndShadow)?n.scale:1;c===1&&(g+="text-shadow:"+de(u,_)+";"),c===3&&(g+="background-color:"+U(u.a3+u.c3)+";box-shadow:"+de(u,_)+";"),g+=u.b?"font-weight:"+(u.b===1?"bold":u.b)+";":"",g+=u.i?"font-style:italic;":"",g+=u.u||u.s?"text-decoration:"+(u.u?"underline":"")+" "+(u.s?"line-through":"")+";":"",g+=u.fsp?"letter-spacing:"+u.fsp+"px;":"",(u.q===1||u.q===0||u.q===3)&&(g+="word-break:break-all;white-space:normal;"),u.q===2&&(g+="word-break:normal;white-space:nowrap;")}var p=Le.some(function(m){return/^fsc[xy]$/.test(m)?u[m]!==100:!!u[m]});if(p&&(g+=X.transform+"transform:"+we(u)+";",h||(g+="transform-style:preserve-3d;word-break:normal;white-space:nowrap;")),v&&(g+=Me(v,o-s,Math.min(0,s-w))),h&&u.pbo){var b=n.scale*-u.pbo*(u.fscy||100)/100;g+="vertical-align:"+b+"px;"}var N=/"fr[xyz]":[^0]/.test(JSON.stringify(u));Dt(d,u.q).split("<br>").forEach(function(m,x){var y=document.createElement("span");if(y.dataset.hasRotate=N,h){var S=Bt.call(n,f,l.tag);y.style.cssText=S.cssText,y.appendChild(S.$svg)}else{if(x&&r.appendChild(document.createElement("br")),!m)return;y.innerHTML=m}y.style.cssText+=g,r.appendChild(y)})})}),a.appendChild(r),a}function Tt(e){var n=e.layer,a=e.margin,r=e.width,i=e.height,s=e.alignment,o=e.end,l=this.width-(this.scale*(a.left+a.right)|0),c=this.height,f=this.scale*a.vertical|0,d=this.video.currentTime*100;this._.space[n]=this._.space[n]||{left:{width:new Uint16Array(c+1),end:new Uint16Array(c+1)},center:{width:new Uint16Array(c+1),end:new Uint16Array(c+1)},right:{width:new Uint16Array(c+1),end:new Uint16Array(c+1)}};var h=this._.space[n],v=["right","left","center"][s%3],u=function(x){var y=h.left.width[x],S=h.center.width[x],E=h.right.width[x],C=h.left.end[x],A=h.center.end[x],T=h.right.end[x];return v==="left"&&(C>d&&y||A>d&&S&&2*r+S>l||T>d&&E&&r+E>l)||v==="center"&&(C>d&&y&&2*y+r>l||A>d&&S||T>d&&E&&2*E+r>l)||v==="right"&&(C>d&&y&&y+r>l||A>d&&S&&2*r+S>l||T>d&&E)},g=0,w=0,_=function(x){return g=u(x)?0:g+1,g>=i?(w=x,!0):!1};if(s<=3)for(var p=c-f-1;p>f&&!_(p);p--);else if(s>=7)for(var b=f+1;b<c-f&&!_(b);b++);else for(var N=c-i>>1;N<c-f&&!_(N);N++);s>3&&(w-=i-1);for(var m=w;m<w+i;m++)h[v].width[m]=r,h[v].end[m]=o*100;return w}function $t(e){var n=e.effect,a=e.move,r=e.alignment,i=e.width,s=e.height,o=e.margin,l=e.slices,c=0,f=0;if(n)n.name==="banner"&&(r<=3&&(f=this.height-s-o.vertical),r>=4&&r<=6&&(f=(this.height-s)/2),r>=7&&(f=o.vertical),c=n.lefttoright?-i:this.width);else if(e.pos||a){var d=e.pos||{x:0,y:0};r%3===1&&(c=this.scale*d.x),r%3===2&&(c=this.scale*d.x-i/2),r%3===0&&(c=this.scale*d.x-i),r<=3&&(f=this.scale*d.y-s),r>=4&&r<=6&&(f=this.scale*d.y-s/2),r>=7&&(f=this.scale*d.y)}else{r%3===1&&(c=0),r%3===2&&(c=(this.width-i)/2),r%3===0&&(c=this.width-i-this.scale*o.right);var h=l.some(function(v){return v.fragments.some(function(u){var g=u.animationName;return g})});h?(r<=3&&(f=this.height-s-o.vertical),r>=4&&r<=6&&(f=(this.height-s)/2),r>=7&&(f=o.vertical)):f=Tt.call(this,e)}return{x:c,y:f}}function It(e){var n=e.layer,a=e.start,r=e.end,i=e.alignment,s=e.effect,o=e.pos,l=e.margin,c=e.animationName,f=e.width,d=e.height,h=e.x,v=e.y,u=this.video.currentTime,g="";if(n&&(g+="z-index:"+n+";"),c&&(g+=Me(c,r-a,Math.min(0,a-u))),g+="text-align:"+["right","left","center"][i%3]+";",!s){var w=this.width-this.scale*(l.left+l.right);g+="max-width:"+w+"px;",o||(i%3===1&&(g+="margin-left:"+this.scale*l.left+"px;"),i%3===0&&(g+="margin-right:"+this.scale*l.right+"px;"),f>this.width-this.scale*(l.left+l.right)&&(g+="margin-left:"+this.scale*l.left+"px;",g+="margin-right:"+this.scale*l.right+"px;"))}return g+="width:"+f+"px;height:"+d+"px;left:"+h+"px;top:"+v+"px;",g}function Lt(e){var n=At.call(this,e);B(e,{$div:n}),this._.$stage.appendChild(n);var a=n.getBoundingClientRect(),r=a.width,i=a.height;return B(e,{width:r,height:i}),B(e,$t.call(this,e)),n.style.cssText=It.call(this,e),Nt(e),St.call(this,e),e}function Pe(){for(var e=this.video.currentTime,n=this._.stagings.length-1;n>=0;n--){var a=this._.stagings[n],r=a.end;if(a.effect&&/scroll/.test(a.effect.name)){var i=a.effect,s=i.y1,o=i.y2,l=i.delay,c=((o||this._.resampledRes.height)-s)/(1e3/l);r=Math.min(r,a.start+c)}r<e&&(this._.$stage.removeChild(a.$div),a.$clipPath&&this._.$defs.removeChild(a.$clipPath),this._.stagings.splice(n,1))}for(var f=this.dialogues;this._.index<f.length&&e>=f[this._.index].start;){if(e<f[this._.index].end){var d=Lt.call(this,f[this._.index]);this._.stagings.push(d)}++this._.index}}function Ue(){var e=this,n=function(){Pe.call(e),e._.requestId=Te(n)};return $e(this._.requestId),this._.requestId=Te(n),this._.$stage.classList.remove("ASS-animation-paused"),this}function Oe(){return $e(this._.requestId),this._.requestId=0,this._.$stage.classList.add("ASS-animation-paused"),this}function ze(){for(;this._.$stage.lastChild;)this._.$stage.removeChild(this._.$stage.lastChild);for(;this._.$defs.lastChild;)this._.$defs.removeChild(this._.$defs.lastChild);this._.stagings=[],this._.space=[]}function xe(){var e=this.video.currentTime,n=this.dialogues;ze.call(this),this._.index=function(){for(var a=0,r=n.length-1;a+1<r&&e>n[r+a>>1].end;)a=r+a>>1;if(!a)return 0;for(var i=a;i<r;i++)if(n[i].end>e&&e>=n[i].start||i&&n[i-1].end<e&&e<n[i].start)return i;return r}(),Pe.call(this)}function Rt(){var e=this._.listener;e.play=Ue.bind(this),e.pause=Oe.bind(this),e.seeking=xe.bind(this),this.video.addEventListener("play",e.play),this.video.addEventListener("pause",e.pause),this.video.addEventListener("seeking",e.seeking)}function Mt(){var e=this._.listener;this.video.removeEventListener("play",e.play),this.video.removeEventListener("pause",e.pause),this.video.removeEventListener("seeking",e.seeking),e.play=null,e.pause=null,e.seeking=null}function je(){var e=this.video.clientWidth,n=this.video.clientHeight,a=this.video.videoWidth||e,r=this.video.videoHeight||n,i=this._.scriptRes.width,s=this._.scriptRes.height,o=i,l=s,c=Math.min(e/a,n/r);this.resampling==="video_width"&&(l=i/a*r),this.resampling==="video_height"&&(o=s/r*a),this.scale=Math.min(e/o,n/l),this.resampling==="script_width"&&(this.scale=c*(a/o)),this.resampling==="script_height"&&(this.scale=c*(r/l)),this.width=this.scale*o,this.height=this.scale*l,this._.resampledRes={width:o,height:l},this.container.style.cssText="width:"+e+"px;height:"+n+"px;";var f="width:"+this.width+"px;height:"+this.height+"px;top:"+(n-this.height)/2+"px;left:"+(e-this.width)/2+"px;";return this._.$stage.style.cssText=f,this._.$svg.style.cssText=f,this._.$svg.setAttributeNS(null,"viewBox","0 0 "+i+" "+s),this._.$animation.innerHTML=Ft.call(this),xe.call(this),this}var Pt=".ASS-container,.ASS-stage{position:relative;overflow:hidden}.ASS-container video{position:absolute;top:0;left:0}.ASS-stage{pointer-events:none;position:absolute}.ASS-dialogue{font-size:0;position:absolute}.ASS-fix-font-size{position:absolute;visibility:hidden}.ASS-fix-objectBoundingBox{width:100%;height:100%;position:absolute;top:0;left:0}.ASS-animation-paused *{-webkit-animation-play-state:paused!important;animation-play-state:paused!important}";function Ut(e,n,a){if(a===void 0&&(a={}),this.scale=1,this._={index:0,stagings:[],space:[],listener:{},$svg:k("svg"),$defs:k("defs"),$stage:document.createElement("div"),$animation:document.createElement("style")},this._.$svg.appendChild(this._.$defs),this._.$stage.className="ASS-stage ASS-animation-paused",this._.resampling=a.resampling||"video_height",this.container=a.container||document.createElement("div"),this.container.classList.add("ASS-container"),this.container.appendChild(oe),this.container.appendChild(this._.$svg),this._.hasInitContainer=!!a.container,this.video=n,Rt.call(this),!this._.hasInitContainer){var r=!n.paused;n.parentNode.insertBefore(this.container,n),this.container.appendChild(n),r&&n.paused&&n.play()}this.container.appendChild(this._.$stage);var i=bt(e),s=i.info,o=i.width,l=i.height,c=i.dialogues;this.info=s,this._.scriptRes={width:o||n.videoWidth,height:l||n.videoHeight},this.dialogues=c;var f=Ie(this.container),d=f.querySelector("#ASS-global-style");return d||(d=document.createElement("style"),d.type="text/css",d.id="ASS-global-style",d.appendChild(document.createTextNode(Pt)),f.appendChild(d)),this._.$animation.type="text/css",this._.$animation.className="ASS-animation",f.appendChild(this._.$animation),je.call(this),this.video.paused||(xe.call(this),Ue.call(this)),this}function Ot(){return this._.$stage.style.visibility="visible",this}function zt(){return this._.$stage.style.visibility="hidden",this}function jt(){Oe.call(this),ze.call(this),Mt.call(this,this._.listener);var e=Ie(this.container);if(!this._.hasInitContainer){var n=!this.video.paused;this.container.parentNode.insertBefore(this.video,this.container),this.container.parentNode.removeChild(this.container),n&&this.video.paused&&this.video.play()}e.removeChild(this._.$animation);for(var a in this)Object.prototype.hasOwnProperty.call(this,a)&&(this[a]=null);return this}var qe=/^(video|script)_(width|height)$/;function qt(){return qe.test(this._.resampling)?this._.resampling:"video_height"}function Ht(e){return e===this._.resampling?e:(qe.test(e)&&(this._.resampling=e,this.resize()),this._.resampling)}var K=function(n,a,r){return typeof n!="string"?this:Ut.call(this,n,a,r)},_e={resampling:{configurable:!0}};K.prototype.resize=function(){return je.call(this)},K.prototype.show=function(){return Ot.call(this)},K.prototype.hide=function(){return zt.call(this)},K.prototype.destroy=function(){return jt.call(this)},_e.resampling.get=function(){return qt.call(this)},_e.resampling.set=function(e){return Ht.call(this,e)},Object.defineProperties(K.prototype,_e);var va="",Wt=(e,n)=>{const a=e.__vccOpts||e;for(const[r,i]of n)a[r]=i;return a};const Yt=[(e=>(t.pushScopeId("data-v-887c1104"),e=e(),t.popScopeId(),e))(()=>t.createElementVNode("h1",null,"\u64AD\u653E\u52A0\u8F7D\u5931\u8D25\u4E86QAQ",-1))],Gt=t.defineComponent({name:"VideoEnhancePlayer"}),Xt=t.defineComponent(M(R({},Gt),{props:{url:{type:String,default:void 0},videoInfo:{type:Object,default:void 0},subtitleList:{type:Array,default:()=>[]},file:{type:Object,default:void 0}},setup(e){const n=e,a=window.SfcUtils,r=t.ref(),i=t.ref();let s,o,l;const c=async m=>{const x=s.video.currentTime;s.destroy(),s=new window.DPlayer(m),u(s),s.play(),s.seek(x)},f=F.MethodInterceptor.createThrottleProxy({autoResizeAss(){o&&o.resize()}},{afterExecute:!0,delay:500});function d(){l&&(clearInterval(l),l=null)}function h(m){o&&(o.destroy(),o=null);const x=document.createElement("div");x.classList.add("subtitle");const y=i.value.getAttributeNames().find(C=>C.startsWith("data-v-"));x.setAttribute(y,""),i.value.appendChild(x),o=new K(m,s.video,{container:x,resampling:"video_width"}),d();const S="21px",E=i.value.querySelector(".ASS-stage");if(E&&E.getAttribute("has-hock-append-child")!="1"){E.setAttribute("has-hock-append-child","1");const C=E.appendChild.bind(E);E.appendChild=A=>{if(A instanceof HTMLElement){const T=A.querySelector("span");T&&(T.style.fontSize=S)}return C(A)}}l=setInterval(()=>{i.value.querySelectorAll(".ASS-stage span").forEach(C=>C.style.fontSize=S)},500)}const v=()=>{if(!n.url)return;const m={container:i.value,video:{url:n.url}},x=t.ref();n.videoInfo&&(n.subtitleList.length&&(window.SfcUtils.snackbar(`\u68C0\u6D4B\u5230${n.subtitleList.length}\u4E2A\u5B57\u5E55`),m.contextmenu=[{text:"\u9009\u62E9\u5B57\u5E55",click(){window.SfcUtils.openComponentDialog(tt,{props:t.reactive({subtitleList:n.subtitleList,"onUpdate:modelValue"(y){x.value=y},modelValue:x}),title:"\u9009\u62E9\u5B57\u5E55",contentMaxHeight:"360px",async onConfirm(){if(x.value.type=="webvtt")m.subtitle={url:x.value.url,fontSize:"21px"},m.contextmenu[0].text="\u5B57\u5E55\uFF1A"+x.value.title,c(m),d();else{m.subtitle=void 0,m.contextmenu[0].text="\u5B57\u5E55\uFF1A"+x.value.title,c(m);const y=(await a.request({url:x.value.url})).data;h(y)}return!0}})}}]),n.videoInfo.chapters.length&&(m.highlight=n.videoInfo.chapters.map(y=>({text:y.title,time:Number(y.startTime)})))),s=new window.DPlayer(m),u(s),s.play(),s.video.addEventListener("loadeddata",async()=>{const y=await N();y&&(a.snackbar(`\u5DF2\u81EA\u52A8\u5B9A\u4F4D\u5230${_(y)}`),s.seek(y))})};function u(m){m.video.addEventListener("timeupdate",F.MethodInterceptor.createThrottleProxy(F.MethodInterceptor.wrapFun(()=>b(m.video.currentTime)),{delay:5e3}).invoke),m.video.addEventListener("seeked",()=>b(m.video.currentTime))}function g(m){return m<10?`0${m}`:m}let w=null;function _(m){const x=Math.floor(m/3600),y=Math.floor(m/60),S=Math.floor(m%60);return x?`${g(x)}:${g(y)}:${g(S)}`:`${g(y)}:${g(S)}`}function p(){var m,x;return((m=n.file)==null?void 0:m.md5)||((x=n.file)==null?void 0:x.id)||n.url}function b(m){const x=F.context.session.value.user.id,y=p();if(x){if(w)return;w=a.request(P.recordWatchProgress(x,y,m)).then(()=>w=null)}localStorage.setItem(`watchRecord_${x}`,String(m))}async function N(){const m=F.context.session.value.user.id,x=p();if(m)return(await a.request(P.getWatchProgress(m,x))).data.data;const y=localStorage.getItem(`watchRecord_${m}`);if(y)return Number(y)}return t.onMounted(async()=>{await t.nextTick(),v(),window.addEventListener("resize",f.autoResizeAss)}),t.onUnmounted(()=>{window.removeEventListener("resize",f.autoResizeAss),d()}),t.watch(()=>n.url,v),(m,x)=>(t.openBlock(),t.createElementBlock("div",{ref_key:"rootRef",ref:r,class:"player-root"},[t.createElementVNode("div",{ref_key:"playerRef",ref:i,class:"player"},Yt,512)],512))}}));var Kt=Wt(Xt,[["__scopeId","data-v-887c1104"]]);const Zt=t.defineComponent({name:"ConfigureInfo"}),Jt=t.defineComponent(M(R({},Zt),{props:{modelValue:{type:String,default:""}},setup(e){const n=e,a=()=>{window.SfcUtils.alert(n.modelValue,"\u7F16\u8BD1\u53C2\u6570")};return(r,i)=>(t.openBlock(),t.createElementBlock("a",{class:"link",onClick:a},"\u67E5\u770B\u7F16\u8BD1\u53C2\u6570"))}})),Qt=t.createElementVNode("thead",null,[t.createElementVNode("tr",null,[t.createElementVNode("th",{style:{width:"90px"}}," \u7F16\u7801\u5668 "),t.createElementVNode("th",null,"\u63CF\u8FF0")])],-1),en={class:"break-text"},tn=t.defineComponent({name:"EncoderInfoList"}),He=t.defineComponent(M(R({},tn),{props:{modelValue:{type:Array,default:()=>[]}},setup(e){return(n,a)=>{const r=t.resolveComponent("VTable"),i=t.resolveComponent("EmptyTip");return e.modelValue&&e.modelValue.length?(t.openBlock(),t.createBlock(r,{key:0},{default:t.withCtx(()=>[Qt,t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.modelValue,s=>(t.openBlock(),t.createElementBlock("tr",{key:s.name},[t.createElementVNode("td",en,t.toDisplayString(s.name),1),t.createElementVNode("td",null,t.toDisplayString(s.describe),1)]))),128))])]),_:1})):(t.openBlock(),t.createBlock(i,{key:1}))}}})),nn=t.defineComponent({name:"EncoderInfo"}),an=t.defineComponent(M(R({},nn),{props:{modelValue:{type:Array,default:()=>[]}},setup(e){const n=e,a=()=>{window.SfcUtils.openComponentDialog(He,{props:{modelValue:n.modelValue},title:"\u7F16\u7801\u5668\u8BE6\u60C5"})};return(r,i)=>(t.openBlock(),t.createElementBlock("a",{class:"link",onClick:a},"\u67E5\u770B\u8BE6\u60C5("+t.toDisplayString(e.modelValue.length)+"\u4E2A)",1))}})),rn=t.createTextVNode(" \u68C0\u67E5 "),on=t.defineComponent({name:"VideoEnhanceCheck"}),We=t.defineComponent(M(R({},on),{setup(e){const n=window.SfcUtils,a=async()=>{const r=window.SfcUtils.loadingDialog({msg:"\u68C0\u67E5\u4E2D..."});try{await n.request(P.check()),r.close(),await n.sleep(250),await n.alert("\u914D\u7F6E\u6B63\u786E")}catch(i){r.close(),await n.sleep(250),n.alert(""+i,"\u914D\u7F6E\u9519\u8BEF")}};return(r,i)=>{const s=t.resolveComponent("VBtn");return t.openBlock(),t.createElementBlock("div",null,[t.createVNode(s,{onClick:a},{default:t.withCtx(()=>[rn]),_:1})])}}}));window.bootContext.addProcessor({taskName:"\u6CE8\u518C\u7EC4\u4EF6",execute(e,n){e.component("ConfigureInfo",Jt),e.component("EncoderInfo",an),e.component("EncoderInfoList",He),e.component(We.name,We)}});function be(e){return e<10?"0"+e:""+e}var fe;(e=>{function n(r){return r<1e3?r+"bps":r<1e6?(Number(r)/1e3).toFixed(2)+"Kbps":r<1e9?(Number(r)/1e6).toFixed(2)+"Mbps":r}e.formatBitRate=n;function a(r){const i=Number(r),s=be(Math.floor(i/3600)),o=be(Math.floor(i/60%60)),l=be(Math.floor(i%60));return`${s}:${o}:${l}`}e.formatDuration=a})(fe||(fe={}));const sn=t.createElementVNode("div",{class:"text-title"}," \u57FA\u672C\u4FE1\u606F ",-1),ln=t.createElementVNode("td",{style:{"min-width":"160px"}}," \u5C01\u88C5\u683C\u5F0F ",-1),cn=t.createElementVNode("td",null,"\u5C01\u88C5\u683C\u5F0F\u5168\u79F0",-1),dn=t.createElementVNode("td",null,"\u7801\u7387",-1),fn=t.createElementVNode("td",null,"\u6301\u7EED\u65F6\u957F",-1),un={key:0},hn=t.createElementVNode("td",null,"\u5176\u4ED6\u6807\u8BB0",-1),pn=t.createElementVNode("thead",null,[t.createElementVNode("tr",null,[t.createElementVNode("th",null,"\u540D\u79F0"),t.createElementVNode("th",null,"\u503C")])],-1),mn=t.createElementVNode("div",{class:"text-title"}," \u89C6\u9891\u6D41 ",-1),gn=t.createElementVNode("thead",null,[t.createElementVNode("tr",null,[t.createElementVNode("th",null,"\u7F16\u7801"),t.createElementVNode("th",null,"\u5206\u8FA8\u7387"),t.createElementVNode("th",null,"\u5E27\u7387"),t.createElementVNode("th",null,"\u8BED\u8A00")])],-1),vn=t.createElementVNode("div",{class:"text-title"}," \u97F3\u9891\u6D41 ",-1),yn=t.createElementVNode("thead",null,[t.createElementVNode("tr",null,[t.createElementVNode("th",null,"\u7F16\u7801"),t.createElementVNode("th",null,"\u91C7\u6837"),t.createElementVNode("th",null,"\u7801\u7387"),t.createElementVNode("th",null,"\u58F0\u9053"),t.createElementVNode("th",null,"\u8BED\u8A00")])],-1),wn=t.defineComponent({name:"VideoInfo"}),xn=t.defineComponent(M(R({},wn),{props:{videoInfo:{type:Object,default:()=>({})},file:{type:Object,default:void 0}},setup(e){const n=e,a=t.ref(!1),r=t.computed(()=>n.videoInfo.streams.filter(s=>s.codecType=="video")),i=t.computed(()=>n.videoInfo.streams.filter(s=>s.codecType=="audio"));return(s,o)=>{const l=t.resolveComponent("VTable");return t.openBlock(),t.createElementBlock("div",null,[sn,t.createVNode(l,null,{default:t.withCtx(()=>[t.createElementVNode("tbody",null,[t.createElementVNode("tr",null,[ln,t.createElementVNode("td",null,t.toDisplayString(e.videoInfo.format.formatName),1)]),t.createElementVNode("tr",null,[cn,t.createElementVNode("td",null,t.toDisplayString(e.videoInfo.format.formatLongName),1)]),t.createElementVNode("tr",null,[dn,t.createElementVNode("td",null,t.toDisplayString(t.unref(fe).formatBitRate(e.videoInfo.format.bitRate))+" ("+t.toDisplayString(e.videoInfo.format.bitRate)+")",1)]),t.createElementVNode("tr",null,[fn,t.createElementVNode("td",null,t.toDisplayString(t.unref(fe).formatDuration(e.videoInfo.format.duration)),1)]),e.videoInfo.format.tags?(t.openBlock(),t.createElementBlock("tr",un,[hn,t.createElementVNode("td",null,[a.value?(t.openBlock(),t.createBlock(l,{key:0},{default:t.withCtx(()=>[pn,t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(Object.keys(e.videoInfo.format.tags),c=>(t.openBlock(),t.createElementBlock("tr",{key:c},[t.createElementVNode("td",null,t.toDisplayString(c),1),t.createElementVNode("td",null,t.toDisplayString(e.videoInfo.format.tags[c]),1)]))),128))])]),_:1})):t.createCommentVNode("",!0),t.createElementVNode("a",{class:"link",onClick:o[0]||(o[0]=c=>a.value=!a.value)},t.toDisplayString(a.value?"\u6536\u8D77":"\u5C55\u5F00"),1)])])):t.createCommentVNode("",!0)])]),_:1}),mn,t.createVNode(l,null,{default:t.withCtx(()=>[gn,t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(r),c=>(t.openBlock(),t.createElementBlock("tr",{key:c.index},[t.createElementVNode("td",null,t.toDisplayString(c.codecName),1),t.createElementVNode("td",null,t.toDisplayString(c.width)+"x"+t.toDisplayString(c.height),1),t.createElementVNode("td",null,t.toDisplayString((c.avgFrameRate||0).toFixed(3)),1),t.createElementVNode("td",null,t.toDisplayString(c.language||"-"),1)]))),128))])]),_:1}),vn,t.createVNode(l,null,{default:t.withCtx(()=>[yn,t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(i),c=>(t.openBlock(),t.createElementBlock("tr",{key:c.index},[t.createElementVNode("td",null,t.toDisplayString(c.codecName),1),t.createElementVNode("td",null,t.toDisplayString(c.sampleRate/1e3)+"kHz",1),t.createElementVNode("td",null,t.toDisplayString(c.bitRate/1e3)+"K",1),t.createElementVNode("td",null,t.toDisplayString(c.channels),1),t.createElementVNode("td",null,t.toDisplayString(c.language||"-"),1)]))),128))])]),_:1})])}}})),_n=t.createElementVNode("div",{class:"text-h6"}," \u89C6\u9891 ",-1),bn=t.createElementVNode("thead",null,[t.createElementVNode("tr",null,[t.createElementVNode("th",{style:{width:"64px"}}," \u9009\u62E9 "),t.createElementVNode("th",null,"\u539F\u7F16\u7801"),t.createElementVNode("th",null,"\u8BED\u8A00"),t.createElementVNode("th",null,"\u7F16\u7801\u5668")])],-1),En=t.createElementVNode("div",{class:"text-h6"}," \u97F3\u9891 ",-1),Cn=t.createElementVNode("thead",null,[t.createElementVNode("tr",null,[t.createElementVNode("th",{style:{width:"64px"}}," \u9009\u62E9 "),t.createElementVNode("th",null,"\u539F\u7F16\u7801"),t.createElementVNode("th",null,"\u8BED\u8A00"),t.createElementVNode("th",null,"\u7F16\u7801\u5668")])],-1),Sn=t.defineComponent({name:"VideoConvertForm"}),kn=t.defineComponent(M(R({},Sn),{props:{videoInfo:{type:Object,default:()=>({})}},emits:["submit"],setup(e,{expose:n,emit:a}){const r=e,i=t.ref(),s=t.ref(),o={title:"\u590D\u5236",value:"copy"},l=window.FormUtils.defineForm({actions:{async submit(){if(!r.videoInfo.streams.find(b=>(b.codecType=="audio"||b.codecType=="video")&&c.mapStreams[b.index]))throw new Error("\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u97F3\u9891\u6216\u89C6\u9891\u6D41");r.videoInfo.streams.find(b=>b.codecType=="video"&&c.mapStreams[b.index])||await window.SfcUtils.confirm("\u6CA1\u6709\u9009\u62E9\u89C6\u9891\u6D41\uFF0C\u786E\u5B9A\uFF1F","\u63D0\u793A",{cancelToReject:!0}),r.videoInfo.streams.find(b=>b.codecType=="audio"&&c.mapStreams[b.index])||await window.SfcUtils.confirm("\u6CA1\u6709\u9009\u62E9\u97F3\u9891\u6D41\uFF0C\u786E\u5B9A\uFF1F","\u63D0\u793A",{cancelToReject:!0}),u()},async loadFFMpegInfo(){v.beginLoading();try{const p=(await window.SfcUtils.request(P.getFFMpegInfo())).data.data;s.value=p,_.video=[o].concat(p.videoEncoders.filter(b=>b.name.includes("264")||b.name.includes("265")||b.name.includes("hevc")).map(b=>({title:b.name,value:b.name}))),_.audio=[o].concat(p.audioEncoders.filter(b=>b.name.includes("aac")).map(b=>({title:b.name,value:b.name}))),_.subtitle=[o].concat(p.subtitleEncoders.map(b=>({title:b.name,value:b.name})))}catch(p){window.SfcUtils.snackbar(p)}finally{v.closeLoading()}}},formData:{convertRules:{},mapStreams:{},enabledConvertRules:[]},formRef:i,validators:{},throwError:!0}),{formData:c,actions:f,validators:d,loadingRef:h,loadingManager:v}=l,u=()=>{c.enabledConvertRules=r.videoInfo.streams.filter(p=>c.mapStreams[p.index]).map(p=>c.convertRules[p.index]),c.enabledConvertRules.forEach(p=>{p.encoder!="copy"?p.method="convert":p.method="copy"})};r.videoInfo.streams.forEach(p=>{c.convertRules[p.index]={index:p.index,encoder:"copy",method:"copy",type:p.codecType},c.mapStreams[p.index]=!0}),u(),t.onMounted(async()=>{await f.loadFFMpegInfo()});const g=t.computed(()=>r.videoInfo.streams.filter(p=>p.codecType=="video")),w=t.computed(()=>r.videoInfo.streams.filter(p=>p.codecType=="audio"));t.computed(()=>r.videoInfo.streams.filter(p=>p.codecType=="subtitle"));const _=t.reactive({video:[],audio:[],subtitle:[]});return n(l),(p,b)=>{const N=t.resolveComponent("LoadingMask"),m=t.resolveComponent("VCheckbox"),x=t.resolveComponent("FormSelect"),y=t.resolveComponent("VTable"),S=t.resolveComponent("base-form");return t.openBlock(),t.createBlock(S,{ref_key:"formRef",ref:i,"model-value":t.unref(c),"submit-action":t.unref(f).submit},{default:t.withCtx(()=>[t.createVNode(N,{loading:t.unref(h)},null,8,["loading"]),_n,t.createVNode(y,null,{default:t.withCtx(()=>[bn,t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(g),E=>(t.openBlock(),t.createElementBlock("tr",{key:E.index},[t.createElementVNode("td",null,[t.createVNode(m,{modelValue:t.unref(c).mapStreams[E.index],"onUpdate:modelValue":C=>t.unref(c).mapStreams[E.index]=C,color:"primary",style:{"margin-top":"6px"},density:"comfortable","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),t.createElementVNode("td",null,t.toDisplayString(E.codecName),1),t.createElementVNode("td",null,t.toDisplayString(E.language||"-"),1),t.createElementVNode("td",null,[t.unref(_).video.length?(t.openBlock(),t.createBlock(x,{key:0,modelValue:t.unref(c).convertRules[E.index].encoder,"onUpdate:modelValue":C=>t.unref(c).convertRules[E.index].encoder=C,disabled:!t.unref(c).mapStreams[E.index],style:{width:"160px"},items:t.unref(_).video,onChange:u},null,8,["modelValue","onUpdate:modelValue","disabled","items"])):t.createCommentVNode("",!0)])]))),128))])]),_:1}),En,t.createVNode(y,null,{default:t.withCtx(()=>[Cn,t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(w),E=>(t.openBlock(),t.createElementBlock("tr",{key:E.index},[t.createElementVNode("td",null,[t.createVNode(m,{modelValue:t.unref(c).mapStreams[E.index],"onUpdate:modelValue":C=>t.unref(c).mapStreams[E.index]=C,color:"primary",style:{"margin-top":"6px"},density:"comfortable","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),t.createElementVNode("td",null,t.toDisplayString(E.codecName),1),t.createElementVNode("td",null,t.toDisplayString(E.language||"-"),1),t.createElementVNode("td",null,[t.unref(_).audio.length?(t.openBlock(),t.createBlock(x,{key:0,modelValue:t.unref(c).convertRules[E.index].encoder,"onUpdate:modelValue":C=>t.unref(c).convertRules[E.index].encoder=C,disabled:!t.unref(c).mapStreams[E.index],style:{width:"160px"},items:t.unref(_).audio,onChange:u},null,8,["modelValue","onUpdate:modelValue","disabled","items"])):t.createCommentVNode("",!0)])]))),128))])]),_:1})]),_:1},8,["model-value","submit-action"])}}})),Nn={style:{padding:"16px"}},Vn={class:"d-flex align-center"},Fn={style:{padding:"0 8px",flex:"1"}},Bn={class:"break-text"},Dn={class:"tip",style:{"line-height":"16px"}},An={key:0},Tn={key:1},$n={key:2},In={key:3},Ln={key:0,class:"break-text"},Rn={class:"min-width: 64px"},Mn=t.createElementVNode("div",null,[t.createElementVNode("a",{style:{"font-size":"9px"}},"\u67E5\u770B\u65E5\u5FD7")],-1),Pn=t.createElementVNode("div",null,[t.createElementVNode("a",{style:{"font-size":"9px"}},"\u53D6\u6D88")],-1),Un=t.defineComponent({name:"EncodeConvertTaskInfo"}),ue=t.defineComponent(M(R({},Un),{props:{task:{type:Object,default(){return{}}},haveLog:{type:Boolean,default:!1},showCancel:{type:Boolean,default:!1}},setup(e){const n=e,a=t.computed(()=>JSON.parse(n.task.params||"{}")),r=window.StringFormatter.toDate,i=async()=>{const o=window.SfcUtils.loadingDialog();try{const l=(await window.SfcUtils.request(P.getLog(n.task.asyncTaskRecord.id))).data.data;l?window.SfcUtils.openComponentDialog(window.components.CodeEditor,{props:{modelValue:l.taskLog,readOnly:!0,useMiniMap:!0,style:{height:"100%"}},fullscreen:!0}):window.SfcUtils.alert("\u6CA1\u80FD\u67E5\u8BE2\u5230\u65E5\u5FD7")}catch(l){window.SfcUtils.alert(l,"\u9519\u8BEF")}finally{o.close()}},s=async()=>{const o=window.SfcUtils.loadingDialog({msg:"\u8BF7\u6C42\u4E2D..."});try{await window.SfcUtils.sleep(150),await window.SfcUtils.request(window.API.asyncTask.interrupt(n.task.asyncTaskRecord.id)),o.close()}catch(l){o.close(),await window.SfcUtils.sleep(250),window.SfcUtils.alert("\u8BF7\u6C42\u5931\u8D25: "+l)}};return(o,l)=>{var h,v;const c=t.resolveComponent("FileIcon"),f=t.resolveComponent("VProgressLinear"),d=t.resolveComponent("CommonIcon");return t.openBlock(),t.createElementBlock("div",Nn,[t.createElementVNode("div",Vn,[t.createElementVNode("div",null,[t.createVNode(c,{width:"36","file-name":"aaa.mp4"})]),t.createElementVNode("div",Fn,[t.createElementVNode("div",Bn,[t.createElementVNode("div",null,t.toDisplayString((v=(h=t.unref(a))==null?void 0:h.source)==null?void 0:v.name),1),t.createElementVNode("div",Dn,[e.task.asyncTaskRecord.executeDate?(t.openBlock(),t.createElementBlock("div",An," \u6267\u884C\u65E5\u671F: "+t.toDisplayString(t.unref(r)(e.task.asyncTaskRecord.executeDate)),1)):t.createCommentVNode("",!0),e.task.asyncTaskRecord.finishDate?(t.openBlock(),t.createElementBlock("div",Tn," \u5B8C\u6210\u65E5\u671F: "+t.toDisplayString(t.unref(r)(e.task.asyncTaskRecord.finishDate)),1)):t.createCommentVNode("",!0),e.task.asyncTaskRecord.failedDate?(t.openBlock(),t.createElementBlock("div",$n," \u5931\u8D25\u65E5\u671F: "+t.toDisplayString(t.unref(r)(e.task.asyncTaskRecord.failedDate)),1)):t.createCommentVNode("",!0),e.task.asyncTaskRecord.executeDate?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",In,t.toDisplayString(e.task.asyncTaskRecord.status==4?"\u5DF2\u53D6\u6D88":"\u7B49\u5F85\u4E2D"),1))])]),e.task.progress?(t.openBlock(),t.createElementBlock("div",Ln,[t.createVNode(f,{color:"primary","model-value":e.task.progress.loaded,max:e.task.progress.total},null,8,["model-value","max"])])):t.createCommentVNode("",!0)]),t.createElementVNode("div",Rn,[t.createElementVNode("div",{class:"text-center link",onClick:i},[t.createElementVNode("div",null,[t.createVNode(d,{color:"primary",icon:"mdi-eye"})]),Mn]),e.showCancel?(t.openBlock(),t.createElementBlock("div",{key:0,class:"text-center link",style:{"margin-left":"12px"},onClick:s},[t.createElementVNode("div",null,[t.createVNode(d,{color:"primary",icon:"mdi-close"})]),Pn])):t.createCommentVNode("",!0)])])])}}})),On=t.createTextVNode(" \u8FDB\u884C\u4E2D"),zn=t.createTextVNode(" \u5DF2\u5B8C\u6210"),jn={key:0},qn=t.createTextVNode(" \u6267\u884C\u5931\u8D25"),Hn={key:0},Wn=t.defineComponent({name:"EncodeConvertTask",components:{EncodeConvertTaskInfo:ue}}),Yn=t.defineComponent(M(R({},Wn),{props:{uid:{type:[String,Number],default:0}},setup(e){const n=e,a=t.ref("1"),r=t.ref(0),i=t.ref([]),s=t.ref([]),o=t.ref(0),l=t.ref([]),c=t.ref(0),f=async w=>(await window.SfcUtils.request(P.listConvertTask(n.uid,w,0,20))).data.data,d=async()=>{const w=f(1),_=f(0),p=await Promise.all([w,_]);r.value=Number(p[0].totalCount)||0,i.value=p[0].content,r.value+=Number(p[1].totalCount),i.value=i.value.concat(p[1].content)},h=async()=>{const w=await f(2);o.value=w.totalCount,s.value=w.content},v=async()=>{const w=await Promise.all([f(3),f(4)]);c.value=Number(w[0].totalCount)+Number(w[1].totalCount),l.value=(w[0].content||[]).concat(w[1].content)};let u,g=!1;return t.onMounted(()=>{h(),d(),v(),u=setInterval(async()=>{if(!g)try{g=!0;let w;a.value=="1"?w=d():a.value=="2"?w=h():w=v(),await w}finally{g=!1}},2500)}),t.onUnmounted(()=>{u&&clearInterval(u)}),(w,_)=>{const p=t.resolveComponent("v-tab"),b=t.resolveComponent("v-tabs"),N=t.resolveComponent("EmptyTip"),m=t.resolveComponent("v-window-item"),x=t.resolveComponent("v-window");return t.openBlock(),t.createElementBlock("div",null,[t.createVNode(b,{modelValue:a.value,"onUpdate:modelValue":_[0]||(_[0]=y=>a.value=y),color:"primary","fixed-tabs":""},{default:t.withCtx(()=>[t.createVNode(p,{value:"1"},{default:t.withCtx(()=>[On,t.createElementVNode("span",null,"("+t.toDisplayString(r.value)+")",1)]),_:1}),t.createVNode(p,{value:"2"},{default:t.withCtx(()=>[zn,o.value?(t.openBlock(),t.createElementBlock("span",jn,"("+t.toDisplayString(o.value)+")",1)):t.createCommentVNode("",!0)]),_:1}),t.createVNode(p,{value:"3"},{default:t.withCtx(()=>[qn,c.value?(t.openBlock(),t.createElementBlock("span",Hn,"("+t.toDisplayString(c.value)+")",1)):t.createCommentVNode("",!0)]),_:1})]),_:1},8,["modelValue"]),t.createVNode(x,{modelValue:a.value,"onUpdate:modelValue":_[1]||(_[1]=y=>a.value=y)},{default:t.withCtx(()=>[t.createVNode(m,{value:"1"},{default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(i.value,y=>(t.openBlock(),t.createBlock(ue,{key:y.id,task:y,"show-cancel":""},null,8,["task"]))),128)),i.value.length?t.createCommentVNode("",!0):(t.openBlock(),t.createBlock(N,{key:0}))]),_:1}),t.createVNode(m,{value:"2"},{default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(s.value,y=>(t.openBlock(),t.createBlock(ue,{key:y.id,task:y,"have-log":!0},null,8,["task"]))),128)),s.value.length?t.createCommentVNode("",!0):(t.openBlock(),t.createBlock(N,{key:0}))]),_:1}),t.createVNode(m,{value:"3"},{default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(l.value,y=>(t.openBlock(),t.createBlock(ue,{key:y.id,task:y,"have-log":!0},null,8,["task"]))),128)),l.value.length?t.createCommentVNode("",!0):(t.openBlock(),t.createBlock(N,{key:0}))]),_:1})]),_:1},8,["modelValue"])])}}})),q=window.context,H=window.SfcUtils;function Gn(e,n,a,r){if(!n.name.endsWith(".mkv"))return null;const i={name:n.name,path:a,protocol:"subtitle",targetId:e.uid,stream:r};if(e.protocol=="main")return window.SfcUtils.getApiUrl(window.API.resource.getCommonResource(i));const s=e.getProtocolParams();return i.sourceProtocol=e.protocol,i.sourceId=s.id,Object.keys(s).filter(o=>o!="id").forEach(o=>{i[o]=s[o]}),window.SfcUtils.getApiUrl(window.API.resource.getCommonResource(i))}async function Ee(e,n,a){const r={name:n.name,path:a,targetId:e.uid,sourceProtocol:e.protocol||"main",protocol:e.protocol||"main"},i=e.getProtocolParams();return r.sourceId=i.id,Object.keys(i).filter(s=>s!="id").forEach(s=>{r[s]=i[s]}),r}async function Ce(e,n,a){const r=await Ee(e,n,a);return r.protocol="videoInfo",(await await H.request(window.API.resource.getCommonResource(r))).data}const Xn=new Set(["mp4","mkv","avi","rm","rmvb","m4v","flv","mpg","mpeg","mpe","ts"]);function Se(e){const n=e.split(".").pop();return!!n&&Xn.has(n)}const he=q.fileOpenHandler.value.findIndex(e=>e.id=="play-video"),ke=he==-1?null:q.fileOpenHandler.value[he],Ye={id:"player",icon:"mdi-play-circle",matcher(e,n){return Se(n.name)},title:"\u64AD\u653E\u89C6\u9891",async action(e,n){try{let a=n.path;a||(a=(await H.request(window.API.resource.parseNodeId(n.uid,n.node))).data.data),H.beginLoading(),await window.SfcUtils.sleep(100);let r;try{r=await Ce(e,n,a)}catch(o){console.error(o),r={chapters:[],format:{},streams:[]}}const i=[],s=n.name.lastIndexOf(".");if(s!=-1){const o=n.name.substring(0,s),l=["ass","vtt"].map(f=>`${o}.${f}`),c=e.fileList.filter(f=>l.find(d=>d==f.name)).forEach(f=>{const d=e.getFileUrl(f);d&&i.push({title:`[\u5916\u6302\u5B57\u5E55] ${f.name}`,url:d,type:f.name.endsWith(".ass")?"ass":"webvtt"})})}r.streams.filter(o=>o.codecType=="subtitle").forEach(o=>{i.push({title:`${o.language}${o.title?"("+o.title+")":""}`,url:Gn(e,n,a,o.index),type:"webvtt"})}),H.openComponentDialog(Kt,{props:{url:e.getFileUrl(n),videoInfo:r,subtitleList:i,file:n},dense:!0,showCancel:!1,title:"\u89C6\u9891\u9884\u89C8\uFF1A"+n.name,extraDialogOptions:{maxWidth:"80%"}})}catch(a){ke&&ke.matcher(e,n)?(H.snackbar(`\u589E\u5F3A\u7248\u64AD\u653E\u5668\u64AD\u653E\u5931\u8D25, \u6539\u7528\u901A\u7528\u7248\u672C\u3002\u539F\u56E0: ${a}`),ke.action(e,n)):H.snackbar(a)}finally{H.closeLoading()}},sort:0},Kn={id:"video",name:"\u89C6\u9891",items:[{title:"\u89C6\u9891\u8F6C\u7801",id:"video-convert",icon:"mdi-cached",renderOn(e){return e&&e.selectFileList.length==1&&!e.selectFileList[0].mount&&Se(e.selectFileList[0].name)&&!e.readonly},async action(e){const n=e.selectFileList[0],a=await Ce(e,n,n.path),r=window.SfcUtils.openComponentDialog(kn,{props:{videoInfo:a},title:`\u89C6\u9891\u8F6C\u7801\uFF1A${e.selectFileList[0].name}`,async onConfirm(){const i=window.SfcUtils.loadingDialog({msg:"\u4EFB\u52A1\u521B\u5EFA\u4E2D"});try{if((await r.getInstAsForm().submit()).success){const o=r.getInstAsForm().getFormData().enabledConvertRules,l=await Ee(e,n,n.path),c=await Ee(e,n,n.path);return c.name="convert_"+c.name,await window.SfcUtils.request(P.encodeConvert({rules:o,source:l,target:c})),window.SfcUtils.snackbar("\u4EFB\u52A1\u521B\u5EFA\u6210\u529F"),!0}else return!1}catch(s){return H.snackbar(s),!1}finally{i.close()}}})}},{title:"\u89C6\u9891\u4FE1\u606F",id:"video-info",renderOn(e){return e&&e.selectFileList.length==1&&!e.selectFileList[0].mount&&Se(e.selectFileList[0].name)},icon:"mdi-information-variant",async action(e){const n=await Ce(e,e.selectFileList[0],e.selectFileList[0].path);window.SfcUtils.openComponentDialog(xn,{props:{videoInfo:n},title:`\u5A92\u4F53\u4FE1\u606F\uFF1A${e.selectFileList[0].name}`})}}]};q.menu.value.boxMenu.push({name:"\u89C6\u9891\u670D\u52A1",id:"video",items:[{id:"encoder-convert",title:"\u89C6\u9891\u8F6C\u7801",icon:"mdi-cached",renderOn(){return!!q.session.value.token},action(e){e.title="\u89C6\u9891\u8F6C\u7801",e.currentComponent=t.h(Yn,{style:{maxWidth:"640px",margin:"auto"},uid:q.session.value.user.id})}}]}),he!=-1?q.fileOpenHandler.value[he]=Ye:q.fileOpenHandler.value.push(Ye),q.menu.value.fileListMenu.push(Kn)});
